# –≠—Ç–∞–ø 1.1: get-comments ‚Üí batch support

**Execution Type:** `parallel` (–º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —Å 1.2, 1.3)

**–¶–µ–ª—å:** –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –º–∞—Å—Å–∏–≤–∞ `issueIds` –≤ get-comments tool.

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

- [ ] 1. –û–±–Ω–æ–≤–∏—Ç—å schema: `issueId` ‚Üí `issueIds`
- [ ] 2. –°–æ–∑–¥–∞—Ç—å batch operation –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
- [ ] 3. –û–±–Ω–æ–≤–∏—Ç—å tool –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è batch operation
- [ ] 4. –û–±–Ω–æ–≤–∏—Ç—å metadata –∏ description
- [ ] 5. –û–±–Ω–æ–≤–∏—Ç—å facade method (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è)
- [ ] 6. –ù–∞–ø–∏—Å–∞—Ç—å unit-—Ç–µ—Å—Ç—ã
- [ ] 7. –í–∞–ª–∏–¥–∞—Ü–∏—è: `npm run validate`
- [ ] 8. –ö–æ–º–º–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π

---

## üìã –î–µ—Ç–∞–ª—å–Ω—ã–µ —à–∞–≥–∏

### –®–∞–≥ 1: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ schema

**–§–∞–π–ª:** `packages/servers/yandex-tracker/src/tools/api/comments/get/get-comments.schema.ts`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

```typescript
// –ë–´–õ–û
issueId: IssueKeySchema

// –°–¢–ê–õ–û
issueIds: IssueKeysSchema
```

**–í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã:**
1. –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä: `issueId` ‚Üí `issueIds`
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `IssueKeysSchema` (–≤—Å–µ–≥–¥–∞ –º–∞—Å—Å–∏–≤, –º–∏–Ω–∏–º—É–º 1)
3. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã `perPage`, `page`, `expand` –æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å (–ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫–æ –≤—Å–µ–º –∑–∞–¥–∞—á–∞–º)
4. –û–±–Ω–æ–≤–∏—Ç—å JSDoc –æ–ø–∏—Å–∞–Ω–∏—è

**–ò—Ç–æ–≥–æ–≤–∞—è —Å—Ö–µ–º–∞:**
```typescript
export const GetCommentsParamsSchema = z.object({
  issueIds: IssueKeysSchema.describe('Array of issue IDs or keys'),
  perPage: z.number().int().positive().max(500).optional(),
  page: z.number().int().positive().optional(),
  expand: ExpandSchema,
  fields: FieldsSchema,
});
```

---

### –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ batch operation

**–§–∞–π–ª:** `packages/servers/yandex-tracker/src/tracker_api/api_operations/comment/get-comments.operation.ts`

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- –ú–µ—Ç–æ–¥ `execute(issueId: string, input)` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –æ–¥–∏–Ω issueId

**–ß—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—å:**

1. **–î–æ–±–∞–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç ParallelExecutor –∏ ServerConfig:**
```typescript
constructor(
  httpClient: HttpClient,
  cacheManager: CacheManager,
  logger: Logger,
  config: ServerConfig
) {
  super(httpClient, cacheManager, logger);
  this.parallelExecutor = new ParallelExecutor(logger, {
    maxBatchSize: config.maxBatchSize,
    maxConcurrentRequests: config.maxConcurrentRequests,
  });
}
```

2. **–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥ `executeMany()` –¥–ª—è batch:**
```typescript
async executeMany(
  issueIds: string[],
  input: GetCommentsInput = {}
): Promise<BatchResult<string, CommentWithUnknownFields[]>>
```

**–õ–æ–≥–∏–∫–∞ –º–µ—Ç–æ–¥–∞:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –º–∞—Å—Å–∏–≤ –Ω–µ –ø—É—Å—Ç–æ–π
- –°–æ–∑–¥–∞—Ç—å –º–∞—Å—Å–∏–≤ –æ–ø–µ—Ä–∞—Ü–∏–π –¥–ª—è ParallelExecutor
- –ö–∞–∂–¥–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `execute()` –¥–ª—è –æ–¥–Ω–æ–π –∑–∞–¥–∞—á–∏
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `parallelExecutor.executeParallel(operations, 'get comments')`
- –í–µ—Ä–Ω—É—Ç—å BatchResult

3. **–û—Å—Ç–∞–≤–∏—Ç—å —Å—Ç–∞—Ä—ã–π –º–µ—Ç–æ–¥ `execute()` –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –≤–Ω—É—Ç—Ä–∏ –∫–æ–¥–∞:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –≤–Ω—É—Ç—Ä–∏ `executeMany()`

**–û–±—Ä–∞–∑–µ—Ü:** –°–º. `get-issues.operation.ts`

---

### –®–∞–≥ 3: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ tool

**–§–∞–π–ª:** `packages/servers/yandex-tracker/src/tools/api/comments/get/get-comments.tool.ts`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –º–µ—Ç–æ–¥–µ `execute()`:**

1. **–í–∞–ª–∏–¥–∞—Ü–∏—è:**
```typescript
const { issueIds, perPage, page, expand, fields } = validation.data;
```

2. **–í—ã–∑–æ–≤ batch operation:**
```typescript
const results = await this.facade.getCommentsMany(issueIds, {
  perPage,
  page,
  expand: expand?.join(',')
});
```

3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —á–µ—Ä–µ–∑ BatchResultProcessor:**
```typescript
const processedResults = BatchResultProcessor.process(
  results,
  (comments: CommentWithUnknownFields[]) =>
    comments.map(comment =>
      ResponseFieldFilter.filter<CommentWithUnknownFields>(comment, fields)
    )
);
```

4. **–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ unified batch result:**
```typescript
return this.formatSuccess({
  total: issueIds.length,
  successful: processedResults.successful.map(item => ({
    issueId: item.key,
    comments: item.data,
    count: item.data.length
  })),
  failed: processedResults.failed,
  fieldsReturned: fields
});
```

**–û–±—Ä–∞–∑–µ—Ü:** –°–º. `get-issues.tool.ts`

---

### –®–∞–≥ 4: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ metadata

**–§–∞–π–ª:** `packages/servers/yandex-tracker/src/tools/api/comments/get/get-comments.metadata.ts`

**–û–±–Ω–æ–≤–∏—Ç—å:**
1. `name`: –æ—Å—Ç–∞–≤–∏—Ç—å `get_comments` (–Ω–µ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞—Ç—å)
2. `description`: –¥–æ–±–∞–≤–∏—Ç—å —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ batch-—Ä–µ–∂–∏–º–∞
3. `category`: –æ—Å—Ç–∞–≤–∏—Ç—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
4. `tags`: –≤–æ–∑–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å 'batch'

**–ü—Ä–∏–º–µ—Ä description:**
```typescript
description: 'Get comments from one or multiple Yandex Tracker issues. Supports pagination and field filtering. Returns unified batch result format.'
```

---

### –®–∞–≥ 5: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ facade

**–§–∞–π–ª:** `packages/servers/yandex-tracker/src/tracker_api/facade/yandex-tracker.facade.ts`

**–¢–µ–∫—É—â–∏–π –º–µ—Ç–æ–¥:**
```typescript
async getComments(
  issueId: string,
  input?: GetCommentsInput
): Promise<CommentWithUnknownFields[]>
```

**–ß—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—å:**

**–í–∞—Ä–∏–∞–Ω—Ç A (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è): –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥**
```typescript
async getCommentsMany(
  issueIds: string[],
  input?: GetCommentsInput
): Promise<BatchResult<string, CommentWithUnknownFields[]>> {
  return this.commentService.getCommentsMany(issueIds, input);
}
```

**–í–∞—Ä–∏–∞–Ω—Ç B: –ó–∞–º–µ–Ω–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π** (–µ—Å–ª–∏ —Ö–æ—Ç–∏–º –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–∫–∞–∑–∞—Ç—å—Å—è –æ—Ç single-–≤–µ—Ä—Å–∏–∏):
- –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥
- –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ –≤—ã–∑–æ–≤—ã –≤–Ω—É—Ç—Ä–∏ —Å–µ—Ä–≤–∏—Å–æ–≤

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –í–∞—Ä–∏–∞–Ω—Ç A –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞.

---

### –®–∞–≥ 6: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ service

**–§–∞–π–ª:** `packages/servers/yandex-tracker/src/tracker_api/facade/services/comment.service.ts`

**–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥:**
```typescript
async getCommentsMany(
  issueIds: string[],
  input?: GetCommentsInput
): Promise<BatchResult<string, CommentWithUnknownFields[]>> {
  return this.getCommentsOperation.executeMany(issueIds, input);
}
```

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- Dependency injection –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞
- GetCommentsOperation –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä
- –¢–∏–ø—ã –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

### –®–∞–≥ 7: Unit-—Ç–µ—Å—Ç—ã

**–§–∞–π–ª:** `packages/servers/yandex-tracker/tests/tracker_api/api_operations/comment/get-comments.operation.test.ts`

**–î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã:**

1. **–£—Å–ø–µ—à–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∑–∞–¥–∞—á:**
```typescript
it('should get comments for multiple issues in parallel', async () => {
  // Mock httpClient.get –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏
  // –í—ã–∑–≤–∞—Ç—å executeMany(['TEST-1', 'TEST-2'])
  // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å BatchResult format
  // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—ã–∑–≤–∞–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ endpoints
});
```

2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ —á–∞—Å—Ç–∏—á–Ω—ã—Ö –æ—à–∏–±–æ–∫:**
```typescript
it('should handle partial failures (some succeed, some fail)', async () => {
  // Mock: TEST-1 —É—Å–ø–µ—Ö, TEST-2 –æ—à–∏–±–∫–∞ 404
  // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: successful.length = 1, failed.length = 1
});
```

3. **–ü–∞–≥–∏–Ω–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫–æ –≤—Å–µ–º –∑–∞–¥–∞—á–∞–º:**
```typescript
it('should apply perPage and page to all issues', async () => {
  // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ –≤—Å–µ–º –∑–∞–ø—Ä–æ—Å–∞–º
});
```

4. **–ü—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤:**
```typescript
it('should return empty result for empty array', async () => {
  const result = await operation.executeMany([]);
  expect(result).toEqual([]);
});
```

**–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤:**
```bash
npm run test -- get-comments.operation.test.ts
```

---

### –®–∞–≥ 8: Tool —Ç–µ—Å—Ç—ã

**–§–∞–π–ª:** `packages/servers/yandex-tracker/tests/tools/api/comments/get/get-comments.tool.test.ts`

**–î–æ–±–∞–≤–∏—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å —Ç–µ—Å—Ç—ã:**

1. **–í–∞–ª–∏–¥–∞—Ü–∏—è schema —Å –º–∞—Å—Å–∏–≤–æ–º:**
```typescript
it('should validate issueIds as array', async () => {
  const params = {
    issueIds: ['TEST-1', 'TEST-2'],
    fields: ['id', 'text']
  };
  // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é
});
```

2. **Unified batch result format:**
```typescript
it('should return unified batch format', async () => {
  // Mock facade.getCommentsMany
  // –í—ã–∑–≤–∞—Ç—å tool.execute()
  // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞: { total, successful, failed }
});
```

3. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª–µ–π —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤:**
```typescript
it('should filter fields for all comments from all issues', async () => {
  // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å ResponseFieldFilter –ø—Ä–∏–º–µ–Ω–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
});
```

---

### –®–∞–≥ 9: –í–∞–ª–∏–¥–∞—Ü–∏—è

```bash
npm run validate
```

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- [ ] –õ–∏–Ω—Ç–∏–Ω–≥ –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] Type-check –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] –¢–µ—Å—Ç—ã –¥–ª—è –¥—Ä—É–≥–∏—Ö tools –Ω–µ —Å–ª–æ–º–∞–ª–∏—Å—å

---

### –®–∞–≥ 10: –ö–æ–º–º–∏—Ç

**–§–æ—Ä–º–∞—Ç:**
```
feat(comments): –¥–æ–±–∞–≤–∏—Ç—å batch support –≤ get-comments

–î–µ—Ç–∞–ª–∏:
- Schema: issueId ‚Üí issueIds (–≤—Å–µ–≥–¥–∞ –º–∞—Å—Å–∏–≤)
- Operation: –¥–æ–±–∞–≤–ª–µ–Ω executeMany() —Å ParallelExecutor
- Tool: unified batch result format
- Facade: –¥–æ–±–∞–≤–ª–µ–Ω getCommentsMany()
- –ü–∞–≥–∏–Ω–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫–æ –≤—Å–µ–º –∑–∞–¥–∞—á–∞–º –æ–¥–∏–Ω–∞–∫–æ–≤–æ
- –ü–æ–∫—Ä—ã—Ç–æ unit-—Ç–µ—Å—Ç–∞–º–∏

Breaking Changes:
- –ü–∞—Ä–∞–º–µ—Ç—Ä issueId –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω –≤ issueIds (–º–∞—Å—Å–∏–≤)
- –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ unified batch result

ü§ñ Generated with Claude Code
Co-Authored-By: Claude <noreply@anthropic.com>
```

---

## üéØ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

1. ‚úÖ Schema –æ–±–Ω–æ–≤–ª–µ–Ω–∞ (issueIds: IssueKeysSchema)
2. ‚úÖ Operation –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç batch (executeMany)
3. ‚úÖ Tool –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç unified batch result
4. ‚úÖ Facade method –¥–æ–±–∞–≤–ª–µ–Ω
5. ‚úÖ Unit-—Ç–µ—Å—Ç—ã –Ω–∞–ø–∏—Å–∞–Ω—ã –∏ –ø—Ä–æ—Ö–æ–¥—è—Ç
6. ‚úÖ `npm run validate` —É—Å–ø–µ—à–Ω–∞
7. ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–∫–æ–º–º–∏—á–µ–Ω—ã

---

## üìö –°–ø—Ä–∞–≤–æ—á–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

**–û–±—Ä–∞–∑—Ü—ã –∫–æ–¥–∞:**
- `packages/servers/yandex-tracker/src/tools/api/issues/get/get-issues.tool.ts`
- `packages/servers/yandex-tracker/src/tracker_api/api_operations/issue/get-issues.operation.ts`

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- `@mcp-framework/infrastructure`: ParallelExecutor, BatchResult
- `@mcp-framework/core`: BaseTool, BatchResultProcessor, ResponseFieldFilter
