# Этап 2.2: DTOs (Parallel)

## Цель
Создать Data Transfer Objects для запросов к Wiki API.

## Зависимости
- Этап 1.2 завершён

## Может выполняться параллельно с
- Этап 2.1 (Entities)

## Чек-лист

### 1. Page DTOs
- [ ] Создать `src/wiki_api/dto/page/create-page.dto.ts`

```typescript
import type { PageType, TextFormat } from '#wiki_api/entities/index.js';

/**
 * Cloud page configuration (MS365)
 */
export type CloudPageConfig =
  | { method: 'empty_doc'; doctype: 'docx' | 'pptx' | 'xlsx' }
  | { method: 'from_url'; url: string }
  | { method: 'upload_doc'; mimetype: string }
  | { method: 'finalize_upload'; upload_session: string }
  | { method: 'upload_onprem'; upload_session: string };

/**
 * DTO для создания страницы
 */
export interface CreatePageDto {
  /** Тип страницы (обязательно) */
  page_type: PageType;

  /** Slug страницы (обязательно) */
  slug: string;

  /** Название страницы (1-255 символов, обязательно) */
  title: string;

  /** Содержимое страницы */
  content?: string;

  /** Формат текста для grid */
  grid_format?: TextFormat;

  /** Конфигурация облачного документа */
  cloud_page?: CloudPageConfig;
}
```

- [ ] Создать `src/wiki_api/dto/page/update-page.dto.ts`

```typescript
/**
 * DTO для обновления страницы
 */
export interface UpdatePageDto {
  /** Новое название (1-255 символов) */
  title?: string;

  /** Новое содержимое */
  content?: string;

  /** Redirect на другую страницу */
  redirect?: {
    page: {
      id?: number;
      slug?: string;
    };
  };
}
```

- [ ] Создать `src/wiki_api/dto/page/clone-page.dto.ts`

```typescript
/**
 * DTO для клонирования страницы
 */
export interface ClonePageDto {
  /** Целевой slug (обязательно) */
  target: string;

  /** Название копии (1-255 символов) */
  title?: string;

  /** Подписаться на изменения */
  subscribe_me?: boolean;
}
```

- [ ] Создать `src/wiki_api/dto/page/append-content.dto.ts`

```typescript
/**
 * Позиция вставки
 */
export type InsertLocation = 'top' | 'bottom';

/**
 * DTO для добавления контента
 */
export interface AppendContentDto {
  /** Контент для добавления (обязательно) */
  content: string;

  /** Вставка в тело страницы */
  body?: {
    location: InsertLocation;
  };

  /** Вставка в секцию */
  section?: {
    id: number;
    location: InsertLocation;
  };

  /** Вставка по якорю */
  anchor?: {
    name: string;
    fallback?: boolean;
    regex?: boolean;
  };
}
```

- [ ] Создать `src/wiki_api/dto/page/index.ts`

### 2. Grid DTOs
- [ ] Создать `src/wiki_api/dto/grid/create-grid.dto.ts`

```typescript
/**
 * DTO для создания таблицы
 */
export interface CreateGridDto {
  /** Название таблицы (1-255 символов, обязательно) */
  title: string;

  /** Страница для таблицы (обязательно) */
  page: {
    id?: number;
    slug?: string;
  };
}
```

- [ ] Создать `src/wiki_api/dto/grid/update-grid.dto.ts`

```typescript
import type { SortConfig } from '#wiki_api/entities/index.js';

/**
 * DTO для обновления таблицы
 */
export interface UpdateGridDto {
  /** Текущая ревизия (обязательно) */
  revision: string;

  /** Новое название (1-255 символов) */
  title?: string;

  /** Сортировка по умолчанию */
  default_sort?: SortConfig[];
}
```

- [ ] Создать `src/wiki_api/dto/grid/rows.dto.ts`

```typescript
import type { BGColor } from '#wiki_api/entities/index.js';

/**
 * DTO для добавления строк
 */
export interface AddRowsDto {
  /** Ревизия таблицы */
  revision?: string;

  /** Позиция вставки */
  position?: number;

  /** Вставить после строки */
  after_row_id?: string;

  /** Данные строк (обязательно) */
  rows: Array<{
    row: unknown[];
    pinned?: boolean;
    color?: BGColor;
  }>;
}

/**
 * DTO для удаления строк
 */
export interface RemoveRowsDto {
  /** Ревизия таблицы */
  revision?: string;

  /** ID строк для удаления (обязательно) */
  row_ids: string[];
}

/**
 * DTO для перемещения строки
 */
export interface MoveRowDto {
  /** ID строки (обязательно) */
  row_id: string;

  /** Переместить после строки */
  after_row_id?: string;

  /** Позиция */
  position?: number;

  /** Ревизия */
  revision?: string;

  /** Количество строк */
  rows_count?: number;
}
```

- [ ] Создать `src/wiki_api/dto/grid/columns.dto.ts`

```typescript
import type { GridColumn } from '#wiki_api/entities/index.js';

/**
 * DTO для добавления колонок
 */
export interface AddColumnsDto {
  /** Ревизия */
  revision?: string;

  /** Позиция вставки */
  position?: number;

  /** Колонки (обязательно) */
  columns: Omit<GridColumn, 'id'>[];
}

/**
 * DTO для удаления колонок
 */
export interface RemoveColumnsDto {
  /** Ревизия */
  revision?: string;

  /** Slugs колонок для удаления (обязательно) */
  column_slugs: string[];
}

/**
 * DTO для перемещения колонки
 */
export interface MoveColumnDto {
  /** Slug колонки (обязательно) */
  column_slug: string;

  /** Целевая позиция (обязательно) */
  position: number;

  /** Ревизия */
  revision?: string;

  /** Количество колонок */
  columns_count?: number;
}
```

- [ ] Создать `src/wiki_api/dto/grid/cells.dto.ts`

```typescript
/**
 * DTO для обновления ячеек
 */
export interface UpdateCellsDto {
  /** Ревизия */
  revision?: string;

  /** Ячейки для обновления (обязательно) */
  cells: Array<{
    row_id: number;
    column_slug: string;
    value: unknown;
  }>;
}
```

- [ ] Создать `src/wiki_api/dto/grid/clone-grid.dto.ts`

```typescript
/**
 * DTO для клонирования таблицы
 */
export interface CloneGridDto {
  /** Целевой slug страницы (обязательно) */
  target: string;

  /** Название копии (1-255 символов) */
  title?: string;

  /** Копировать с данными */
  with_data?: boolean;
}
```

- [ ] Создать `src/wiki_api/dto/grid/index.ts`

### 3. Главный Index
- [ ] Создать `src/wiki_api/dto/index.ts`

```typescript
// Page DTOs
export type { CreatePageDto, CloudPageConfig } from './page/create-page.dto.js';
export type { UpdatePageDto } from './page/update-page.dto.js';
export type { ClonePageDto } from './page/clone-page.dto.js';
export type { AppendContentDto, InsertLocation } from './page/append-content.dto.js';

// Grid DTOs
export type { CreateGridDto } from './grid/create-grid.dto.js';
export type { UpdateGridDto } from './grid/update-grid.dto.js';
export type { AddRowsDto, RemoveRowsDto, MoveRowDto } from './grid/rows.dto.js';
export type { AddColumnsDto, RemoveColumnsDto, MoveColumnDto } from './grid/columns.dto.js';
export type { UpdateCellsDto } from './grid/cells.dto.js';
export type { CloneGridDto } from './grid/clone-grid.dto.js';
```

## Валидация
```bash
npm run typecheck
npm run lint
```

## Результат
- Все DTO типы определены для Pages и Grids
- Типы экспортируются через index.ts
- Готовы для использования в Operations
