# Этап 1.2: Infrastructure (Sequential)

## Цель
Создать конфигурацию и константы для Wiki MCP сервера.

## Зависимости
- Этап 1.1 завершён

## Чек-лист

### 1. Constants
- [ ] Создать `src/constants.ts`

```typescript
/**
 * Префикс для всех MCP tools Yandex Wiki
 */
export const MCP_TOOL_PREFIX = 'yw';

/**
 * Base URL API Yandex Wiki (hardcoded)
 */
export const YANDEX_WIKI_API_BASE = 'https://api.wiki.yandex.net';
```

### 2. Config Interface
- [ ] Создать `src/config/server-config.interface.ts`

```typescript
export type LogLevel = 'debug' | 'info' | 'warn' | 'error';

export interface ServerConfig {
  /** OAuth токен для Wiki API */
  readonly token: string;

  /** ID организации (Яндекс 360) */
  readonly orgId?: string;

  /** ID организации (Yandex Cloud) */
  readonly cloudOrgId?: string;

  /** Base URL API (hardcoded) */
  readonly apiBase: string;

  /** Уровень логирования */
  readonly logLevel: LogLevel;

  /** Таймаут запросов в мс */
  readonly requestTimeout: number;

  /** Директория для логов */
  readonly logsDir: string;

  /** Pretty-print логов */
  readonly prettyLogs: boolean;

  /** Макс размер лог-файла */
  readonly logMaxSize: number;

  /** Макс количество лог-файлов */
  readonly logMaxFiles: number;

  /** Retry attempts */
  readonly retryAttempts: number;

  /** Min retry delay */
  readonly retryMinDelay: number;

  /** Max retry delay */
  readonly retryMaxDelay: number;

  /** Tool discovery mode */
  readonly toolDiscoveryMode: 'lazy' | 'eager';
}
```

### 3. Config Constants
- [ ] Создать `src/config/constants.ts`

```typescript
export const DEFAULT_API_BASE = 'https://api.wiki.yandex.net';
export const DEFAULT_LOG_LEVEL = 'info';
export const DEFAULT_REQUEST_TIMEOUT = 30000;
export const DEFAULT_LOGS_DIR = './logs';
export const DEFAULT_LOG_MAX_SIZE = 51200; // 50KB
export const DEFAULT_LOG_MAX_FILES = 20;
export const DEFAULT_RETRY_ATTEMPTS = 3;
export const DEFAULT_RETRY_MIN_DELAY = 1000;
export const DEFAULT_RETRY_MAX_DELAY = 10000;
export const DEFAULT_TOOL_DISCOVERY_MODE = 'eager';

export const ENV_VAR_NAMES = {
  YANDEX_WIKI_TOKEN: 'YANDEX_WIKI_TOKEN',
  YANDEX_ORG_ID: 'YANDEX_ORG_ID',
  YANDEX_CLOUD_ORG_ID: 'YANDEX_CLOUD_ORG_ID',
  LOG_LEVEL: 'LOG_LEVEL',
  REQUEST_TIMEOUT: 'REQUEST_TIMEOUT',
  LOGS_DIR: 'LOGS_DIR',
  PRETTY_LOGS: 'PRETTY_LOGS',
  LOG_MAX_SIZE: 'LOG_MAX_SIZE',
  LOG_MAX_FILES: 'LOG_MAX_FILES',
  RETRY_ATTEMPTS: 'YANDEX_WIKI_RETRY_ATTEMPTS',
  RETRY_MIN_DELAY: 'YANDEX_WIKI_RETRY_MIN_DELAY',
  RETRY_MAX_DELAY: 'YANDEX_WIKI_RETRY_MAX_DELAY',
  TOOL_DISCOVERY_MODE: 'TOOL_DISCOVERY_MODE',
} as const;
```

### 4. Config Loader
- [ ] Создать `src/config/config-loader.ts`
- [ ] Скопировать логику из yandex-tracker и адаптировать:
  - Заменить `YANDEX_TRACKER_TOKEN` на `YANDEX_WIKI_TOKEN`
  - Убрать batch-related конфигурацию
  - Hardcode `apiBase = YANDEX_WIKI_API_BASE`

### 5. Config Index
- [ ] Создать `src/config/index.ts`

```typescript
export type { ServerConfig, LogLevel } from './server-config.interface.js';
export { loadConfig } from './config-loader.js';
export * from './constants.js';
```

### 6. Entry Point (заглушка)
- [ ] Создать `src/index.ts`

```typescript
/**
 * MCP Server для Yandex Wiki
 *
 * Entry point для запуска сервера
 */

import 'reflect-metadata';

export { loadConfig } from '#config';
export type { ServerConfig } from '#config';

// TODO: Добавить createContainer и startServer после реализации DI
```

## Валидация
```bash
cd packages/servers/yandex-wiki
npm run build
npm run typecheck
```

## Результат
- Конфигурация загружается из переменных окружения
- Constants определены (MCP_TOOL_PREFIX = 'yw')
- Entry point готов к расширению
