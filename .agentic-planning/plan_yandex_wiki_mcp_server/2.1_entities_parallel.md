# Этап 2.1: Entities (Parallel)

## Цель
Создать типы данных (entities) для ответов Wiki API.

## Зависимости
- Этап 1.2 завершён

## Может выполняться параллельно с
- Этап 2.2 (DTOs)

## Чек-лист

### 1. Базовые типы
- [ ] Создать `src/wiki_api/entities/types.ts`

```typescript
/**
 * Helper тип для поддержки неизвестных полей API
 */
export type WithUnknownFields<T> = T & { readonly [key: string]: unknown };
```

### 2. Page Entity
- [ ] Создать `src/wiki_api/entities/page.entity.ts`

```typescript
import type { WithUnknownFields } from './types.js';

/**
 * Тип страницы Wiki
 */
export type PageType = 'page' | 'grid' | 'cloud_page' | 'wysiwyg' | 'template';

/**
 * Атрибуты страницы
 */
export interface PageAttributes {
  readonly created_at: string;
  readonly modified_at: string;
  readonly lang?: string;
  readonly is_readonly: boolean;
  readonly comments_count: number;
  readonly comments_enabled: boolean;
  readonly keywords?: string[];
  readonly is_collaborative?: boolean;
  readonly is_draft?: boolean;
}

/**
 * Breadcrumb (навигационная цепочка)
 */
export interface Breadcrumb {
  readonly page_exists: boolean;
  readonly slug: string;
  readonly title: string;
  readonly id?: number;
}

/**
 * Redirect информация
 */
export interface PageRedirect {
  readonly page_id: number;
  readonly redirect_target: Page;
}

/**
 * Страница Wiki
 */
export interface Page {
  readonly id: number;
  readonly slug: string;
  readonly title: string;
  readonly page_type: PageType;
  readonly attributes?: PageAttributes;
  readonly breadcrumbs?: Breadcrumb[];
  readonly content?: unknown;
  readonly redirect?: PageRedirect;
}

export type PageWithUnknownFields = WithUnknownFields<Page>;
```

### 3. Grid Entity
- [ ] Создать `src/wiki_api/entities/grid.entity.ts`

```typescript
import type { WithUnknownFields } from './types.js';

/**
 * Тип колонки
 */
export type ColumnType =
  | 'string'
  | 'number'
  | 'date'
  | 'select'
  | 'staff'
  | 'checkbox'
  | 'ticket'
  | 'ticket_field';

/**
 * Формат текста
 */
export type TextFormat = 'yfm' | 'wom' | 'plain';

/**
 * Цвет фона
 */
export type BGColor =
  | 'blue' | 'yellow' | 'pink' | 'red' | 'green'
  | 'mint' | 'grey' | 'orange' | 'magenta'
  | 'purple' | 'copper' | 'ocean';

/**
 * Колонка таблицы
 */
export interface GridColumn {
  readonly id?: string;
  readonly title: string;
  readonly slug: string;
  readonly type: ColumnType;
  readonly required: boolean;
  readonly color?: BGColor;
  readonly width?: number;
  readonly width_units?: '%' | 'px';
  readonly pinned?: 'left' | 'right';
  readonly format?: TextFormat;
  readonly multiple?: boolean;
  readonly select_options?: string[];
  readonly description?: string;
}

/**
 * Строка таблицы
 */
export interface GridRow {
  readonly id: string;
  readonly row: unknown[];
  readonly pinned?: boolean;
  readonly color?: BGColor;
}

/**
 * Сортировка
 */
export interface SortConfig {
  readonly column_slug: string;
  readonly direction: 'asc' | 'desc';
}

/**
 * Структура таблицы
 */
export interface GridStructure {
  readonly columns: GridColumn[];
  readonly default_sort?: SortConfig[];
}

/**
 * Атрибуты таблицы
 */
export interface GridAttributes {
  readonly created_at: string;
  readonly modified_at: string;
}

/**
 * Динамическая таблица
 */
export interface Grid {
  readonly created_at: string;
  readonly title: string;
  readonly page: {
    readonly id: number;
    readonly slug: string;
  };
  readonly revision: string;
  readonly rich_text_format: TextFormat;
  readonly structure: GridStructure;
  readonly rows: GridRow[];
  readonly attributes?: GridAttributes;
  readonly user_permissions?: unknown;
  readonly template_id?: string;
}

export type GridWithUnknownFields = WithUnknownFields<Grid>;
```

### 4. Resource Entity
- [ ] Создать `src/wiki_api/entities/resource.entity.ts`

```typescript
import type { WithUnknownFields } from './types.js';

/**
 * Тип ресурса
 */
export type ResourceType = 'attachment' | 'grid' | 'sharepoint_resource';

/**
 * Ресурс страницы
 */
export interface Resource {
  readonly item: unknown;
  readonly type: ResourceType;
}

/**
 * Ответ со списком ресурсов
 */
export interface ResourcesResponse {
  readonly results: Resource[];
  readonly next_cursor?: string;
  readonly prev_cursor?: string;
}

export type ResourceWithUnknownFields = WithUnknownFields<Resource>;
```

### 5. Operation Entity
- [ ] Создать `src/wiki_api/entities/operation.entity.ts`

```typescript
/**
 * Тип асинхронной операции
 */
export type OperationType =
  | 'clone'
  | 'clone_grid'
  | 'test'
  | 'export'
  | 'move';

/**
 * Асинхронная операция (clone, etc.)
 */
export interface AsyncOperation {
  readonly operation: {
    readonly type: OperationType;
    readonly id: string;
  };
  readonly dry_run: boolean;
  readonly status_url: string;
}
```

### 6. Index файл
- [ ] Создать `src/wiki_api/entities/index.ts`

```typescript
export type { WithUnknownFields } from './types.js';

export type {
  PageType,
  PageAttributes,
  Breadcrumb,
  PageRedirect,
  Page,
  PageWithUnknownFields,
} from './page.entity.js';

export type {
  ColumnType,
  TextFormat,
  BGColor,
  GridColumn,
  GridRow,
  SortConfig,
  GridStructure,
  GridAttributes,
  Grid,
  GridWithUnknownFields,
} from './grid.entity.js';

export type {
  ResourceType,
  Resource,
  ResourcesResponse,
  ResourceWithUnknownFields,
} from './resource.entity.js';

export type {
  OperationType,
  AsyncOperation,
} from './operation.entity.js';
```

## Валидация
```bash
npm run typecheck
npm run lint
```

## Результат
- Все entity типы определены
- Поддержка `WithUnknownFields<T>` для forward compatibility
- Типы экспортируются через index.ts
