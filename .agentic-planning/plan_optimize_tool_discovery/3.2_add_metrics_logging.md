# –≠—Ç–∞–ø 3.2: –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–¶–µ–ª—å:** –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–º–µ—Ä tools/list response –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º/–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º

**–ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Ñ–∞–π–ª—ã:** `packages/servers/yandex-tracker/src/index.ts`

**–í—Ä–µ–º—è:** 1 —á–∞—Å

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –¢—Ä–µ–±—É–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —ç—Ç–∞–ø–æ–≤ 1.2, 2.1, 2.2, 3.1

---

## –ß–µ–∫-–ª–∏—Å—Ç –∑–∞–¥–∞—á

### 1. –î–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –ø–æ–¥—Å—á—ë—Ç–∞ –º–µ—Ç—Ä–∏–∫

**–§–∞–π–ª:** `packages/servers/yandex-tracker/src/index.ts`

- [ ] –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `calculateToolsMetrics(definitions: ToolDefinition[])`
- [ ] –ü–æ–¥—Å—á–∏—Ç–∞—Ç—å –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- [ ] –ü–æ–¥—Å—á–∏—Ç–∞—Ç—å —Ä–∞–∑–º–µ—Ä descriptions (—Å–∏–º–≤–æ–ª—ã)
- [ ] –û—Ü–µ–Ω–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤ (symbols / 4)
- [ ] –ü–æ–¥—Å—á–∏—Ç–∞—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ categories
- [ ] –ü–æ–¥—Å—á–∏—Ç–∞—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ priorities
- [ ] –ü–æ–¥—Å—á–∏—Ç–∞—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ subcategories

**–ü—Ä–∏–º–µ—Ä —Ñ—É–Ω–∫—Ü–∏–∏:**
```typescript
interface ToolsMetrics {
  totalTools: number;
  descriptionLength: number;
  estimatedTokens: number;
  byCategory: Record<string, number>;
  byPriority: Record<string, number>;
  bySubcategory: Record<string, number>;
}

function calculateToolsMetrics(definitions: ToolDefinition[]): ToolsMetrics {
  const descriptionLength = definitions.reduce(
    (sum, def) => sum + def.description.length,
    0
  );

  const byCategory: Record<string, number> = {};
  const byPriority: Record<string, number> = {};
  const bySubcategory: Record<string, number> = {};

  for (const def of definitions) {
    byCategory[def.category] = (byCategory[def.category] || 0) + 1;
    const priority = def.priority || 'normal';
    byPriority[priority] = (byPriority[priority] || 0) + 1;
    if (def.subcategory) {
      bySubcategory[def.subcategory] = (bySubcategory[def.subcategory] || 0) + 1;
    }
  }

  return {
    totalTools: definitions.length,
    descriptionLength,
    estimatedTokens: Math.ceil(descriptionLength / 4),
    byCategory,
    byPriority,
    bySubcategory,
  };
}
```

### 2. –û–±–Ω–æ–≤–∏—Ç—å ListToolsRequest handler

**–§–∞–π–ª:** `packages/servers/yandex-tracker/src/index.ts` (—Å—Ç—Ä–æ–∫–∏ 65-100)

- [ ] –ü–æ–ª—É—á–∏—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ—Ç ToolRegistry
- [ ] –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏ —á–µ—Ä–µ–∑ `calculateToolsMetrics()`
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –±–∞–∑–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é (info level)
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (debug level)

**–ü—Ä–∏–º–µ—Ä –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:**
```typescript
server.setRequestHandler(ListToolsRequestSchema, () => {
  logger.info(`üìã –ó–∞–ø—Ä–æ—Å tools/list –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞`);

  const definitions = toolRegistry.getDefinitionsByMode(
    config.toolDiscoveryMode,
    config.essentialTools
  );

  const metrics = calculateToolsMetrics(definitions);

  // Info level: –±–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
  logger.info(
    `‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ–º ${metrics.totalTools} –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (—Ä–µ–∂–∏–º: ${config.toolDiscoveryMode})`,
    {
      totalTools: metrics.totalTools,
      mode: config.toolDiscoveryMode,
      descriptionLength: metrics.descriptionLength,
      estimatedTokens: metrics.estimatedTokens,
    }
  );

  // Debug level: –¥–µ—Ç–∞–ª—å–Ω–∞—è —Ä–∞–∑–±–∏–≤–∫–∞
  logger.debug('üìä –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤', {
    byCategory: metrics.byCategory,
    byPriority: metrics.byPriority,
    bySubcategory: metrics.bySubcategory,
  });

  // –ü–æ—Ä—è–¥–æ–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏)
  logger.debug('üî¢ –ü–æ—Ä—è–¥–æ–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤:', {
    order: definitions.map(d => ({
      name: d.name,
      category: d.category,
      priority: d.priority || 'normal',
    })),
  });

  return {
    tools: definitions.map((def) => ({
      name: def.name,
      description: def.description,
      inputSchema: def.inputSchema,
    })),
  };
});
```

### 3. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

**–§–∞–π–ª:** `packages/servers/yandex-tracker/src/index.ts`

- [ ] –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –µ—Å–ª–∏ `eager` mode –∏ –º–Ω–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- [ ] –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –µ—Å–ª–∏ descriptions —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–µ

**–ü—Ä–∏–º–µ—Ä:**
```typescript
// –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ lazy mode
if (config.toolDiscoveryMode === 'eager' && metrics.totalTools > 30) {
  logger.warn('‚ö†Ô∏è  –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –º–Ω–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –≤ eager mode', {
    totalTools: metrics.totalTools,
    estimatedTokens: metrics.estimatedTokens,
    recommendation: '–†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ TOOL_DISCOVERY_MODE=lazy –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞',
  });
}

// –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –±–æ–ª—å—à–∏—Ö descriptions
if (metrics.estimatedTokens > 200) {
  logger.warn('‚ö†Ô∏è  Descriptions –∑–∞–Ω–∏–º–∞—é—Ç –º–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–æ–≤', {
    estimatedTokens: metrics.estimatedTokens,
    recommendation: '–°–æ–∫—Ä–∞—Ç–∏—Ç–µ descriptions –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ LLM',
  });
}
```

### 4. –¢–µ—Å—Ç—ã

**–§–∞–π–ª:** `packages/servers/yandex-tracker/tests/mcp/index.test.ts` (—Å–æ–∑–¥–∞—Ç—å –µ—Å–ª–∏ –Ω–µ—Ç)

- [ ] –¢–µ—Å—Ç: `calculateToolsMetrics()` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏
- [ ] –¢–µ—Å—Ç: –º–µ—Ç—Ä–∏–∫–∏ –≤–∫–ª—é—á–∞—é—Ç –≤—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- [ ] –¢–µ—Å—Ç: –º–µ—Ç—Ä–∏–∫–∏ –≤–∫–ª—é—á–∞—é—Ç –≤—Å–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã
- [ ] –ú–æ–∫ –ª–æ–≥–≥–µ—Ä–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—ã–∑–æ–≤–æ–≤

### 5. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç

- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä –ª–æ–∫–∞–ª—å–Ω–æ
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –ø—Ä–∏ `tools/list` –∑–∞–ø—Ä–æ—Å–µ
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –º–µ—Ç—Ä–∏–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø–æ—Ä—è–¥–æ–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç priority

**–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
```bash
# –í –æ–¥–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
npm run start:server --workspace=mcp-server-yandex-tracker

# –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
node packages/servers/yandex-tracker/scripts/test-tools-list.mjs
```

### 6. –í–∞–ª–∏–¥–∞—Ü–∏—è

- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å `npm run test --workspace=mcp-server-yandex-tracker`
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å `npm run build --workspace=mcp-server-yandex-tracker`
- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

---

## –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ –§—É–Ω–∫—Ü–∏—è `calculateToolsMetrics()` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ `tools/list`
‚úÖ –ú–µ—Ç—Ä–∏–∫–∏: total, size, categories, priorities
‚úÖ –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
‚úÖ –¢–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç –º–µ—Ç—Ä–∏–∫–∏
‚úÖ –õ–æ–≥–∏ —á–∏—Ç–∞–µ–º—ã –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã

---

## –ü—Ä–∏–º–µ—Ä –ª–æ–≥–∞ (–æ–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥)

```
[INFO] üìã –ó–∞–ø—Ä–æ—Å tools/list –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞
[INFO] ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ–º 11 –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (—Ä–µ–∂–∏–º: eager) {
  totalTools: 11,
  mode: 'eager',
  descriptionLength: 450,
  estimatedTokens: 113
}
[DEBUG] üìä –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ {
  byCategory: { issues: 8, helpers: 2, system: 1 },
  byPriority: { critical: 5, high: 3, normal: 2, low: 1 },
  bySubcategory: { read: 3, write: 2, workflow: 2, url: 1, demo: 1, health: 1 }
}
[DEBUG] üî¢ –ü–æ—Ä—è–¥–æ–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤: [
  { name: 'create_issue', category: 'issues', priority: 'critical' },
  { name: 'find_issues', category: 'issues', priority: 'critical' },
  { name: 'get_issues', category: 'issues', priority: 'critical' },
  ...
]
```

---

## –°–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø

‚Üí **4.1_documentation.md** ‚Äî –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å best practices
