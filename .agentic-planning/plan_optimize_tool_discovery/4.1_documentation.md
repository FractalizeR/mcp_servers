# Этап 4.1: Документация Best Practices

**Цель:** Задокументировать систему категоризации, приоритетов и best practices для новых инструментов

**Затронутые файлы:**
- `packages/servers/yandex-tracker/src/tools/README.md`
- `packages/framework/core/README.md`

**Время:** 1 час

**Зависимости:** Требует завершения всех предыдущих этапов

---

## Чек-лист задач

### 1. Обновить Tools README

**Файл:** `packages/servers/yandex-tracker/src/tools/README.md`

- [ ] Добавить секцию "Категоризация инструментов"
- [ ] Документировать систему categories
- [ ] Документировать систему priorities
- [ ] Документировать naming convention для descriptions
- [ ] Добавить таблицу существующих категорий
- [ ] Добавить примеры для каждой категории

**Структура секции:**

```markdown
## Категоризация инструментов

### Обязательные метаданные

Каждый инструмент ДОЛЖЕН иметь:
- `category` (обязательно) — основная категория
- `subcategory` (опционально) — подкатегория
- `priority` (опционально, default: 'normal') — приоритет
- `tags` (опционально) — теги для поиска

### Категории

| Category | Описание | Примеры subcategories |
|----------|----------|----------------------|
| `issues` | Работа с задачами | `read`, `write`, `workflow` |
| `helpers` | Вспомогательные инструменты | `url`, `demo`, `utils` |
| `system` | Системные инструменты | `health`, `config` |

### Приоритеты

| Priority | Когда использовать | Примеры |
|----------|-------------------|---------|
| `critical` | Частое использование, критичные операции | create_issue, find_issues, get_issues |
| `high` | Важные, но не критичные операции | transitions, changelog |
| `normal` | Обычные операции | helpers, utilities |
| `low` | Редкое использование, демо | demo, debug tools |

**Порядок в tools/list:** critical → high → normal → low → алфавит

### Description Convention

Формат: `[Category/Subcategory] Краткое описание`

**Правила:**
- Префикс категории в квадратных скобках
- Краткое описание (≤60 символов)
- Без упоминания "Яндекс.Трекер" (и так понятно)
- Без дублирования информации из названия

**Примеры:**
```typescript
✅ '[Issues/Write] Создать задачу'
✅ '[Issues/Read] Найти задачи по фильтру'
✅ '[Helpers/URL] Получить ссылку на задачу'

❌ 'Создать новую задачу в Яндекс.Трекере' // Нет префикса, многословно
❌ '[Issues/Write] Создание новых задач с поддержкой...' // Слишком длинно
```

### Чек-лист для нового инструмента

При создании нового tool:
- [ ] Определить `category` из существующих или создать новую
- [ ] Определить `subcategory` (read/write/workflow/etc)
- [ ] Определить `priority` на основе частоты использования
- [ ] Добавить `tags` для поиска (3-5 тегов)
- [ ] Написать краткий `description` с префиксом категории
- [ ] Проверить length: `description.length ≤ 80`
- [ ] Добавить подробное описание параметров в `inputSchema`
```

### 2. Обновить Core README

**Файл:** `packages/framework/core/README.md`

- [ ] Добавить документацию `ToolMetadata` с новыми полями
- [ ] Объяснить систему категоризации
- [ ] Объяснить сортировку по priority
- [ ] Добавить примеры использования

**Добавить секцию:**

```markdown
## Tool Metadata

### Расширенные метаданные (v2.1+)

С версии 2.1 ToolMetadata поддерживает категоризацию и приоритеты:

```typescript
interface ToolMetadata {
  name: string;
  description: string;
  inputSchema: JSONSchema;

  // Категоризация и организация
  category: string;              // Основная категория
  subcategory?: string;          // Подкатегория (опционально)
  priority?: 'critical' | 'high' | 'normal' | 'low';  // Приоритет (default: 'normal')
  tags?: readonly string[];      // Теги для поиска
}
```

### Priority-based Sorting

ToolRegistry автоматически сортирует инструменты по priority:

1. **critical** — критичные операции (первыми в списке)
2. **high** — важные операции
3. **normal** — обычные операции
4. **low** — редкие операции (в конце списка)

В рамках одного priority инструменты сортируются по алфавиту (name).

**Цель:** Оптимизация контекста LLM — важные инструменты в начале.

### Категоризация

**category** и **subcategory** используются для:
- Структурирования descriptions (`[Category/Subcategory] ...`)
- Улучшения поиска через SearchToolsTool
- Группировки в UI MCP клиентов (если поддерживается)

**Рекомендуемые subcategories:**
- `read` — операции чтения
- `write` — операции записи
- `workflow` — операции workflow
- `search` — операции поиска
```

### 3. Добавить Migration Guide

**Файл:** `packages/servers/yandex-tracker/MIGRATION.md` (секция)

- [ ] Добавить секцию "Metadata Updates (v2.1)"
- [ ] Объяснить breaking changes (category обязательное)
- [ ] Показать как обновить существующие tools

**Пример секции:**

```markdown
## Metadata Updates (v2.1)

### Breaking Changes

`ToolMetadata` теперь требует обязательное поле `category`:

```typescript
// ❌ Старый код (не скомпилируется)
static readonly METADATA = {
  name: 'my_tool',
  description: 'My tool',
  inputSchema: { ... }
};

// ✅ Новый код
static readonly METADATA = {
  name: 'my_tool',
  description: '[MyCategory] My tool',
  category: 'my_category',
  subcategory: 'read',       // опционально
  priority: 'normal',         // опционально (default)
  tags: ['tag1', 'tag2'],    // опционально
  inputSchema: { ... }
};
```

### Migration Steps

1. Добавить `category` во все tools
2. Опционально добавить `subcategory`, `priority`, `tags`
3. Обновить `description` с префиксом категории
4. Запустить `npm run typecheck` для проверки
```

### 4. Обновить CLAUDE.md

**Файл:** `packages/servers/yandex-tracker/CLAUDE.md`

- [ ] Добавить правило про обязательные метаданные в секцию "MCP Tools"
- [ ] Ссылка на Tools README для деталей

**Добавить в секцию MCP Tools:**

```markdown
### Метаданные инструментов (обязательно)

При создании нового tool:
- ✅ Указать `category` (обязательно)
- ✅ Указать `priority` на основе частоты использования
- ✅ Использовать формат description: `[Category/Subcategory] Краткое описание`
- ✅ Проверить длину: `description.length ≤ 80`

Подробности: [src/tools/README.md](src/tools/README.md#категоризация-инструментов)
```

### 5. Валидация документации

- [ ] Проверить все ссылки работают
- [ ] Проверить примеры кода корректны
- [ ] Проверить таблицы отформатированы
- [ ] Запустить `npm run validate:docs` (если есть)

---

## Ожидаемый результат

✅ Полная документация системы категоризации
✅ Best practices для новых инструментов
✅ Migration guide для обновления
✅ Обновлён CLAUDE.md с правилами
✅ Примеры и чек-листы для разработчиков

---

## Следующий этап

→ **4.2_tests.md** — тесты для новой функциональности
