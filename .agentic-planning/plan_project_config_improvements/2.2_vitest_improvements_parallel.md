# 2.2 –£–ª—É—á—à–µ–Ω–∏–µ Vitest –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (PARALLEL)

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –í—ã—Å–æ–∫–∏–π
**–†–µ–∂–∏–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** –ü–ê–†–ê–õ–õ–ï–õ–¨–ù–û (–º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–º –∞–≥–µ–Ω—Ç–æ–º)
**–†–∞—Å—á–µ—Ç–Ω–æ–µ –≤—Ä–µ–º—è:** 45-60 –º–∏–Ω—É—Ç

---

## –¶–µ–ª—å

–ú–æ–¥–µ—Ä–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å Vitest –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è monorepo –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å best practices 2025:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `vitest.workspace.ts` –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ monorepo
- –°–æ–∑–¥–∞—Ç—å `vitest.shared.ts` –¥–ª—è –æ–±—â–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å coverage –Ω–∞ –∫–æ—Ä–Ω–µ–≤–æ–º —É—Ä–æ–≤–Ω–µ
- –£—Å—Ç—Ä–∞–Ω–∏—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ alias –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

---

## –ó–∞–¥–∞—á–∏

### 2.2.1 –°–æ–∑–¥–∞—Ç—å vitest.workspace.ts

**–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª:** `vitest.workspace.ts` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞

```typescript
import { defineWorkspace } from 'vitest/config';

/**
 * Vitest Workspace Configuration –¥–ª—è Monorepo
 *
 * –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≤—Å–µ –ø–∞–∫–µ—Ç—ã –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.
 * Coverage –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –∫–æ—Ä–Ω–µ–≤–æ–º —É—Ä–æ–≤–Ω–µ.
 *
 * @see https://vitest.dev/guide/workspace
 */
export default defineWorkspace([
  // Framework packages
  'packages/framework/infrastructure',
  'packages/framework/core',
  'packages/framework/search',

  // Server packages
  'packages/servers/yandex-tracker',
]);
```

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**
- Best practice 2025: workspace –¥–ª—è monorepo
- Vitest –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–∞—Ä—É–∂–∏—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤ –∫–∞–∂–¥–æ–º –ø–∞–∫–µ—Ç–µ
- Unified coverage reporting
- –ë—ã—Å—Ç—Ä–µ–µ, —á–µ–º –∑–∞–ø—É—Å–∫–∞—Ç—å —Ç–µ—Å—Ç—ã —á–µ—Ä–µ–∑ npm workspaces

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
npx vitest --workspace
```

### 2.2.2 –°–æ–∑–¥–∞—Ç—å vitest.shared.ts

**–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª:** `vitest.shared.ts` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞

```typescript
import type { UserConfig } from 'vitest/config';

/**
 * Shared Vitest Configuration
 *
 * –û–±—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –≤—Å–µ—Ö –ø–∞–∫–µ—Ç–æ–≤ –≤ monorepo.
 * –ö–∞–∂–¥—ã–π –ø–∞–∫–µ—Ç –º–æ–∂–µ—Ç —Ä–∞—Å—à–∏—Ä–∏—Ç—å —ç—Ç—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ —Å–≤–æ–π vitest.config.ts
 */
export const sharedConfig: UserConfig = {
  test: {
    globals: true,
    environment: 'node',

    // –û–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –≤—Å–µ—Ö –ø–∞–∫–µ—Ç–æ–≤
    testTimeout: 10000,
    hookTimeout: 10000,

    // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ include/exclude
    include: ['tests/**/*.test.ts', 'tests/**/*.spec.ts'],
    exclude: ['**/node_modules/**', '**/dist/**', '**/.{git,cache,output,temp}/**'],

    // Coverage –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –Ω–∞ –∫–æ—Ä–Ω–µ–≤–æ–º —É—Ä–æ–≤–Ω–µ)
    coverage: {
      provider: 'v8',
      reporter: ['text', 'json', 'html', 'lcov'],
      exclude: [
        '**/node_modules/**',
        '**/dist/**',
        '**/*.test.ts',
        '**/*.spec.ts',
        '**/index.ts',
        '**/*.config.{ts,js,mjs}',
        '**/tests/**',
        '**/scripts/**',
      ],
      thresholds: {
        lines: 90,
        functions: 90,
        branches: 85,
        statements: 90,
      },
    },
  },
};
```

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**
- DRY: –∏–∑–±–µ–≥–∞–µ–º –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –º–µ–∂–¥—É –ø–∞–∫–µ—Ç–∞–º–∏
- –õ–µ–≥–∫–æ –æ–±–Ω–æ–≤–ª—è—Ç—å –æ–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### 2.2.3 –û–±–Ω–æ–≤–∏—Ç—å –∫–æ—Ä–Ω–µ–≤–æ–π vitest.config.ts

**–ó–∞–º–µ–Ω–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ:** `vitest.config.ts`

```typescript
import { defineConfig, mergeConfig } from 'vitest/config';
import { sharedConfig } from './vitest.shared';

/**
 * –ö–æ—Ä–Ω–µ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Vitest –¥–ª—è monorepo
 *
 * –ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ workspace, –∫–æ—Ä–Ω–µ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤–ª–∏—è–µ—Ç —Ç–æ–ª—å–∫–æ
 * –Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏ (reporters, coverage).
 *
 * –¢–µ—Å—Ç—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ workspace packages.
 */
export default mergeConfig(
  sharedConfig,
  defineConfig({
    test: {
      // –ö–æ—Ä–Ω–µ–≤–æ–π —É—Ä–æ–≤–µ–Ω—å –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ—Å—Ç–æ–≤
      include: [],
      exclude: ['**/node_modules/**', '**/dist/**', '**/packages/**'],

      // Coverage –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç—Å—è –∑–¥–µ—Å—å
      coverage: {
        // –í–∫–ª—é—á–∞–µ–º –≤—Å–µ packages –≤ coverage
        include: ['packages/**/src/**/*.ts'],

        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ reporters –¥–ª—è CI/CD
        reporter: ['text', 'json', 'html', 'lcov', 'text-summary'],

        // –ë–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∏–µ –ø–æ—Ä–æ–≥–∏ –Ω–∞ –∫–æ—Ä–Ω–µ–≤–æ–º —É—Ä–æ–≤–Ω–µ
        thresholds: {
          lines: 90,
          functions: 90,
          branches: 85,
          statements: 90,
          // –î–ª—è CI: –ø—Ä–µ—Ä—ã–≤–∞—Ç—å build –ø—Ä–∏ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏
          autoUpdate: false,
          perFile: false,
        },
      },

      // Reporters –¥–ª—è –≤—Å–µ–≥–æ monorepo
      reporters: ['default', 'verbose'],
    },
  })
);
```

### 2.2.4 –û–±–Ω–æ–≤–∏—Ç—å vitest.config.ts –≤ packages

**–î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–∞–∫–µ—Ç–∞** (infrastructure, core, search, yandex-tracker):

**–ü—Ä–∏–º–µ—Ä –¥–ª—è infrastructure:**

```typescript
import { defineConfig, mergeConfig } from 'vitest/config';
import { sharedConfig } from '../../../vitest.shared';

export default mergeConfig(
  sharedConfig,
  defineConfig({
    test: {
      // Package-specific –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω—ã)
      name: 'infrastructure',
    },
  })
);
```

**–î–ª—è yandex-tracker** (—Å alias):

```typescript
import { defineConfig, mergeConfig } from 'vitest/config';
import path from 'node:path';
import { sharedConfig } from '../../../vitest.shared';

export default mergeConfig(
  sharedConfig,
  defineConfig({
    test: {
      name: 'yandex-tracker',
    },
    resolve: {
      alias: {
        '@tracker_api': path.resolve(__dirname, './src/tracker_api'),
        '@tools': path.resolve(__dirname, './src/tools'),
        '@composition-root': path.resolve(__dirname, './src/composition-root'),
        '@cli': path.resolve(__dirname, './src/cli'),
        '@constants': path.resolve(__dirname, './src/constants'),
        '@integration': path.resolve(__dirname, './tests/integration'),
        '@mcp-framework/search': path.resolve(__dirname, '../../framework/search/src'),
        '@mcp-framework/core': path.resolve(__dirname, '../../framework/core/src'),
        '@mcp-framework/infrastructure': path.resolve(
          __dirname,
          '../../framework/infrastructure/src'
        ),
      },
    },
  })
);
```

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑—É–µ–º `mergeConfig` –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è shared –∏ package-specific –Ω–∞—Å—Ç—Ä–æ–µ–∫
- –ú–∏–Ω–∏–º—É–º –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
- –ö–∞–∂–¥—ã–π –ø–∞–∫–µ—Ç –º–æ–∂–µ—Ç –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –Ω—É–∂–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### 2.2.5 –û–±–Ω–æ–≤–∏—Ç—å package.json —Å–∫—Ä–∏–ø—Ç—ã

**–í –∫–æ—Ä–Ω–µ–≤–æ–º package.json –æ–±–Ω–æ–≤–∏—Ç—å:**

```json
{
  "scripts": {
    "test": "vitest run --workspace",
    "test:coverage": "vitest run --workspace --coverage",
    "test:quiet": "vitest run --workspace --reporter=dot --silent",
    "test:verbose": "vitest run --workspace --reporter=verbose",
    "test:watch": "vitest watch --workspace",
    "test:ui": "vitest --ui --workspace --coverage"
  }
}
```

**–í –∫–∞–∂–¥–æ–º package.json –æ—Å—Ç–∞–≤–∏—Ç—å –ø—Ä–µ–∂–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç—ã** (–æ–Ω–∏ –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ):

```json
{
  "scripts": {
    "test": "vitest run",
    "test:coverage": "vitest run --coverage",
    "test:quiet": "vitest run --reporter=dot --silent",
    "test:verbose": "vitest run --reporter=verbose",
    "test:watch": "vitest watch"
  }
}
```

### 2.2.6 –£–¥–∞–ª–∏—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ coverage –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** Coverage –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è –≤ –∫–∞–∂–¥–æ–º –ø–∞–∫–µ—Ç–µ

**–†–µ—à–µ–Ω–∏–µ:** –ü–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –≤ `vitest.shared.ts` (—É–∂–µ —Å–¥–µ–ª–∞–Ω–æ –≤ 2.2.2)

---

## –ß–µ–∫-–ª–∏—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

- [x] 2.2.1 –°–æ–∑–¥–∞—Ç—å vitest.workspace.ts
- [x] 2.2.2 –°–æ–∑–¥–∞—Ç—å vitest.shared.ts
- [x] 2.2.3 –û–±–Ω–æ–≤–∏—Ç—å –∫–æ—Ä–Ω–µ–≤–æ–π vitest.config.ts
- [x] 2.2.4 –û–±–Ω–æ–≤–∏—Ç—å vitest.config.ts –≤ –∫–∞–∂–¥–æ–º –ø–∞–∫–µ—Ç–µ (4 —Ñ–∞–π–ª–∞)
- [x] 2.2.5 –û–±–Ω–æ–≤–∏—Ç—å package.json —Å–∫—Ä–∏–ø—Ç—ã
- [x] 2.2.6 –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
- [x] –ó–∞–ø—É—Å—Ç–∏—Ç—å `npm test` - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É (401/402 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—à–ª–∏, 99.8%)
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å `npm run test:coverage` - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å coverage (–Ω–µ –∑–∞–ø—É—Å–∫–∞–ª–∏)
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å `npm run test:ui` - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å UI (–Ω–µ –∑–∞–ø—É—Å–∫–∞–ª–∏)
- [x] –ó–∞–ø—É—Å—Ç–∏—Ç—å `npm run validate:quiet`
- [ ] –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å: `build: modernize Vitest config with workspace support`

---

## –ü—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞:** Coverage –º–æ–∂–µ—Ç –Ω–µ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞—Ç—å—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `--coverage.all` —Ñ–ª–∞–≥: `vitest run --workspace --coverage --coverage.all`

**–ü—Ä–æ–±–ª–µ–º–∞:** Alias –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç –≤ —Ç–µ—Å—Ç–∞—Ö
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å resolve.alias –≤ vitest.config.ts –∫–∞–∂–¥–æ–≥–æ –ø–∞–∫–µ—Ç–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** Tests timeout
**–†–µ—à–µ–Ω–∏–µ:** –£–≤–µ–ª–∏—á–∏—Ç—å `testTimeout` –≤ vitest.shared.ts

**–ü—Ä–æ–±–ª–µ–º–∞:** Workspace –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç —Ç–µ—Å—Ç—ã
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤ –∫–∞–∂–¥–æ–º –ø–∞–∫–µ—Ç–µ –µ—Å—Ç—å vitest.config.ts
