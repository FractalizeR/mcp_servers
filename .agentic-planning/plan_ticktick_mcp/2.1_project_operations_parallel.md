# Этап 2.1: Project Operations (parallel)

**Тип выполнения:** parallel (можно выполнять параллельно с 2.2)
**Причина:** Независимые операции, нет взаимных зависимостей
**Зависимости:** Этап 1.2 завершён

---

## Задачи

### 2.1.1. Создать Project entity
- [ ] Интерфейс Project с unknown полями (для гибкости API)

```typescript
// src/ticktick_api/entities/project.entity.ts
export interface Project {
  id: string;
  name: string;
  color?: string;
  viewMode?: 'list' | 'kanban' | 'timeline';
  kind?: 'TASK' | 'NOTE';
  groupId?: string;
  sortOrder?: number;
  closed?: boolean;
  modifiedTime?: string;
}

// С unknown полями для фильтрации
export interface ProjectWithUnknownFields extends Project {
  [key: string]: unknown;
}
```

### 2.1.2. Создать Project DTOs
- [ ] CreateProjectDto
- [ ] UpdateProjectDto

```typescript
// src/ticktick_api/dto/project.dto.ts
export interface CreateProjectDto {
  name: string;
  color?: string;
  viewMode?: 'list' | 'kanban' | 'timeline';
  kind?: 'TASK' | 'NOTE';
  groupId?: string;
}

export interface UpdateProjectDto {
  name?: string;
  color?: string;
  viewMode?: 'list' | 'kanban' | 'timeline';
  closed?: boolean;
}
```

### 2.1.3. GetProjectsOperation
- [ ] GET /project — все проекты
- [ ] Кеширование результата

```typescript
// src/ticktick_api/api_operations/projects/get-projects.operation.ts
import { BaseOperation } from '@mcp-framework/infrastructure';
import type { ProjectWithUnknownFields } from '#ticktick_api/entities/project.entity.js';

export class GetProjectsOperation extends BaseOperation {
  async execute(): Promise<ProjectWithUnknownFields[]> {
    const cacheKey = 'projects:all';

    return this.withCache(cacheKey, async () => {
      return this.httpClient.get<ProjectWithUnknownFields[]>('/project');
    });
  }
}
```

### 2.1.4. GetProjectOperation
- [ ] GET /project/{projectId}

```typescript
// src/ticktick_api/api_operations/projects/get-project.operation.ts
export class GetProjectOperation extends BaseOperation {
  async execute(projectId: string): Promise<ProjectWithUnknownFields> {
    const cacheKey = `project:${projectId}`;

    return this.withCache(cacheKey, async () => {
      return this.httpClient.get<ProjectWithUnknownFields>(`/project/${projectId}`);
    });
  }
}
```

### 2.1.5. GetProjectDataOperation
- [ ] GET /project/{projectId}/data — проект со всеми задачами

```typescript
// src/ticktick_api/api_operations/projects/get-project-data.operation.ts
import type { ProjectWithUnknownFields } from '#ticktick_api/entities/project.entity.js';
import type { TaskWithUnknownFields } from '#ticktick_api/entities/task.entity.js';

export interface ProjectData {
  project: ProjectWithUnknownFields;
  tasks: TaskWithUnknownFields[];
}

export class GetProjectDataOperation extends BaseOperation {
  async execute(projectId: string): Promise<ProjectData> {
    const cacheKey = `project:${projectId}:data`;

    return this.withCache(cacheKey, async () => {
      return this.httpClient.get<ProjectData>(`/project/${projectId}/data`);
    });
  }
}
```

### 2.1.6. CreateProjectOperation
- [ ] POST /project

```typescript
// src/ticktick_api/api_operations/projects/create-project.operation.ts
import type { CreateProjectDto } from '#ticktick_api/dto/project.dto.js';

export class CreateProjectOperation extends BaseOperation {
  async execute(dto: CreateProjectDto): Promise<ProjectWithUnknownFields> {
    const result = await this.httpClient.post<ProjectWithUnknownFields>('/project', dto);

    // Инвалидация кеша списка проектов
    this.cacheManager.delete('projects:all');

    return result;
  }
}
```

### 2.1.7. UpdateProjectOperation
- [ ] POST /project/{projectId}

```typescript
// src/ticktick_api/api_operations/projects/update-project.operation.ts
import type { UpdateProjectDto } from '#ticktick_api/dto/project.dto.js';

export class UpdateProjectOperation extends BaseOperation {
  async execute(projectId: string, dto: UpdateProjectDto): Promise<ProjectWithUnknownFields> {
    const result = await this.httpClient.post<ProjectWithUnknownFields>(
      `/project/${projectId}`,
      dto
    );

    // Инвалидация кеша
    this.cacheManager.delete(`project:${projectId}`);
    this.cacheManager.delete(`project:${projectId}:data`);
    this.cacheManager.delete('projects:all');

    return result;
  }
}
```

### 2.1.8. DeleteProjectOperation
- [ ] DELETE /project/{projectId}

```typescript
// src/ticktick_api/api_operations/projects/delete-project.operation.ts
export class DeleteProjectOperation extends BaseOperation {
  async execute(projectId: string): Promise<void> {
    await this.httpClient.delete(`/project/${projectId}`);

    // Инвалидация кеша
    this.cacheManager.delete(`project:${projectId}`);
    this.cacheManager.delete(`project:${projectId}:data`);
    this.cacheManager.delete('projects:all');
  }
}
```

### 2.1.9. Создать index.ts для экспорта
- [ ] Экспорт всех operations

```typescript
// src/ticktick_api/api_operations/projects/index.ts
export * from './get-projects.operation.js';
export * from './get-project.operation.js';
export * from './get-project-data.operation.js';
export * from './create-project.operation.js';
export * from './update-project.operation.js';
export * from './delete-project.operation.js';
```

---

## Валидация

```bash
npm run typecheck
npm run lint
```

---

## Чек-лист завершения

- [ ] Project entity создан с unknown fields
- [ ] DTOs созданы (Create, Update)
- [ ] 6 operations созданы и работают с кешем
- [ ] Index.ts экспортирует все operations
- [ ] `npm run typecheck` проходит
