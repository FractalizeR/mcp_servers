# 7.2 Обновление зависимостей в monorepo

**Тип:** Sequential
**Зависимости:** 7.1 Интеграционное тестирование
**Время:** ~30 минут

---

## Задача

Финализировать зависимости, обновить lock файлы и проверить что все пакеты синхронизированы.

---

## Действия

### 1. Обновить package-lock.json

```bash
cd <корень monorepo>

# Удалить старые lock файлы
rm -rf package-lock.json
rm -rf node_modules
rm -rf packages/*/node_modules

# Чистая установка
npm install
```

### 2. Проверить версии зависимостей

**Убедиться, что используются актуальные версии:**

```bash
npm outdated
```

**Если есть критические обновления** — обновить, но осторожно:
```bash
npm update
```

### 3. Проверить peer dependencies

**Особенно для framework/cli:**
- inquirer
- chalk
- ora
- commander

**Версии должны быть совместимы** с другими пакетами monorepo.

### 4. Синхронизировать devDependencies

**Проверить, что все framework пакеты используют одинаковые версии:**
- typescript
- vitest
- eslint
- prettier

**Если версии отличаются** — синхронизировать.

### 5. Проверить workspace: protocol

**В yandex-tracker package.json:**
```json
{
  "dependencies": {
    "@mcp-framework/cli": "workspace:*",
    "@mcp-framework/core": "workspace:*",
    "@mcp-framework/infrastructure": "workspace:*",
    "@mcp-framework/search": "workspace:*"
  }
}
```

**В framework/cli package.json:**
```json
{
  "dependencies": {
    "@mcp-framework/infrastructure": "workspace:*"
  }
}
```

### 6. Запустить сборку через Turborepo

```bash
npm run build
```

**Ожидаемый результат:**
- Turborepo собирает в правильном порядке
- Кэш работает (повторный запуск ~1-2 сек)
- Нет ошибок сборки

### 7. Проверить bundle size (опционально)

**Для framework/cli проверить размер:**
```bash
cd packages/framework/cli
du -sh dist/
```

**Типичный размер:** ~100-200 KB для CLI пакета

---

## Результат

- [ ] package-lock.json обновлен
- [ ] Все зависимости синхронизированы
- [ ] Версии devDependencies одинаковые
- [ ] workspace: protocol используется
- [ ] `npm install` проходит без ошибок
- [ ] `npm run build` проходит

---

## Критерии готовности

- [ ] Lock файл актуален
- [ ] Нет конфликтов зависимостей
- [ ] Версии синхронизированы
- [ ] Turborepo работает корректно
