# 5.2 Обновление зависимостей

**Тип:** Sequential
**Зависимости:** 5.1 YT адаптер
**Время:** ~30 минут

---

## Задача

Обновить зависимости в framework/cli пакете и добавить его в граф зависимостей monorepo.

---

## Действия

### 1. Проверить package.json framework/cli

**Файл:** `packages/framework/cli/package.json`

**Обязательные зависимости:**
```json
{
  "dependencies": {
    "@mcp-framework/infrastructure": "workspace:*",
    "inquirer": "^10.0.0",
    "chalk": "^5.3.0",
    "ora": "^8.0.0",
    "commander": "^12.0.0"
  },
  "devDependencies": {
    "@types/inquirer": "^9.0.0",
    "vitest": "^2.0.0",
    "typescript": "^5.6.0",
    "eslint": "^9.0.0",
    "prettier": "^3.0.0"
  }
}
```

**ВАЖНО:** CLI зависит ТОЛЬКО от `infrastructure`, не от `core` или `search`.

### 2. Обновить .dependency-cruiser.cjs

**Файл:** `.dependency-cruiser.cjs`

**Добавить правила для CLI:**
```javascript
{
  name: 'cli-only-depends-on-infrastructure',
  severity: 'error',
  from: { path: '^packages/framework/cli' },
  to: {
    path: '^packages/framework',
    pathNot: [
      '^packages/framework/infrastructure',
      '^packages/framework/cli'
    ]
  },
  comment: 'CLI может зависеть только от infrastructure пакета'
},
{
  name: 'no-circular-cli',
  severity: 'error',
  from: { path: '^packages/framework/(infrastructure|core|search)' },
  to: { path: '^packages/framework/cli' },
  comment: 'Framework пакеты не должны зависеть от CLI'
}
```

### 3. Проверить граф зависимостей

```bash
npm run depcruise
```

**Ожидаемый результат:** Нет ошибок

**Ожидаемый граф:**
```
infrastructure (0 deps)
    ↓
    ├─→ core
    │      ↓
    │   search
    │
    └─→ cli
         ↓
     yandex-tracker (deps: infrastructure, core, search, cli)
```

### 4. Обновить turbo.json (если нужно)

**Файл:** `turbo.json`

**Убедиться, что CLI в pipeline:**
```json
{
  "pipeline": {
    "build": {
      "dependsOn": ["^build"],
      "outputs": ["dist/**"]
    },
    "test": {
      "dependsOn": ["^build"]
    }
  }
}
```

Turbo автоматически определит порядок через package.json зависимости.

### 5. Запустить полную сборку

```bash
# Очистить все
npm run clean

# Установить зависимости
npm install

# Собрать все пакеты (Turborepo обеспечит правильный порядок)
npm run build

# Запустить тесты
npm test

# Проверить весь граф
npm run depcruise
```

---

## Результат

- [ ] package.json framework/cli корректен
- [ ] dependency-cruiser правила обновлены
- [ ] `npm run depcruise` проходит
- [ ] `npm run build` проходит во всех пакетах
- [ ] `npm test` проходит
- [ ] Граф зависимостей валиден

---

## Критерии готовности

- [ ] CLI зависит только от infrastructure
- [ ] Нет циклических зависимостей
- [ ] Все пакеты собираются в правильном порядке
- [ ] Тесты проходят во всех пакетах
