# 4.1 –ë–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã (status, list, disconnect)

**–¢–∏–ø:** Sequential
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –≠—Ç–∞–ø 3 (–≤—Å–µ)
**–í—Ä–µ–º—è:** ~1 —á–∞—Å

---

## –ó–∞–¥–∞—á–∞

–ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –∏ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –±–∞–∑–æ–≤—ã–µ CLI –∫–æ–º–∞–Ω–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —Ç—Ä–µ–±—É—é—Ç —Å–ª–æ–∂–Ω–æ–π –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–∏:
- `status` ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
- `list` ‚Äî —Å–ø–∏—Å–æ–∫ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
- `disconnect` ‚Äî –æ—Ç–∫–ª—é—á–∏—Ç—å –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞

---

## –î–µ–π—Å—Ç–≤–∏—è

### 1. –°–æ–∑–¥–∞—Ç—å status –∫–æ–º–∞–Ω–¥—É

**–§–∞–π–ª:** `src/commands/status.command.ts`

```typescript
import type { ConnectorRegistry } from '../connectors/registry.js';
import type { BaseMCPServerConfig } from '../types.js';
import { Logger } from '../utils/logger.js';

export interface StatusCommandOptions<TConfig extends BaseMCPServerConfig> {
  registry: ConnectorRegistry<TConfig>;
}

export async function statusCommand<TConfig extends BaseMCPServerConfig>(
  options: StatusCommandOptions<TConfig>
): Promise<void> {
  const { registry } = options;

  Logger.header('üìä –°—Ç–∞—Ç—É—Å MCP –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π');
  Logger.newLine();

  const statuses = await registry.checkAllStatuses();

  for (const [name, status] of statuses) {
    const connector = registry.get(name);
    if (!connector) continue;

    const info = connector.getClientInfo();
    const isInstalled = await connector.isInstalled();

    if (!isInstalled) {
      Logger.info(`${info.displayName}: ‚ùå –ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω`);
      continue;
    }

    if (status.connected) {
      Logger.success(`${info.displayName}: ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω`);
      if (status.details) {
        Logger.info(`  ‚îî‚îÄ –ö–æ–Ω—Ñ–∏–≥: ${status.details.configPath}`);
      }
    } else {
      Logger.warn(`${info.displayName}: ‚≠ï –ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω`);
    }
  }

  Logger.newLine();
}
```

### 2. –°–æ–∑–¥–∞—Ç—å list –∫–æ–º–∞–Ω–¥—É

**–§–∞–π–ª:** `src/commands/list.command.ts`

```typescript
import type { ConnectorRegistry } from '../connectors/registry.js';
import type { BaseMCPServerConfig } from '../types.js';
import { Logger } from '../utils/logger.js';

export interface ListCommandOptions<TConfig extends BaseMCPServerConfig> {
  registry: ConnectorRegistry<TConfig>;
}

export async function listCommand<TConfig extends BaseMCPServerConfig>(
  options: ListCommandOptions<TConfig>
): Promise<void> {
  const { registry } = options;

  Logger.header('üìã –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ MCP –∫–ª–∏–µ–Ω—Ç—ã');
  Logger.newLine();

  const connectors = registry.getAll();

  for (const connector of connectors) {
    const info = connector.getClientInfo();
    const isInstalled = await connector.isInstalled();

    Logger.info(`‚Ä¢ ${info.displayName}`);
    Logger.info(`  ‚îî‚îÄ ${info.description}`);
    Logger.info(`  ‚îî‚îÄ –ü–ª–∞—Ç—Ñ–æ—Ä–º—ã: ${info.platforms.join(', ')}`);
    Logger.info(`  ‚îî‚îÄ –°—Ç–∞—Ç—É—Å: ${isInstalled ? '‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω' : '‚ùå –ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω'}`);
    Logger.newLine();
  }
}
```

### 3. –°–æ–∑–¥–∞—Ç—å disconnect –∫–æ–º–∞–Ω–¥—É

**–§–∞–π–ª:** `src/commands/disconnect.command.ts`

```typescript
import type { ConnectorRegistry } from '../connectors/registry.js';
import type { BaseMCPServerConfig } from '../types.js';
import { Logger } from '../utils/logger.js';
import { InteractivePrompter } from '../utils/interactive-prompter.js';
import { isError } from '@mcp-framework/infrastructure';

export interface DisconnectCommandOptions<TConfig extends BaseMCPServerConfig> {
  registry: ConnectorRegistry<TConfig>;
  cliOptions?: {
    client?: string;
  };
}

export async function disconnectCommand<TConfig extends BaseMCPServerConfig>(
  options: DisconnectCommandOptions<TConfig>
): Promise<void> {
  const { registry, cliOptions } = options;

  Logger.header('üîå –û—Ç–∫–ª—é—á–µ–Ω–∏–µ MCP —Å–µ—Ä–≤–µ—Ä–∞');
  Logger.newLine();

  // –ù–∞–π—Ç–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã
  const spinner = Logger.spinner('–ü–æ–∏—Å–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤...');
  const statuses = await registry.checkAllStatuses();
  spinner.stop();

  const connectedConnectors = Array.from(statuses.entries())
    .filter(([_, status]) => status.connected)
    .map(([name]) => registry.get(name)!)
    .filter((c) => c !== undefined);

  if (connectedConnectors.length === 0) {
    Logger.warn('–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤');
    return;
  }

  Logger.success(`–ù–∞–π–¥–µ–Ω–æ ${connectedConnectors.length} –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–∞(–æ–≤)`);
  Logger.newLine();

  // –í—ã–±—Ä–∞—Ç—å –∫–ª–∏–µ–Ω—Ç
  let connector;
  if (cliOptions?.client) {
    connector = registry.get(cliOptions.client);
    if (!connector) {
      Logger.error(`–ö–ª–∏–µ–Ω—Ç "${cliOptions.client}" –Ω–µ –Ω–∞–π–¥–µ–Ω`);
      return;
    }

    const status = await connector.getStatus();
    if (!status.connected) {
      Logger.error(`–ö–ª–∏–µ–Ω—Ç "${cliOptions.client}" –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω`);
      return;
    }

    Logger.info(`–í—ã–±—Ä–∞–Ω –∫–ª–∏–µ–Ω—Ç: ${connector.getClientInfo().displayName}`);
  } else {
    const clientInfos = connectedConnectors.map((c) => c.getClientInfo());
    const selectedName = await InteractivePrompter.promptClientSelection(clientInfos);
    connector = registry.get(selectedName);
  }

  if (!connector) {
    Logger.error('–ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã–±—Ä–∞—Ç—å –∫–ª–∏–µ–Ω—Ç');
    return;
  }

  Logger.newLine();

  // –û—Ç–∫–ª—é—á–µ–Ω–∏–µ
  const disconnectSpinner = Logger.spinner(
    `–û—Ç–∫–ª—é—á–∞—é –æ—Ç ${connector.getClientInfo().displayName}...`
  );

  try {
    await connector.disconnect();
    disconnectSpinner.succeed(
      `MCP —Å–µ—Ä–≤–µ—Ä —É—Å–ø–µ—à–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω –æ—Ç ${connector.getClientInfo().displayName}!`
    );
  } catch (error) {
    const errorMessage = isError(error) ? error.message : String(error);
    disconnectSpinner.fail(`–û—à–∏–±–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è: ${errorMessage}`);
    return;
  }

  Logger.newLine();
  Logger.success('‚úÖ –ì–æ—Ç–æ–≤–æ!');
}
```

### 4. –°–æ–∑–¥–∞—Ç—å exports

**–§–∞–π–ª:** `src/commands/index.ts`

```typescript
export * from './status.command.js';
export * from './list.command.js';
export * from './disconnect.command.js';
// connect –∏ validate –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ —Å–ª–µ–¥—É—é—â–∏—Ö —ç—Ç–∞–ø–∞—Ö
```

### 5. –û–±–Ω–æ–≤–∏—Ç—å –≥–ª–∞–≤–Ω—ã–π export

**–§–∞–π–ª:** `src/index.ts`

```typescript
export * from './types.js';
export * from './connectors/index.js';
export * from './commands/index.js';
export * from './utils/index.js';
```

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ë–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –∫–æ–º–∞–Ω–¥:**

```typescript
// tests/unit/commands/status.command.test.ts
import { describe, it, expect, vi } from 'vitest';
import { statusCommand } from '../../../src/commands/status.command.js';
import { ConnectorRegistry } from '../../../src/connectors/registry.js';

describe('statusCommand', () => {
  it('should execute without errors', async () => {
    const registry = new ConnectorRegistry();
    await expect(statusCommand({ registry })).resolves.toBeUndefined();
  });
});

// –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è list –∏ disconnect
```

---

## –†–µ–∑—É–ª—å—Ç–∞—Ç

- [ ] `status.command.ts` —Å–æ–∑–¥–∞–Ω
- [ ] `list.command.ts` —Å–æ–∑–¥–∞–Ω
- [ ] `disconnect.command.ts` —Å–æ–∑–¥–∞–Ω
- [ ] Exports –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] –ë–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã –Ω–∞–ø–∏—Å–∞–Ω—ã
- [ ] `npm run validate` –ø—Ä–æ—Ö–æ–¥–∏—Ç

---

## –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

- [ ] –í—Å–µ 3 –∫–æ–º–∞–Ω–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å generic —Ç–∏–ø–∞–º–∏
- [ ] –ö–æ–º–∞–Ω–¥—ã –Ω–µ –∑–∞–≤–∏—Å—è—Ç –æ—Ç YT —Å–ø–µ—Ü–∏—Ñ–∏–∫–∏
- [ ] –¢–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] –ö–æ–¥ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç lint –ø—Ä–∞–≤–∏–ª–∞–º
