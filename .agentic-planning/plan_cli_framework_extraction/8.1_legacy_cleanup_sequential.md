# 8.1 Legacy Code Cleanup (–ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ rollout)

**–¢–∏–ø:** Sequential
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** 2-4 –Ω–µ–¥–µ–ª–∏ —É—Å–ø–µ—à–Ω–æ–π —Ä–∞–±–æ—Ç—ã framework CLI –≤ production
**–í—Ä–µ–º—è:** ~1 —á–∞—Å
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –ù–ò–ó–ö–ê–Ø ‚Äî –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–µ–ª–∏–∑
**–ö–æ–≥–¥–∞:** –í–µ—Ä—Å–∏—è 4.0.0 (—á–µ—Ä–µ–∑ 6 –Ω–µ–¥–µ–ª—å –ø–æ—Å–ª–µ 3.0.0)

---

## ‚ö†Ô∏è –í–ê–ñ–ù–û

**–ù–ï –≤—ã–ø–æ–ª–Ω—è—Ç—å —ç—Ç–æ—Ç —ç—Ç–∞–ø —Å—Ä–∞–∑—É!**

**–£—Å–ª–æ–≤–∏—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**
1. ‚úÖ Framework CLI —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ production –º–∏–Ω–∏–º—É–º 2-4 –Ω–µ–¥–µ–ª–∏
2. ‚úÖ USE_FRAMEWORK_CLI=true –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–µ–∑–¥–µ
3. ‚úÖ –ù–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –±–∞–≥–æ–≤
4. ‚úÖ –ü–æ–ª—É—á–µ–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π/stakeholders
5. ‚úÖ –ú–µ—Ç—Ä–∏–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å

**–ï—Å–ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ —É—Å–ª–æ–≤–∏–µ –ù–ï –≤—ã–ø–æ–ª–Ω–µ–Ω–æ:** –ù–ï —É–¥–∞–ª—è–π legacy –∫–æ–¥!

---

## –ó–∞–¥–∞—á–∞

–§–∏–Ω–∞–ª—å–Ω–∞—è cleanup ‚Äî —É–¥–∞–ª–∏—Ç—å legacy CLI –∫–æ–¥ –∏ feature flags –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ framework –≤–µ—Ä—Å–∏—é.

---

## –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 4 –Ω–µ–¥–µ–ª–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å error rate
# - Framework CLI error rate ‚â§ Legacy CLI error rate
# - –ù–µ—Ç –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ –æ—à–∏–±–æ–∫
# - User complaints –º–∏–Ω–∏–º–∞–ª—å–Ω—ã

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å usage
# - 100% –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ USE_FRAMEWORK_CLI=true
# - –ù–µ—Ç rollback –Ω–∞ legacy –≤–µ—Ä—Å–∏—é
```

### 2. –ü–æ–ª—É—á–∏—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ

**Checklist:**
- [ ] Product owner –æ–¥–æ–±—Ä–∏–ª —É–¥–∞–ª–µ–Ω–∏–µ
- [ ] –ù–µ—Ç –æ—Ç–∫—Ä—ã—Ç—ã—Ö critical issues —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å CLI
- [ ] –í—Å–µ stakeholders —É–≤–µ–¥–æ–º–ª–µ–Ω—ã
- [ ] Backup legacy –∫–æ–¥–∞ —Å–¥–µ–ª–∞–Ω (git tag)

---

## –î–µ–π—Å—Ç–≤–∏—è

### 1. –°–æ–∑–¥–∞—Ç—å git tag –¥–ª—è rollback

```bash
# –ù–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –æ—Ç–∫–∞—Ç–∏—Ç—å—Å—è
git tag -a v3.x.x-with-legacy -m "Last version with legacy CLI for emergency rollback"
git push origin v3.x.x-with-legacy
```

### 2. –£–¥–∞–ª–∏—Ç—å cli-legacy –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é

```bash
cd packages/servers/yandex-tracker/src

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∏–º–µ–Ω–Ω–æ —É–¥–∞–ª—è–µ—Ç—Å—è
du -sh cli-legacy/
ls -la cli-legacy/

# –£–¥–∞–ª–∏—Ç—å
rm -rf cli-legacy/
```

### 3. –£–¥–∞–ª–∏—Ç—å feature flags

**–§–∞–π–ª:** `packages/servers/yandex-tracker/src/cli/feature-flags.ts`

```bash
# –£–¥–∞–ª–∏—Ç—å –≤–µ—Å—å —Ñ–∞–π–ª
rm src/cli/feature-flags.ts
```

### 4. –£–ø—Ä–æ—Å—Ç–∏—Ç—å bin/mcp-connect.ts

**–§–∞–π–ª:** `packages/servers/yandex-tracker/src/cli/bin/mcp-connect.ts`

**–ë–´–õ–û (—Å feature flag):**
```typescript
#!/usr/bin/env node

import { USE_FRAMEWORK_CLI, DEBUG_CLI_MIGRATION } from '../feature-flags.js';

if (USE_FRAMEWORK_CLI) {
  import('./mcp-connect-framework.js').then(module => module.main());
} else {
  import('../../cli-legacy/bin/mcp-connect.js').then(module => module.main());
}
```

**–°–¢–ê–õ–û (–±–µ–∑ feature flag):**
```typescript
#!/usr/bin/env node

// –ü—Ä—è–º–æ–π –∑–∞–ø—É—Å–∫ framework CLI
import('./mcp-connect-framework.js')
  .then(module => module.main())
  .catch(error => {
    console.error('CLI failed:');
    console.error(error);
    process.exit(1);
  });
```

**–ò–ª–∏ –µ—â–µ –ø—Ä–æ—â–µ ‚Äî –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å —Ñ–∞–π–ª—ã:**

```typescript
#!/usr/bin/env node

import { program } from 'commander';
import {
  ConnectorRegistry,
  ConfigManager,
  InteractivePrompter,
  connectCommand,
  disconnectCommand,
  statusCommand,
  listCommand,
  // ... –∏ —Ç.–¥.
} from '@mcp-framework/cli';
import { ytConfigPrompts } from '../prompts.js';
import type { YandexTrackerMCPConfig } from '../types.js';
import { PROJECT_BASE_NAME } from '../../constants.js';

// –í—Å—è –ª–æ–≥–∏–∫–∞ –Ω–∞–ø—Ä—è–º—É—é –∑–¥–µ—Å—å (–∏–∑ mcp-connect-framework.ts)
// –ë–µ–∑ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –∏ –∏–º–ø–æ—Ä—Ç–∞

const registry = new ConnectorRegistry<YandexTrackerMCPConfig>();
// ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞
```

### 5. –£–¥–∞–ª–∏—Ç—å mcp-connect-framework.ts

–ï—Å–ª–∏ –æ–±—ä–µ–¥–∏–Ω–∏–ª–∏ –ª–æ–≥–∏–∫—É –≤ mcp-connect.ts:

```bash
rm src/cli/bin/mcp-connect-framework.ts
```

### 6. –£–¥–∞–ª–∏—Ç—å deprecation warnings

**–§–∞–π–ª—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:**
- –õ—é–±—ã–µ console.warn –æ legacy CLI
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ @deprecated
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ notices

```bash
# –ù–∞–π—Ç–∏ –≤—Å–µ warnings
grep -r "deprecated" src/cli/
grep -r "legacy" src/cli/
grep -r "USE_FRAMEWORK_CLI" src/

# –£–¥–∞–ª–∏—Ç—å –Ω–∞–π–¥–µ–Ω–Ω—ã–µ warnings
```

### 7. –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

**–§–∞–π–ª:** `packages/servers/yandex-tracker/src/cli/README.md`

**–£–¥–∞–ª–∏—Ç—å:**
- ‚ùå –£–ø–æ–º–∏–Ω–∞–Ω–∏—è legacy –≤–µ—Ä—Å–∏–∏
- ‚ùå –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ USE_FRAMEWORK_CLI
- ‚ùå –ú–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏

**–û–±–Ω–æ–≤–∏—Ç—å:**
```markdown
# Yandex Tracker CLI

CLI –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è–º–∏ –∫ MCP –∫–ª–∏–µ–Ω—Ç–∞–º.

–ü–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ `@mcp-framework/cli`.

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```bash
npm run mcp:connect     # –ø–æ–¥–∫–ª—é—á–∏—Ç—å
npm run mcp:disconnect  # –æ—Ç–∫–ª—é—á–∏—Ç—å
npm run mcp:status      # —Å—Ç–∞—Ç—É—Å
npm run mcp:list        # —Å–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

Yandex Tracker —Ç—Ä–µ–±—É–µ—Ç:
- `token` ‚Äî OAuth —Ç–æ–∫–µ–Ω (–Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è)
- `orgId` ‚Äî ID –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è)
- `apiBase` ‚Äî URL API (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏: `src/cli/types.ts` –∏ `src/cli/prompts.ts`

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: [packages/framework/cli/README.md](../../../framework/cli/README.md)
```

**–§–∞–π–ª:** `packages/servers/yandex-tracker/MIGRATION_CLI.md`

**–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –≤:**
```bash
mv MIGRATION_CLI.md docs/archive/MIGRATION_CLI_v3.0.md
```

**–ò–ª–∏ —É–¥–∞–ª–∏—Ç—å** –µ—Å–ª–∏ –Ω–µ –Ω—É–∂–Ω–∞ –∏—Å—Ç–æ—Ä–∏—è.

### 8. –û–±–Ω–æ–≤–∏—Ç—å package.json version

```json
{
  "version": "4.0.0"  // MAJOR bump (—É–¥–∞–ª–µ–Ω–∏–µ legacy = breaking –¥–ª—è —Ç–µ—Ö –∫—Ç–æ –ø–æ–ª–∞–≥–∞–ª—Å—è –Ω–∞ –Ω–µ–≥–æ)
}
```

### 9. –û–±–Ω–æ–≤–∏—Ç—å CHANGELOG.md

```markdown
## [4.0.0] - 2025-XX-XX

### üö® BREAKING CHANGES

#### Legacy CLI Removed

Legacy CLI –∫–æ–¥ –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω –ø–æ—Å–ª–µ 6 –Ω–µ–¥–µ–ª—å —É—Å–ø–µ—à–Ω–æ–π —Ä–∞–±–æ—Ç—ã framework –≤–µ—Ä—Å–∏–∏.

**–ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:**
- ‚ùå USE_FRAMEWORK_CLI feature flag —É–¥–∞–ª–µ–Ω
- ‚ùå cli-legacy/ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —É–¥–∞–ª–µ–Ω–∞
- ‚ùå Fallback –Ω–∞ legacy –≤–µ—Ä—Å–∏—é –±–æ–ª—å—à–µ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

**–ö–æ–≥–æ —ç—Ç–æ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞–µ—Ç:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –≤—Å–µ –µ—â–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ USE_FRAMEWORK_CLI=false
- –°–∏—Å—Ç–µ–º, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª–∞–≥–∞–ª–∏—Å—å –Ω–∞ legacy –ø—É—Ç–∏

**–ú–∏–≥—Ä–∞—Ü–∏—è:**
- –ü—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–∏—Ç–µ –¥–æ v4.0.0
- CLI —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ framework –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ legacy –≤–µ—Ä—Å–∏—è ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ v3.x.x

### Removed

- Legacy CLI –∫–æ–¥ (cli-legacy/)
- Feature flags (USE_FRAMEWORK_CLI, DEBUG_CLI_MIGRATION)
- Migration –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (–ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞ –≤ docs/archive/)

### Changed

- bin/mcp-connect.ts —É–ø—Ä–æ—â–µ–Ω (–ø—Ä—è–º–æ–π –≤—ã–∑–æ–≤ framework CLI)
- –£–º–µ–Ω—å—à–µ–Ω —Ä–∞–∑–º–µ—Ä –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã (~500KB –º–µ–Ω—å—à–µ)

### Fixed

- –£–ø—Ä–æ—â–µ–Ω–∞ –∫–æ–¥–æ–≤–∞—è –±–∞–∑–∞
- –£–ª—É—á—à–µ–Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å startup (~5% –±—ã—Å—Ç—Ä–µ–µ –±–µ–∑ feature flag –ø—Ä–æ–≤–µ—Ä–æ–∫)

## [3.0.0] - 2025-XX-XX

–°–º. –ø—Ä–µ–¥—ã–¥—É—â—É—é –≤–µ—Ä—Å–∏—é –¥–ª—è –¥–µ—Ç–∞–ª–µ–π –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ framework CLI.
```

### 10. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É

**–§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
packages/servers/yandex-tracker/src/
‚îî‚îÄ‚îÄ cli/
    ‚îú‚îÄ‚îÄ bin/
    ‚îÇ   ‚îî‚îÄ‚îÄ mcp-connect.ts        (—É–ø—Ä–æ—â–µ–Ω–Ω—ã–π, –±–µ–∑ feature flags)
    ‚îú‚îÄ‚îÄ types.ts                  (YT-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Ç–∏–ø—ã)
    ‚îú‚îÄ‚îÄ prompts.ts                (YT-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã)
    ‚îî‚îÄ‚îÄ README.md                 (–æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π, –±–µ–∑ –º–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö –Ω–æ—Ç)
```

**–ß—Ç–æ —É–¥–∞–ª–µ–Ω–æ:**
- ‚ùå cli-legacy/ (–≤–µ—Å—å —Å—Ç–∞—Ä—ã–π –∫–æ–¥)
- ‚ùå feature-flags.ts
- ‚ùå bin/mcp-connect-framework.ts (–æ–±—ä–µ–¥–∏–Ω–µ–Ω —Å mcp-connect.ts)

### 11. –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é

```bash
cd packages/servers/yandex-tracker

# –°–±–æ—Ä–∫–∞
npm run build

# –í–∞–ª–∏–¥–∞—Ü–∏—è
npm run validate

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å CLI
npm run mcp:list
npm run mcp:status

# Smoke test
npm run test:smoke
```

---

## Emergency Rollback

**–ï—Å–ª–∏ –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:**

### –í–∞—Ä–∏–∞–Ω—Ç 1: –û—Ç–∫–∞—Ç —á–µ—Ä–µ–∑ git tag

```bash
# –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –≤–µ—Ä—Å–∏–∏ —Å legacy –∫–æ–¥–æ–º
git checkout v3.x.x-with-legacy

# –ò–ª–∏ cherry-pick –Ω—É–∂–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
git checkout v3.x.x-with-legacy -- src/cli-legacy/
git checkout v3.x.x-with-legacy -- src/cli/feature-flags.ts
git checkout v3.x.x-with-legacy -- src/cli/bin/mcp-connect.ts
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –û—Ç–∫–∞—Ç –≤–µ—Ä—Å–∏–∏ –ø–∞–∫–µ—Ç–∞

```bash
# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –æ—Ç–∫–∞—Ç–∏—Ç—å—Å—è –Ω–∞ v3.x.x
npm install mcp-server-yandex-tracker@3.x.x
```

---

## –†–µ–∑—É–ª—å—Ç–∞—Ç

- [ ] Git tag —Å–æ–∑–¥–∞–Ω –¥–ª—è rollback
- [ ] cli-legacy/ —É–¥–∞–ª–µ–Ω–∞
- [ ] feature-flags.ts —É–¥–∞–ª–µ–Ω—ã
- [ ] bin/mcp-connect.ts —É–ø—Ä–æ—â–µ–Ω
- [ ] Deprecation warnings —É–¥–∞–ª–µ–Ω—ã
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- [ ] package.json version = 4.0.0
- [ ] CHANGELOG.md –æ–±–Ω–æ–≤–ª–µ–Ω
- [ ] `npm run validate` –ø—Ä–æ—Ö–æ–¥–∏—Ç
- [ ] Smoke tests –ø—Ä–æ—Ö–æ–¥—è—Ç

---

## –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

- [ ] Legacy –∫–æ–¥ –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω
- [ ] –ù–µ—Ç —É–ø–æ–º–∏–Ω–∞–Ω–∏–π feature flags –≤ –∫–æ–¥–µ
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –º–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π
- [ ] –ö–æ–¥–æ–≤–∞—è –±–∞–∑–∞ —á–∏—â–µ –∏ –ø—Ä–æ—â–µ
- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] CLI —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –æ–∂–∏–¥–∞–µ—Ç—Å—è
