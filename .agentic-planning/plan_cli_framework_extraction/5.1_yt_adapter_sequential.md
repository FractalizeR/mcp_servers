# 5.1 Создание yandex-tracker CLI адаптера

**Тип:** Sequential
**Зависимости:** Этап 4 (все команды)
**Время:** ~1.5 часа

---

## Задача

Адаптировать CLI в yandex-tracker для использования framework/cli пакета.

---

## Действия

### 1. Создать типы конфигурации

**Файл:** `packages/servers/yandex-tracker/src/cli/types.ts`

```typescript
import type { BaseMCPServerConfig } from '@mcp-framework/cli';

/**
 * Конфигурация MCP сервера Yandex Tracker
 */
export interface YandexTrackerMCPConfig extends BaseMCPServerConfig {
  /** OAuth токен Яндекс.Трекера */
  token: string;

  /** ID организации */
  orgId: string;

  /** Базовый URL API (опционально) */
  apiBase?: string;

  /** Таймаут запросов (опционально) */
  requestTimeout?: number;
}
```

### 2. Создать конфигурацию промптов

**Файл:** `packages/servers/yandex-tracker/src/cli/prompts.ts`

```typescript
import type { ConfigPromptDefinition } from '@mcp-framework/cli';
import type { YandexTrackerMCPConfig } from './types.js';
import { DEFAULT_LOG_LEVEL } from '../constants.js';

export const ytConfigPrompts: ConfigPromptDefinition<YandexTrackerMCPConfig>[] = [
  {
    name: 'token',
    type: 'password',
    message: 'OAuth токен Яндекс.Трекера:',
    mask: '*',
    validate: (value) => {
      if (!value || value.length === 0) {
        return 'Токен обязателен';
      }
      return true;
    },
  },
  {
    name: 'orgId',
    type: 'input',
    message: 'ID организации:',
    default: (saved) => saved?.orgId,
    validate: (value) => {
      if (!value || value.length === 0) {
        return 'ID организации обязателен';
      }
      return true;
    },
  },
  {
    name: 'apiBase',
    type: 'input',
    message: 'Базовый URL API (необязательно, Enter для пропуска):',
    default: (saved) => saved?.apiBase,
  },
  {
    name: 'logLevel',
    type: 'list',
    message: 'Уровень логирования:',
    choices: [
      { name: 'Debug', value: 'debug' },
      { name: 'Info', value: 'info' },
      { name: 'Warning', value: 'warn' },
      { name: 'Error', value: 'error' },
    ],
    default: (saved) => saved?.logLevel ?? DEFAULT_LOG_LEVEL,
  },
];
```

### 3. Обновить bin/mcp-connect.ts

**Файл:** `packages/servers/yandex-tracker/src/cli/bin/mcp-connect.ts`

```typescript
#!/usr/bin/env node

import { program } from 'commander';
import {
  ConnectorRegistry,
  ConfigManager,
  InteractivePrompter,
  connectCommand,
  disconnectCommand,
  statusCommand,
  listCommand,
  // Импортируем коннекторы
  ClaudeDesktopConnector,
  ClaudeCodeConnector,
  CodexConnector,
  GeminiConnector,
  QwenConnector,
} from '@mcp-framework/cli';
import { ytConfigPrompts } from '../prompts.js';
import type { YandexTrackerMCPConfig } from '../types.js';
import { PROJECT_BASE_NAME } from '../../constants.js';

// Создать реестр и зарегистрировать коннекторы
const registry = new ConnectorRegistry<YandexTrackerMCPConfig>();
registry.register(new ClaudeDesktopConnector<YandexTrackerMCPConfig>());
registry.register(new ClaudeCodeConnector<YandexTrackerMCPConfig>());
registry.register(new CodexConnector<YandexTrackerMCPConfig>());
registry.register(new GeminiConnector<YandexTrackerMCPConfig>());
registry.register(new QwenConnector<YandexTrackerMCPConfig>());

// Создать менеджер конфигурации
const configManager = new ConfigManager<YandexTrackerMCPConfig>({
  projectName: PROJECT_BASE_NAME,
  safeFields: ['orgId', 'apiBase', 'requestTimeout', 'logLevel', 'projectPath'],
});

// Создать prompter
const prompter = new InteractivePrompter(ytConfigPrompts);

// Команды
program
  .command('connect')
  .description('Подключить MCP сервер к клиенту')
  .option('--client <name>', 'Название клиента')
  .action(async (opts) => {
    await connectCommand({
      registry,
      configManager,
      prompter,
      cliOptions: opts,
    });
  });

program
  .command('disconnect')
  .description('Отключить MCP сервер от клиента')
  .option('--client <name>', 'Название клиента')
  .action(async (opts) => {
    await disconnectCommand({
      registry,
      cliOptions: opts,
    });
  });

program
  .command('status')
  .description('Проверить статус подключений')
  .action(async () => {
    await statusCommand({ registry });
  });

program
  .command('list')
  .description('Показать список поддерживаемых клиентов')
  .action(async () => {
    await listCommand({ registry });
  });

program.parse();
```

### 4. Обновить package.json зависимости

**Файл:** `packages/servers/yandex-tracker/package.json`

```json
{
  "dependencies": {
    "@mcp-framework/cli": "workspace:*",
    "@mcp-framework/core": "workspace:*",
    "@mcp-framework/infrastructure": "workspace:*",
    "@mcp-framework/search": "workspace:*"
  }
}
```

### 5. Проверить dependency graph

```bash
npm run depcruise
```

**Ожидаемый граф:**
```
infrastructure → cli → yandex-tracker
infrastructure → core → search → yandex-tracker
```

---

## Результат

- [ ] `types.ts` создан
- [ ] `prompts.ts` создан
- [ ] `bin/mcp-connect.ts` обновлен
- [ ] package.json обновлен
- [ ] `npm install` проходит
- [ ] `npm run build` проходит в yandex-tracker
- [ ] Dependency graph корректен

---

## Критерии готовности

- [ ] Yandex Tracker использует @mcp-framework/cli
- [ ] Все команды работают как раньше
- [ ] Граф зависимостей соблюден
- [ ] TypeScript compilation успешен
