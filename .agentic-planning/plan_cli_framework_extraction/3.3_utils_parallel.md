# 3.3 Утилиты (command-executor, file-manager, logger)

**Тип:** Parallel (можно выполнять одновременно с 3.1 и 3.2)
**Зависимости:** 2.3 Коннекторы
**Время:** ~45 минут

---

## Задача

Перенести универсальные утилиты из yandex-tracker в framework/cli:
- CommandExecutor — выполнение shell команд
- FileManager — работа с файлами
- Logger — CLI логирование (chalk, ora)

Эти утилиты полностью generic и не требуют изменений.

---

## Действия

### 1. Перенести CommandExecutor

**Файл:** `src/utils/command-executor.ts`

**Действия:**
1. Скопировать из `yandex-tracker/src/cli/utils/command-executor.ts`
2. Проверить imports (должны быть только node modules)
3. Добавить JSDoc комментарии

**Методы:**
- `exec(command)` — выполнить команду, вернуть stdout
- `execSilent(command)` — выполнить тихо
- `execInteractive(command, args)` — интерактивное выполнение
- `isCommandAvailable(command)` — проверка наличия команды

### 2. Перенести FileManager

**Файл:** `src/utils/file-manager.ts`

**Действия:**
1. Скопировать из `yandex-tracker/src/cli/utils/file-manager.ts`
2. Убедиться, что нет зависимостей от YT
3. Добавить JSDoc

**Основные методы:**
- `exists(path)` — проверка существования
- `readJSON<T>(path)` — чтение JSON
- `writeJSON(path, data)` — запись JSON
- `ensureDir(path)` — создание директории
- `setPermissions(path, mode)` — установка прав
- `getHomeDir()` — получение home директории

### 3. Перенести Logger

**Файл:** `src/utils/logger.ts`

**Действия:**
1. Скопировать из `yandex-tracker/src/cli/utils/logger.ts`
2. Проверить, что используются только chalk и ora
3. Добавить JSDoc

**Основные методы:**
- `header(text)` — заголовок секции
- `info(text)` — информационное сообщение
- `success(text)` — успех (зеленый)
- `error(text)` — ошибка (красный)
- `warn(text)` — предупреждение (желтый)
- `newLine()` — пустая строка
- `spinner(text)` — создать спиннер

### 4. Обновить exports

**Файл:** `src/utils/index.ts`

```typescript
export * from './command-executor.js';
export * from './file-manager.js';
export * from './logger.js';
export * from './config-manager.js';
export * from './interactive-prompter.js';
export * from './prompts.types.js';
```

---

## Тестирование

### CommandExecutor tests

**Файл:** `tests/unit/utils/command-executor.test.ts`

```typescript
import { describe, it, expect } from 'vitest';
import { CommandExecutor } from '../../../src/utils/command-executor.js';

describe('CommandExecutor', () => {
  it('should execute command and return output', () => {
    const output = CommandExecutor.exec('echo "test"');
    expect(output.trim()).toBe('test');
  });

  it('should check if command is available', () => {
    expect(CommandExecutor.isCommandAvailable('node')).toBe(true);
    expect(CommandExecutor.isCommandAvailable('non-existent-command-xyz')).toBe(false);
  });

  it('should execute silently without errors', () => {
    expect(() => CommandExecutor.execSilent('echo "test"')).not.toThrow();
  });
});
```

### FileManager tests

**Файл:** `tests/unit/utils/file-manager.test.ts`

```typescript
import { describe, it, expect, beforeEach, afterEach } from 'vitest';
import { FileManager } from '../../../src/utils/file-manager.js';
import * as path from 'path';
import * as os from 'os';

describe('FileManager', () => {
  let testDir: string;
  let testFile: string;

  beforeEach(async () => {
    testDir = path.join(os.tmpdir(), `test-${Date.now()}`);
    testFile = path.join(testDir, 'test.json');
    await FileManager.ensureDir(testDir);
  });

  afterEach(async () => {
    const fs = await import('fs/promises');
    try {
      await fs.rm(testDir, { recursive: true });
    } catch {
      // ignore
    }
  });

  it('should check if file exists', async () => {
    expect(await FileManager.exists(testFile)).toBe(false);
  });

  it('should read and write JSON', async () => {
    const data = { test: 'value' };
    await FileManager.writeJSON(testFile, data);

    const loaded = await FileManager.readJSON<typeof data>(testFile);
    expect(loaded).toEqual(data);
  });

  it('should get home directory', () => {
    const home = FileManager.getHomeDir();
    expect(home).toBeDefined();
    expect(home.length).toBeGreaterThan(0);
  });
});
```

### Logger tests

**Файл:** `tests/unit/utils/logger.test.ts`

```typescript
import { describe, it, expect } from 'vitest';
import { Logger } from '../../../src/utils/logger.js';

describe('Logger', () => {
  it('should have all methods', () => {
    expect(Logger.header).toBeDefined();
    expect(Logger.info).toBeDefined();
    expect(Logger.success).toBeDefined();
    expect(Logger.error).toBeDefined();
    expect(Logger.warn).toBeDefined();
    expect(Logger.newLine).toBeDefined();
    expect(Logger.spinner).toBeDefined();
  });

  // Полное тестирование сложно т.к. выводит в console
  // Основное - проверка что методы существуют и не падают
  it('should not throw on basic usage', () => {
    expect(() => Logger.info('test')).not.toThrow();
  });
});
```

---

## Результат

- [x] CommandExecutor перенесен
- [x] FileManager перенесен
- [x] Logger перенесен
- [x] Exports настроены
- [x] Тесты написаны и проходят
- [x] `npm run validate` проходит

---

## Критерии готовности

- [x] Все 3 утилиты работают как раньше
- [x] Нет зависимостей от yandex-tracker
- [x] Тесты покрывают базовую функциональность
- [x] Код соответствует lint правилам
- [x] TypeScript compilation успешен
