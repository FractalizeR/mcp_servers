# 2.2 Вынос базовых типов и интерфейсов

**Тип:** Sequential
**Зависимости:** 2.1 Структура пакета
**Время:** ~30 минут

---

## Задача

Перенести и адаптировать базовые типы из `yandex-tracker/src/cli/connectors/base/connector.interface.ts` в generic версию для framework/cli.

---

## Действия

### 1. Создать src/types.ts

**Базовые типы из API Design (этап 1.3):**

```typescript
/**
 * Базовая конфигурация для любого MCP сервера
 */
export interface BaseMCPServerConfig {
  /** Абсолютный путь к проекту */
  projectPath: string;

  /** Уровень логирования */
  logLevel?: 'debug' | 'info' | 'warn' | 'error';

  /** Дополнительные env переменные */
  env?: Record<string, string>;
}

/**
 * Информация о MCP клиенте
 */
export interface MCPClientInfo {
  name: string;
  displayName: string;
  description: string;
  checkCommand?: string;
  configPath: string;
  platforms: Array<'darwin' | 'linux' | 'win32'>;
}

/**
 * Статус подключения
 */
export interface ConnectionStatus {
  connected: boolean;
  details?: {
    configPath: string;
    lastModified?: Date;
    metadata?: Record<string, unknown>;
  };
  error?: string;
}

/**
 * Конфигурация сервера в файле клиента
 */
export interface MCPClientServerConfig {
  command: string;
  args: string[];
  env: Record<string, string>;
}

/**
 * Generic тип для конфигурационных файлов клиентов
 */
export type MCPClientConfig<TKey extends string = 'mcpServers'> = {
  [K in TKey]?: Record<string, MCPClientServerConfig>;
};
```

### 2. Создать src/connectors/base/connector.interface.ts

**Generic интерфейс коннектора:**

```typescript
import type {
  BaseMCPServerConfig,
  MCPClientInfo,
  ConnectionStatus,
} from '../../types.js';

/**
 * Базовый интерфейс для всех MCP коннекторов
 *
 * @template TConfig - Тип конфигурации MCP сервера
 */
export interface MCPConnector<TConfig extends BaseMCPServerConfig = BaseMCPServerConfig> {
  /** Получить информацию о клиенте */
  getClientInfo(): MCPClientInfo;

  /** Проверить, установлен ли клиент */
  isInstalled(): Promise<boolean>;

  /** Получить текущий статус подключения */
  getStatus(): Promise<ConnectionStatus>;

  /** Подключить MCP сервер к клиенту */
  connect(config: TConfig): Promise<void>;

  /** Отключить MCP сервер от клиента */
  disconnect(): Promise<void>;

  /** Валидировать конфигурацию */
  validateConfig(config: TConfig): Promise<string[]>;
}
```

### 3. Создать src/connectors/base/base-connector.ts

**Абстрактный базовый класс:**

```typescript
import type { MCPConnector, BaseMCPServerConfig } from './connector.interface.js';
import * as os from 'os';

/**
 * Базовый класс для всех MCP коннекторов
 * Предоставляет общую функциональность
 */
export abstract class BaseConnector<TConfig extends BaseMCPServerConfig = BaseMCPServerConfig>
  implements MCPConnector<TConfig>
{
  abstract getClientInfo(): ReturnType<MCPConnector<TConfig>['getClientInfo']>;
  abstract isInstalled(): ReturnType<MCPConnector<TConfig>['isInstalled']>;
  abstract getStatus(): ReturnType<MCPConnector<TConfig>['getStatus']>;
  abstract connect(config: TConfig): ReturnType<MCPConnector<TConfig>['connect']>;
  abstract disconnect(): ReturnType<MCPConnector<TConfig>['disconnect']>;

  /**
   * Базовая валидация конфигурации
   * Наследники могут переопределить для добавления своих правил
   */
  async validateConfig(config: TConfig): Promise<string[]> {
    const errors: string[] = [];

    if (!config.projectPath || config.projectPath.trim().length === 0) {
      errors.push('Путь к проекту обязателен');
    }

    return errors;
  }

  /**
   * Проверить поддержку текущей платформы
   */
  protected isPlatformSupported(): boolean {
    const platform = os.platform();
    const supportedPlatforms = this.getClientInfo().platforms;
    return supportedPlatforms.includes(platform as 'darwin' | 'linux' | 'win32');
  }

  /**
   * Получить текущую платформу
   */
  protected getCurrentPlatform(): ReturnType<typeof os.platform> {
    return os.platform();
  }
}
```

### 4. Создать src/connectors/base/index.ts

```typescript
export * from './connector.interface.js';
export * from './base-connector.js';
```

### 5. Добавить exports в src/connectors/index.ts

```typescript
export * from './base/index.js';
```

---

## Тестирование

**Создать базовый тест:** `tests/unit/types.test.ts`

```typescript
import { describe, it, expect } from 'vitest';
import type { BaseMCPServerConfig, MCPClientInfo } from '../src/types.js';

describe('Types', () => {
  it('BaseMCPServerConfig should be valid', () => {
    const config: BaseMCPServerConfig = {
      projectPath: '/path/to/project',
      logLevel: 'info',
    };
    expect(config).toBeDefined();
  });

  it('MCPClientInfo should be valid', () => {
    const info: MCPClientInfo = {
      name: 'test',
      displayName: 'Test Client',
      description: 'Test',
      configPath: '/test',
      platforms: ['darwin'],
    };
    expect(info).toBeDefined();
  });
});
```

---

## Результат

- [ ] `src/types.ts` создан с базовыми типами
- [ ] `src/connectors/base/connector.interface.ts` создан
- [ ] `src/connectors/base/base-connector.ts` создан
- [ ] Exports настроены
- [ ] Базовые тесты написаны
- [ ] `npm run build` проходит
- [ ] `npm run typecheck` проходит
- [ ] `npm run test` проходит

---

## Критерии готовности

- [ ] Все базовые типы определены
- [ ] Generic параметр TConfig работает корректно
- [ ] Тесты проходят
- [ ] TypeScript compilation успешен
- [ ] Нет линтинг ошибок
