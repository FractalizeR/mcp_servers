# 6.2 Тесты framework/cli

**Тип:** Parallel (можно выполнять одновременно с 6.1 и 6.3)
**Зависимости:** Этап 5 (все)
**Время:** ~2 часа

---

## Задача

Обеспечить ≥90% покрытие тестами для framework/cli пакета.

---

## Действия

### 1. Создать структуру тестов

```
packages/framework/cli/tests/
├── unit/
│   ├── connectors/
│   │   ├── base/
│   │   │   ├── base-connector.test.ts
│   │   │   └── file-based-connector.test.ts
│   │   ├── claude-desktop.test.ts
│   │   ├── claude-code.test.ts
│   │   ├── codex.test.ts
│   │   ├── gemini.test.ts
│   │   ├── qwen.test.ts
│   │   └── registry.test.ts
│   ├── commands/
│   │   ├── connect.test.ts
│   │   ├── disconnect.test.ts
│   │   ├── status.test.ts
│   │   └── list.test.ts
│   ├── utils/
│   │   ├── command-executor.test.ts
│   │   ├── file-manager.test.ts
│   │   ├── logger.test.ts
│   │   ├── config-manager.test.ts
│   │   └── interactive-prompter.test.ts
│   └── types.test.ts
├── integration/
│   └── full-workflow.test.ts
└── helpers/
    └── test-utils.ts
```

### 2. Написать unit тесты для коннекторов

**Приоритет:**
- BaseConnector — основная логика
- ConnectorRegistry — регистрация и поиск
- Каждый специфичный коннектор — базовые проверки

**Покрытие:**
- Валидация конфигурации
- Проверка установки
- Проверка статуса
- Обработка ошибок

### 3. Написать unit тесты для команд

**Для каждой команды:**
- Успешное выполнение
- Обработка отсутствующих клиентов
- Обработка ошибок подключения
- Валидация опций

**Использовать моки** для:
- ConnectorRegistry
- ConfigManager
- InteractivePrompter

### 4. Написать unit тесты для утилит

**CommandExecutor:**
- Выполнение команд
- Обработка ошибок
- Проверка доступности команд

**FileManager:**
- Чтение/запись JSON
- Создание директорий
- Установка прав доступа

**ConfigManager:**
- Сохранение только безопасных полей
- Загрузка конфигурации
- Удаление конфигурации

**InteractivePrompter:**
- Проверка типов (сложно тестировать inquirer полностью)

### 5. Написать integration тест

**Файл:** `tests/integration/full-workflow.test.ts`

**Сценарий:**
1. Создать mock конфигурацию
2. Зарегистрировать mock коннектор
3. Выполнить connect команду
4. Проверить статус
5. Выполнить disconnect команду

### 6. Настроить coverage

**Файл:** `vitest.config.ts`

```typescript
export default defineConfig({
  test: {
    coverage: {
      provider: 'v8',
      reporter: ['text', 'json', 'html'],
      lines: 90,
      functions: 90,
      branches: 85,
      statements: 90,
      exclude: [
        'tests/**',
        '**/*.test.ts',
        'examples/**',
      ],
    },
  },
});
```

### 7. Запустить тесты

```bash
cd packages/framework/cli

# Unit тесты
npm run test

# С покрытием
npm run test:coverage

# Проверить порог покрытия
# Должно быть ≥90%
```

---

## Результат

- [ ] Все unit тесты написаны
- [ ] Integration тест написан
- [ ] Покрытие ≥90% (lines, functions, statements)
- [ ] Покрытие ≥85% (branches)
- [ ] `npm run test` проходит
- [ ] `npm run test:coverage` показывает достаточное покрытие

---

## Критерии готовности

- [ ] Все тесты проходят
- [ ] Покрытие соответствует порогам
- [ ] Тесты читаемые и понятные
- [ ] Моки используются корректно
- [ ] Integration тест покрывает основной workflow
