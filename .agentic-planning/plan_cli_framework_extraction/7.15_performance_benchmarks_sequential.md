# 7.15 Performance Benchmarks

**–¢–∏–ø:** Sequential
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** 7.1 –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
**–í—Ä–µ–º—è:** ~1 —á–∞—Å
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üö® –í–´–°–û–ö–ê–Ø ‚Äî –ø–µ—Ä–µ–¥ production deployment

---

## –ó–∞–¥–∞—á–∞

–ò–∑–º–µ—Ä–∏—Ç—å –∏ —Å—Ä–∞–≤–Ω–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–æ–≤–æ–≥–æ CLI —Å legacy –≤–µ—Ä—Å–∏–µ–π, —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –Ω–µ—Ç —Ä–µ–≥—Ä–µ—Å—Å–∏–π.

---

## –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –∏–∑–º–µ—Ä–µ–Ω–∏—è

### 1. Bundle Size

**–ß—Ç–æ –∏–∑–º–µ—Ä—è–µ–º:**
- –†–∞–∑–º–µ—Ä —Å–æ–±—Ä–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- –†–∞–∑–º–µ—Ä node_modules –¥–ª—è CLI
- Tree-shaking —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

**–ü–æ—Ä–æ–≥:**
- framework/cli: ‚â§200 KB
- yandex-tracker —É–≤–µ–ª–∏—á–µ–Ω–∏–µ: ‚â§10%

### 2. Startup Time

**–ß—Ç–æ –∏–∑–º–µ—Ä—è–µ–º:**
- –í—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞ CLI –∫–æ–º–∞–Ω–¥—ã
- Time-to-interactive
- Cold start vs warm start

**–ü–æ—Ä–æ–≥:**
- –ù–µ –±–æ–ª–µ–µ +20% –æ—Ç legacy –≤–µ—Ä—Å–∏–∏

### 3. Memory Usage

**–ß—Ç–æ –∏–∑–º–µ—Ä—è–µ–º:**
- Peak memory –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- Memory leaks

**–ü–æ—Ä–æ–≥:**
- –ù–µ –±–æ–ª–µ–µ +30% –æ—Ç legacy –≤–µ—Ä—Å–∏–∏

### 4. Command Execution Time

**–ß—Ç–æ –∏–∑–º–µ—Ä—è–µ–º:**
- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–∞–∂–¥–æ–π –∫–æ–º–∞–Ω–¥—ã
- Latency –≤—ã–∑–æ–≤–æ–≤ –∫ MCP –∫–ª–∏–µ–Ω—Ç–∞–º

**–ü–æ—Ä–æ–≥:**
- –ù–µ –±–æ–ª–µ–µ +15% –æ—Ç legacy –≤–µ—Ä—Å–∏–∏

---

## –î–µ–π—Å—Ç–≤–∏—è

### 1. –°–æ–∑–¥–∞—Ç—å benchmark —Å–∫—Ä–∏–ø—Ç—ã

**–§–∞–π–ª:** `packages/servers/yandex-tracker/benchmarks/cli-performance.ts`

```typescript
import { performance } from 'perf_hooks';
import { execSync } from 'child_process';

interface BenchmarkResult {
  name: string;
  legacy: number;
  framework: number;
  diff: number;
  diffPercent: number;
}

async function measureStartupTime(version: 'legacy' | 'framework'): Promise<number> {
  const env = version === 'legacy' ? 'USE_FRAMEWORK_CLI=false' : 'USE_FRAMEWORK_CLI=true';

  const start = performance.now();
  execSync(`${env} node dist/cli/bin/mcp-connect.js --help`, {
    stdio: 'ignore',
  });
  const end = performance.now();

  return end - start;
}

async function measureCommandExecution(
  command: string,
  version: 'legacy' | 'framework'
): Promise<number> {
  const env = version === 'legacy' ? 'USE_FRAMEWORK_CLI=false' : 'USE_FRAMEWORK_CLI=true';

  const start = performance.now();
  try {
    execSync(`${env} node dist/cli/bin/mcp-connect.js ${command}`, {
      stdio: 'ignore',
    });
  } catch {
    // –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã –º–æ–≥—É—Ç –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è —Å –æ—à–∏–±–∫–æ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –Ω–µ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤)
    // –ù–æ –º—ã –≤—Å–µ —Ä–∞–≤–Ω–æ –∏–∑–º–µ—Ä—è–µ–º –≤—Ä–µ–º—è –¥–æ –æ—à–∏–±–∫–∏
  }
  const end = performance.now();

  return end - start;
}

async function runBenchmarks(): Promise<BenchmarkResult[]> {
  const results: BenchmarkResult[] = [];

  // Startup time (--help)
  const legacyStartup = await measureStartupTime('legacy');
  const frameworkStartup = await measureStartupTime('framework');
  results.push({
    name: 'Startup time (--help)',
    legacy: legacyStartup,
    framework: frameworkStartup,
    diff: frameworkStartup - legacyStartup,
    diffPercent: ((frameworkStartup - legacyStartup) / legacyStartup) * 100,
  });

  // List command
  const legacyList = await measureCommandExecution('list', 'legacy');
  const frameworkList = await measureCommandExecution('list', 'framework');
  results.push({
    name: 'List command',
    legacy: legacyList,
    framework: frameworkList,
    diff: frameworkList - legacyList,
    diffPercent: ((frameworkList - legacyList) / legacyList) * 100,
  });

  // Status command
  const legacyStatus = await measureCommandExecution('status', 'legacy');
  const frameworkStatus = await measureCommandExecution('status', 'framework');
  results.push({
    name: 'Status command',
    legacy: legacyStatus,
    framework: frameworkStatus,
    diff: frameworkStatus - legacyStatus,
    diffPercent: ((frameworkStatus - legacyStatus) / legacyStatus) * 100,
  });

  return results;
}

async function main() {
  console.log('üî¨ Running CLI performance benchmarks...\n');

  const results = await runBenchmarks();

  console.log('Results:\n');
  console.table(
    results.map((r) => ({
      Command: r.name,
      'Legacy (ms)': r.legacy.toFixed(2),
      'Framework (ms)': r.framework.toFixed(2),
      'Diff (ms)': r.diff.toFixed(2),
      'Diff (%)': r.diffPercent.toFixed(2) + '%',
      Status: r.diffPercent > 20 ? '‚ùå FAIL' : r.diffPercent > 10 ? '‚ö†Ô∏è  WARN' : '‚úÖ OK',
    }))
  );

  // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Ä–æ–≥–∏
  const failures = results.filter((r) => r.diffPercent > 20);
  if (failures.length > 0) {
    console.error('\n‚ùå Performance regression detected!');
    console.error('Commands exceeding +20% threshold:');
    failures.forEach((f) => console.error(`  - ${f.name}: +${f.diffPercent.toFixed(2)}%`));
    process.exit(1);
  }

  console.log('\n‚úÖ All benchmarks passed!');
}

main();
```

### 2. –ò–∑–º–µ—Ä–∏—Ç—å bundle size

**–°–∫—Ä–∏–ø—Ç:** `packages/servers/yandex-tracker/benchmarks/bundle-size.sh`

```bash
#!/bin/bash

echo "üì¶ Measuring bundle sizes..."

# framework/cli
echo ""
echo "=== @mcp-framework/cli ==="
cd packages/framework/cli
BUNDLE_SIZE=$(du -sh dist/ | cut -f1)
echo "Bundle size: $BUNDLE_SIZE"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Ä–æ–≥ (200KB)
BUNDLE_BYTES=$(du -sb dist/ | cut -f1)
MAX_BYTES=$((200 * 1024))

if [ $BUNDLE_BYTES -gt $MAX_BYTES ]; then
  echo "‚ùå FAIL: Bundle size exceeds 200KB ($BUNDLE_SIZE)"
  exit 1
else
  echo "‚úÖ OK: Bundle size within limit"
fi

# yandex-tracker –¥–æ –º–∏–≥—Ä–∞—Ü–∏–∏ (–∏–∑ git)
cd ../../..
echo ""
echo "=== yandex-tracker (before migration) ==="
git stash
git checkout main  # –∏–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–µ–ª–∏–∑ –±–µ–∑ –º–∏–≥—Ä–∞—Ü–∏–∏
npm run build --workspace=@mcp-server/yandex-tracker
OLD_SIZE=$(du -sb packages/servers/yandex-tracker/dist/ | cut -f1)
echo "Old bundle size: $(($OLD_SIZE / 1024))KB"

# yandex-tracker –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏
git checkout -
git stash pop
npm run build --workspace=@mcp-server/yandex-tracker
NEW_SIZE=$(du -sb packages/servers/yandex-tracker/dist/ | cut -f1)
echo "New bundle size: $(($NEW_SIZE / 1024))KB"

# –°—Ä–∞–≤–Ω–∏—Ç—å
DIFF=$((NEW_SIZE - OLD_SIZE))
DIFF_PERCENT=$((DIFF * 100 / OLD_SIZE))

echo ""
echo "Difference: ${DIFF_PERCENT}%"

if [ $DIFF_PERCENT -gt 10 ]; then
  echo "‚ùå FAIL: Bundle size increased by more than 10%"
  exit 1
else
  echo "‚úÖ OK: Bundle size increase within acceptable range"
fi
```

### 3. –ò–∑–º–µ—Ä–∏—Ç—å memory usage

**–°–∫—Ä–∏–ø—Ç:** `packages/servers/yandex-tracker/benchmarks/memory-usage.ts`

```typescript
import { spawn } from 'child_process';

function measureMemory(version: 'legacy' | 'framework'): Promise<number> {
  return new Promise((resolve, reject) => {
    const env = version === 'legacy' ? 'USE_FRAMEWORK_CLI=false' : 'USE_FRAMEWORK_CLI=true';

    const proc = spawn('node', ['dist/cli/bin/mcp-connect.js', 'list'], {
      env: { ...process.env, [env.split('=')[0]]: env.split('=')[1] },
    });

    let maxMemory = 0;

    const interval = setInterval(() => {
      try {
        const usage = process.memoryUsage();
        maxMemory = Math.max(maxMemory, usage.heapUsed);
      } catch {
        // Process ended
      }
    }, 10);

    proc.on('close', () => {
      clearInterval(interval);
      resolve(maxMemory);
    });

    proc.on('error', reject);
  });
}

async function main() {
  console.log('üíæ Measuring memory usage...\n');

  const legacyMemory = await measureMemory('legacy');
  const frameworkMemory = await measureMemory('framework');

  const diff = frameworkMemory - legacyMemory;
  const diffPercent = (diff / legacyMemory) * 100;

  console.log(`Legacy:    ${(legacyMemory / 1024 / 1024).toFixed(2)} MB`);
  console.log(`Framework: ${(frameworkMemory / 1024 / 1024).toFixed(2)} MB`);
  console.log(`Diff:      ${diffPercent.toFixed(2)}%`);

  if (diffPercent > 30) {
    console.error('\n‚ùå FAIL: Memory usage increased by more than 30%');
    process.exit(1);
  }

  console.log('\n‚úÖ OK: Memory usage within acceptable range');
}

main();
```

### 4. –î–æ–±–∞–≤–∏—Ç—å npm scripts

**–§–∞–π–ª:** `packages/servers/yandex-tracker/package.json`

```json
{
  "scripts": {
    "benchmark": "tsx benchmarks/cli-performance.ts",
    "benchmark:bundle": "bash benchmarks/bundle-size.sh",
    "benchmark:memory": "tsx benchmarks/memory-usage.ts",
    "benchmark:all": "npm run benchmark && npm run benchmark:bundle && npm run benchmark:memory"
  }
}
```

### 5. –ó–∞–ø—É—Å—Ç–∏—Ç—å benchmarks

```bash
cd packages/servers/yandex-tracker

# –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ —Å–æ–±—Ä–∞–Ω—ã
npm run build

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ benchmarks
npm run benchmark:all
```

### 6. –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

**–°–æ–∑–¥–∞—Ç—å:** `packages/servers/yandex-tracker/benchmarks/RESULTS.md`

```markdown
# Performance Benchmark Results

**Date:** 2025-XX-XX
**Environment:** Node.js vXX.X, macOS/Linux/Windows

## Startup Time

| Command | Legacy (ms) | Framework (ms) | Diff (%) | Status |
|---------|-------------|----------------|----------|--------|
| --help  | XX.XX       | XX.XX          | +X.X%    | ‚úÖ OK  |

## Command Execution

| Command | Legacy (ms) | Framework (ms) | Diff (%) | Status |
|---------|-------------|----------------|----------|--------|
| list    | XX.XX       | XX.XX          | +X.X%    | ‚úÖ OK  |
| status  | XX.XX       | XX.XX          | +X.X%    | ‚úÖ OK  |

## Bundle Size

| Package          | Size (KB) | Threshold | Status |
|------------------|-----------|-----------|--------|
| framework/cli    | XXX       | ‚â§200 KB   | ‚úÖ OK  |
| yandex-tracker   | +X.X%     | ‚â§+10%     | ‚úÖ OK  |

## Memory Usage

| Version   | Peak Memory (MB) | Diff (%) | Status |
|-----------|------------------|----------|--------|
| Legacy    | XX.XX            | -        | -      |
| Framework | XX.XX            | +X.X%    | ‚úÖ OK  |

## Conclusion

‚úÖ All performance benchmarks passed
‚ö†Ô∏è Minor regressions detected but within acceptable range
‚ùå Performance regression - requires optimization before release

## Action Items

- [ ] None - all metrics within thresholds
```

---

## –ü–æ—Ä–æ–≥–∏ –¥–ª—è Fail

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fail –µ—Å–ª–∏:**
- Startup time: >+20%
- Command execution: >+15%
- Bundle size framework/cli: >200 KB
- Bundle size yandex-tracker: >+10%
- Memory usage: >+30%

**–î–µ–π—Å—Ç–≤–∏—è –ø—Ä–∏ fail:**
1. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏—á–∏–Ω—É —Ä–µ–≥—Ä–µ—Å—Å–∏–∏
2. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
3. –ü–æ–≤—Ç–æ—Ä–∏—Ç—å benchmarks
4. –ù–ï –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –¥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

---

## –†–µ–∑—É–ª—å—Ç–∞—Ç

- [ ] Benchmark —Å–∫—Ä–∏–ø—Ç—ã —Å–æ–∑–¥–∞–Ω—ã
- [ ] Bundle size –∏–∑–º–µ—Ä–µ–Ω
- [ ] Startup time –∏–∑–º–µ—Ä–µ–Ω
- [ ] Memory usage –∏–∑–º–µ—Ä–µ–Ω
- [ ] –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã
- [ ] –í—Å–µ –º–µ—Ç—Ä–∏–∫–∏ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –ø–æ—Ä–æ–≥–æ–≤
- [ ] `npm run benchmark:all` –ø—Ä–æ—Ö–æ–¥–∏—Ç

---

## –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

- [ ] –í—Å–µ benchmarks –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
- [ ] –ü–æ—Ä–æ–≥–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è
- [ ] –ù–µ—Ç performance —Ä–µ–≥—Ä–µ—Å—Å–∏–π
- [ ] –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã
- [ ] CI/CD –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
