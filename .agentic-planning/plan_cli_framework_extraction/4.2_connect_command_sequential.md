# 4.2 Connect –∫–æ–º–∞–Ω–¥–∞ —Å hooks

**–¢–∏–ø:** Sequential
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** 4.1 –ë–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã
**–í—Ä–µ–º—è:** ~1 —á–∞—Å

---

## –ó–∞–¥–∞—á–∞

–°–æ–∑–¥–∞—Ç—å generic –≤–µ—Ä—Å–∏—é –∫–æ–º–∞–Ω–¥—ã `connect`, –∫–æ—Ç–æ—Ä–∞—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–∞—Å—Ç–æ–º–∏–∑–∏—Ä—É–µ–º—ã–µ –ø—Ä–æ–º–ø—Ç—ã –∏–∑ InteractivePrompter.

---

## –î–µ–π—Å—Ç–≤–∏—è

### 1. –°–æ–∑–¥–∞—Ç—å connect –∫–æ–º–∞–Ω–¥—É

**–§–∞–π–ª:** `src/commands/connect.command.ts`

```typescript
import type { ConnectorRegistry } from '../connectors/registry.js';
import type { ConfigManager } from '../utils/config-manager.js';
import type { InteractivePrompter } from '../utils/interactive-prompter.js';
import type { BaseMCPServerConfig } from '../types.js';
import { Logger } from '../utils/logger.js';
import { isError } from '@mcp-framework/infrastructure';

export interface ConnectCommandOptions<TConfig extends BaseMCPServerConfig> {
  /** –†–µ–µ—Å—Ç—Ä –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä–æ–≤ */
  registry: ConnectorRegistry<TConfig>;

  /** –ú–µ–Ω–µ–¥–∂–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ */
  configManager: ConfigManager<TConfig>;

  /** Prompter –¥–ª—è —Å–±–æ—Ä–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ */
  prompter: InteractivePrompter<TConfig>;

  /** CLI –æ–ø—Ü–∏–∏ */
  cliOptions?: {
    client?: string;
  };
}

export async function connectCommand<TConfig extends BaseMCPServerConfig>(
  options: ConnectCommandOptions<TConfig>
): Promise<void> {
  const { registry, configManager, prompter, cliOptions } = options;

  Logger.header('üîå –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ MCP —Å–µ—Ä–≤–µ—Ä–∞');
  Logger.newLine();

  // 1. –ù–∞–π—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã
  const spinner = Logger.spinner('–ü–æ–∏—Å–∫ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö MCP –∫–ª–∏–µ–Ω—Ç–æ–≤...');
  const installedClients = await registry.findInstalled();
  spinner.stop();

  if (installedClients.length === 0) {
    Logger.error('–ù–µ –Ω–∞–π–¥–µ–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö MCP –∫–ª–∏–µ–Ω—Ç–æ–≤');
    Logger.info('–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –∫–ª–∏–µ–Ω—Ç—ã: Claude Desktop, Claude Code, Codex, Gemini, Qwen');
    Logger.info('–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∏–∑ –Ω–∏—Ö –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è');
    return;
  }

  Logger.success(`–ù–∞–π–¥–µ–Ω–æ ${installedClients.length} —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–∞(–æ–≤)`);
  Logger.newLine();

  // 2. –í—ã–±—Ä–∞—Ç—å –∫–ª–∏–µ–Ω—Ç
  let connector;
  if (cliOptions?.client) {
    connector = registry.get(cliOptions.client);
    if (!connector) {
      Logger.error(`–ö–ª–∏–µ–Ω—Ç "${cliOptions.client}" –Ω–µ –Ω–∞–π–¥–µ–Ω`);
      return;
    }

    const isInstalled = await connector.isInstalled();
    if (!isInstalled) {
      Logger.error(`–ö–ª–∏–µ–Ω—Ç "${cliOptions.client}" –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω`);
      return;
    }

    Logger.info(`–í—ã–±—Ä–∞–Ω –∫–ª–∏–µ–Ω—Ç: ${connector.getClientInfo().displayName}`);
  } else {
    const clientInfos = installedClients.map((c) => c.getClientInfo());
    const selectedName = await InteractivePrompter.promptClientSelection(clientInfos);
    connector = registry.get(selectedName);
  }

  if (!connector) {
    Logger.error('–ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã–±—Ä–∞—Ç—å –∫–ª–∏–µ–Ω—Ç');
    return;
  }

  Logger.newLine();

  // 3. –°–æ–±—Ä–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
  const savedConfig = await configManager.load();
  if (savedConfig) {
    Logger.info('–ù–∞–π–¥–µ–Ω–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (—Å–µ–∫—Ä–µ—Ç–Ω—ã–µ –ø–æ–ª—è –±—É–¥—É—Ç –∑–∞–ø—Ä–æ—à–µ–Ω—ã –∑–∞–Ω–æ–≤–æ)');
  }

  const serverConfig = await prompter.promptServerConfig(savedConfig);
  const config = {
    ...serverConfig,
    projectPath: process.cwd(),
  } as TConfig;

  Logger.newLine();

  // 4. –í–∞–ª–∏–¥–∞—Ü–∏—è
  const errors = await connector.validateConfig(config);
  if (errors.length > 0) {
    Logger.error('–û—à–∏–±–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:');
    errors.forEach((err) => Logger.error(`  - ${err}`));
    return;
  }

  // 5. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
  const connectSpinner = Logger.spinner(`–ü–æ–¥–∫–ª—é—á–∞—é –∫ ${connector.getClientInfo().displayName}...`);

  try {
    await connector.connect(config);
    connectSpinner.succeed(
      `MCP —Å–µ—Ä–≤–µ—Ä —É—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ ${connector.getClientInfo().displayName}!`
    );

    const status = await connector.getStatus();
    if (status.details) {
      Logger.info(`–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: ${status.details.configPath}`);
    }
  } catch (error) {
    const errorMessage = isError(error) ? error.message : String(error);
    connectSpinner.fail(`–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ${errorMessage}`);
    return;
  }

  Logger.newLine();

  // 6. –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
  const shouldSave = await InteractivePrompter.promptConfirmation(
    '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ä–∞–∑–∞?',
    true
  );

  if (shouldSave) {
    await configManager.save(config);
    Logger.success('–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ (—Å–µ–∫—Ä–µ—Ç–Ω—ã–µ –ø–æ–ª—è –∏—Å–∫–ª—é—á–µ–Ω—ã)');
  }

  Logger.newLine();
  Logger.success('‚úÖ –ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å MCP —Å–µ—Ä–≤–µ—Ä –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–º –∫–ª–∏–µ–Ω—Ç–µ.');
}
```

### 2. –û–±–Ω–æ–≤–∏—Ç—å exports

**–§–∞–π–ª:** `src/commands/index.ts`

```typescript
export * from './status.command.js';
export * from './list.command.js';
export * from './disconnect.command.js';
export * from './connect.command.js';
```

---

## –†–µ–∑—É–ª—å—Ç–∞—Ç

- [ ] `connect.command.ts` —Å–æ–∑–¥–∞–Ω
- [ ] Exports –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- [ ] `npm run build` –ø—Ä–æ—Ö–æ–¥–∏—Ç
- [ ] `npm run typecheck` –ø—Ä–æ—Ö–æ–¥–∏—Ç

---

## –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

- [ ] Connect –∫–æ–º–∞–Ω–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å generic —Ç–∏–ø–∞–º–∏
- [ ] –ò—Å–ø–æ–ª—å–∑—É–µ—Ç InteractivePrompter –¥–ª—è —Å–±–æ—Ä–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- [ ] –ò—Å–ø–æ–ª—å–∑—É–µ—Ç ConfigManager –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
- [ ] –ù–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –æ—Ç YT —Å–ø–µ—Ü–∏—Ñ–∏–∫–∏
