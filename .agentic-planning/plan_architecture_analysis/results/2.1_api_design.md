# API Design Analysis

**Date:** 2025-11-21
**Scope:** Framework packages (infrastructure, core, search)

---

## üìã Evaluation Criteria

1. **Minimal Public API** - Only expose what's needed
2. **Clear Entry Points** - Easy to understand what to import
3. **No Internal Leakage** - Implementation details hidden
4. **Modular Exports** - Granular imports possible
5. **Type Safety** - All exports properly typed
6. **Documentation** - Clear what each export does

---

## Infrastructure Package API

### Main Entry Point (`@mcp-framework/infrastructure`)

```typescript
// HTTP Layer
export * from './http/index.js';

// Cache Layer
export * from './cache/index.js';

// Async utilities
export * from './async/index.js';

// Logging
export * from './logging/index.js';

// Config (‚ö†Ô∏è domain-specific)
export { loadConfig } from './config.js';

// Constants (‚ö†Ô∏è some domain-specific)
export * from './constants.js';

// Types (‚ö†Ô∏è some domain-specific)
export * from './types.js';
```

### Granular Imports (`package.json` exports)

```json
{
  "exports": {
    ".": "./dist/index.js",           // Main entry
    "./http": "./dist/http/index.js", // HTTP only
    "./cache": "./dist/cache/index.js", // Cache only
    "./logging": "./dist/logging/index.js", // Logging only
    "./config": "./dist/config.js",    // Config only
    "./*": "./dist/*"                   // Wildcard for flexibility
  }
}
```

### ‚úÖ Strengths

1. **Modular Exports** - Can import specific layers:
   ```typescript
   import { HttpClient } from '@mcp-framework/infrastructure/http';
   import { Logger } from '@mcp-framework/infrastructure/logging';
   ```

2. **Clear Structure** - Organized by layer (http, cache, logging, async)

3. **Wildcard Export** - Flexibility for advanced use cases

### ‚ö†Ô∏è Issues

1. **Exports Domain-Specific Code:**
   - `loadConfig()` - Yandex Tracker specific
   - `DEFAULT_API_BASE` - https://api.tracker.yandex.net
   - `ENV_VAR_NAMES` - YANDEX_TRACKER_TOKEN, etc.
   - `ServerConfig` type - Yandex Tracker specific
   - `ParsedCategoryFilter` - Tool categories (domain-specific)
   - `EntityType` enum - Issue, Queue, Comment (domain-specific)

2. **Too Many Exports from Main Entry:**
   - 70+ exports from `index.ts`
   - Unclear what's essential vs optional
   - Recommendation: Keep main export minimal, rely on granular imports

### API Design Score: 6/10

**Rationale:**
- ‚úÖ Good modular structure
- ‚úÖ Granular imports available
- ‚ùå Major: Exports domain-specific code
- ‚ö†Ô∏è Too many exports from main entry

---

## Core Package API

### Main Entry Point (`@mcp-framework/core`)

```typescript
// Base classes
export * from './tools/base/index.js';
export * from './tools/common/index.js';

// Definition Generator (auto-generation from Zod schema)
export * from './definition/index.js';

// Utils
export * from './utils/index.js';

// Registry
export * from './tool-registry.js';
```

### Granular Imports (`package.json` exports)

```json
{
  "exports": {
    ".": "./dist/index.js",           // Main entry
    "./tools": "./dist/tools/index.js", // Tools only
    "./utils": "./dist/utils/index.js", // Utils only
    "./*": "./dist/*"                    // Wildcard
  }
}
```

### ‚úÖ Strengths

1. **Clean Separation:**
   - Tools (BaseTool, metadata, definitions)
   - Utils (batch processing, field filtering, logging)
   - Registry (tool management)
   - Definition generator (schema-to-definition)

2. **Zero Domain Coupling:**
   - All exports are framework-level
   - No Yandex Tracker specific code
   - 100% reusable

3. **Type-Only Exports:**
   ```typescript
   export type { ToolDefinition, ToolMetadata, StaticToolMetadata };
   ```
   Properly uses `type` keyword for type-only exports (tree-shaking friendly)

4. **Logical Grouping:**
   - `/tools` - For tool developers
   - `/utils` - For utility functions
   - Main export - Everything

### ‚ö†Ô∏è Minor Issues

1. **No Explicit Definition Export:**
   - Could add `./definition` for explicit import:
   ```json
   "./definition": "./dist/definition/index.js"
   ```

2. **ToolRegistry Not in Sub-Export:**
   - Only available from main entry
   - Could add `./registry` for consistency

### API Design Score: 9/10

**Rationale:**
- ‚úÖ Clean, minimal API
- ‚úÖ Zero domain coupling
- ‚úÖ Good modular structure
- ‚úÖ Proper use of `type` exports
- ‚ö†Ô∏è Minor: Could add more granular exports

---

## Search Package API

### Main Entry Point (`@mcp-framework/search`)

```typescript
// –¢–∏–ø—ã
export type { StaticToolIndex, SearchResult, SearchParams, ... };

// –í–µ—Å–∞
export { STRATEGY_WEIGHTS } from './scoring/strategy-weights.js';

// –°—Ç—Ä–∞—Ç–µ–≥–∏–∏
export type { ISearchStrategy } from './strategies/index.js';
export { NameSearchStrategy, DescriptionSearchStrategy, ... };

// –ü–æ–∏—Å–∫–æ–≤—ã–π –¥–≤–∏–∂–æ–∫
export { ToolSearchEngine } from './engine/tool-search-engine.js';

// Tools (SearchToolsTool)
export * from './tools/search-tools.tool.js';
export * from './tools/search-tools.definition.js';
export * from './tools/search-tools.schema.js';

// Constants
export * from './constants.js';

// Generated index (‚ö†Ô∏è deprecated, domain-specific)
export { TOOL_SEARCH_INDEX } from './generated-index.js';

// Dynamic index builder
export { buildIndexFromRegistry } from './utils/build-index-from-registry.js';
```

### Granular Imports (`package.json` exports)

```json
{
  "exports": {
    ".": "./dist/index.js",
    "./engine": "./dist/engine/index.js",
    "./tool-search-engine.js": "./dist/engine/tool-search-engine.js",
    "./strategies": "./dist/strategies/index.js",
    "./strategies/*.js": "./dist/strategies/*.js",  // Individual strategies
    "./types.js": "./dist/types.js"
  }
}
```

### ‚úÖ Strengths

1. **Excellent Granularity:**
   ```typescript
   // Import only what you need
   import { ToolSearchEngine } from '@mcp-framework/search/engine';
   import { FuzzySearchStrategy } from '@mcp-framework/search/strategies';
   import type { SearchParams } from '@mcp-framework/search/types.js';
   ```

2. **Clear API Layers:**
   - Engine - Core search functionality
   - Strategies - Search algorithms
   - Types - TypeScript definitions
   - Utils - Helper functions

3. **Strategy Pattern Exposed:**
   - Easy to import individual strategies
   - Clear extension point

4. **Type-Only Exports:**
   - Proper use of `export type` for interfaces
   - Tree-shaking friendly

5. **Deprecation Notice:**
   ```typescript
   // Generated index (deprecated - use buildIndexFromRegistry instead)
   export { TOOL_SEARCH_INDEX } from './generated-index.js';
   ```
   Good documentation of deprecated exports

### ‚ö†Ô∏è Issues

1. **Exports Domain-Specific Index:**
   ```typescript
   // TOOL_SEARCH_INDEX contains Yandex Tracker tools
   export const TOOL_SEARCH_INDEX: readonly StaticToolIndex[] = [
     { name: 'fr_yandex_tracker_ping', ... },
     { name: 'fr_yandex_tracker_get_issues', ... },
     // ...
   ];
   ```

   **Impact:**
   - Framework package leaks domain data
   - Cannot be reused for other projects as-is
   - Already deprecated, should be removed after moving to yandex-tracker

2. **Inconsistent File Extension:**
   ```json
   "./tool-search-engine.js": "./dist/engine/tool-search-engine.js",
   "./types.js": "./dist/types.js"
   ```

   Why `.js` extension in exports path?
   - Not needed (works without it)
   - Inconsistent with other exports (`./engine` has no extension)

### API Design Score: 8/10

**Rationale:**
- ‚úÖ Excellent granularity
- ‚úÖ Clear strategy pattern exposure
- ‚úÖ Good type safety
- ‚ùå Exports domain-specific index
- ‚ö†Ô∏è Minor: Inconsistent naming conventions

---

## üìä Comparison Table

| Aspect | Infrastructure | Core | Search |
|--------|---------------|------|--------|
| **Entry Point Clarity** | 7/10 | 9/10 | 9/10 |
| **Granular Imports** | 8/10 | 8/10 | 10/10 |
| **Domain Coupling** | ‚ùå 3/10 | ‚úÖ 10/10 | ‚ö†Ô∏è 7/10 |
| **Type Safety** | 9/10 | 10/10 | 10/10 |
| **Documentation** | 6/10 | 8/10 | 9/10 |
| **Extensibility** | 8/10 | 9/10 | 10/10 |
| **Overall** | **6.8/10** | **9.0/10** | **9.2/10** |

---

## üí° Key Takeaways

### Strengths
1. **üèÜ Search has best API design** - Excellent granularity, clear structure
2. **üèÜ Core has cleanest API** - Zero domain coupling, logical grouping
3. **üèÜ All packages use granular exports** - Can import specific parts

### Critical Issues
1. **üî¥ Infrastructure exports domain code** - Blocks reusability
2. **üü° Search exports domain index** - Already deprecated, needs removal

### Recommendations

**Infrastructure:**
1. Move `config.ts`, `constants.ts` (domain parts) to yandex-tracker
2. Keep only generic types/interfaces in infrastructure
3. Reduce main export size (rely on granular imports)

**Core:**
1. ‚úÖ Already excellent, no changes needed
2. (Optional) Add `./definition` and `./registry` exports for consistency

**Search:**
1. Remove `TOOL_SEARCH_INDEX` after moving to yandex-tracker
2. Fix inconsistent export naming (`.js` extension)
3. ‚úÖ Otherwise excellent

---

## üéØ Best Practices Observed

### 1. **Package.json Exports Map**
All packages use modern `exports` field:
```json
{
  "exports": {
    ".": "./dist/index.js",        // Main entry
    "./feature": "./dist/feature/index.js", // Granular
    "./*": "./dist/*"                // Wildcard for advanced use
  }
}
```

### 2. **Type-Only Exports**
```typescript
export type { ISearchStrategy, ToolDefinition, SearchParams };
```
Proper use of `type` keyword for tree-shaking

### 3. **Index Files as Re-exporters**
```typescript
// src/index.ts
export * from './module-a/index.js';
export * from './module-b/index.js';
```
Clear, predictable structure

### 4. **Comments in Main Export**
```typescript
// Definition Generator (auto-generation from Zod schema)
export * from './definition/index.js';
```
Helps developers understand what they're importing

---

## üîó Related Files

- [Infrastructure Package Analysis](./2.1_infrastructure_analysis.md)
- [Core Package Analysis](./2.1_core_analysis.md)
- [Search Package Analysis](./2.1_search_analysis.md)
- [Cross-Package Patterns](./2.1_cross_package_patterns.md)
