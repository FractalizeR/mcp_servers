# План унификации MCP серверов

**Дата создания:** 2025-12-09
**Цель:** Привести все MCP серверы к единому стандарту качества

---

## Текущее состояние

| Сервер | Покрытие Lines | Smoke тесты | Скрипты | Статус |
|--------|----------------|-------------|---------|--------|
| yandex-tracker | 85.97% | 5/5 | Все | ✅ Эталон |
| yandex-wiki | 51.09% | 1/5 | Частично | ❌ Требует работы |
| ticktick | 37.15% | 2/5 | Частично | ❌ Требует работы |

**Текущие пороги (нереалистичны):** 90/90/85/90
**Новые пороги (реалистичны):** 80/80/75/80

---

## Принятые решения

### 1. Пороги покрытия
**Решение:** Снизить до 80/80/75/80

**Обоснование:**
- yandex-tracker (эталон) имеет 85.97% - это хороший уровень
- Достижение 90% требует тестирования edge cases которые не добавляют ценности
- 80% - разумный порог для production-ready кода
- После снижения: tracker проходит сразу, wiki/ticktick требуют ~30-40% дополнительных тестов

### 2. Smoke тесты
**Решение:** Добавить все 5 обязательных тестов

**Обоснование:**
- Smoke тесты критичны для предотвращения регрессий
- Можно скопировать из tracker и адаптировать
- Трудоёмкость: ~2-3 часа на сервер

### 3. Служебные скрипты
**Решение:** Скопировать из tracker и адаптировать

**Обоснование:**
- generate-tool-index.ts - автоматизирует регистрацию tools
- validate-tool-registration.ts - предотвращает ошибки
- schema-definition-matcher.ts - нужен для smoke тестов

### 4. Unit тесты для покрытия
**Решение:** Добавить базовые тесты для достижения 80%

**Приоритеты тестирования:**
1. Operations (HTTP вызовы) - много логики
2. Tools (execute методы) - бизнес логика
3. Facade/Services - оркестрация

---

## Структура плана

```
1_lower_thresholds_sequential.md     - Снижение порогов (1 изменение)
2.1_smoke_tests_wiki_parallel.md     - Smoke тесты для Wiki
2.2_smoke_tests_ticktick_parallel.md - Smoke тесты для TickTick
3.1_scripts_wiki_parallel.md         - Скрипты для Wiki
3.2_scripts_ticktick_parallel.md     - Скрипты для TickTick
4.1_unit_tests_wiki_parallel.md      - Unit тесты для Wiki
4.2_unit_tests_ticktick_parallel.md  - Unit тесты для TickTick
5_validation_sequential.md           - Финальная валидация
```

---

## Оценка трудоёмкости

| Этап | Wiki | TickTick | Итого |
|------|------|----------|-------|
| Снижение порогов | - | - | 10 мин |
| Smoke тесты | 2-3 часа | 2-3 часа | 4-6 часов |
| Служебные скрипты | 1-2 часа | 1-2 часа | 2-4 часа |
| Unit тесты для 80% | 4-6 часов | 6-8 часов | 10-14 часов |
| Валидация | - | - | 30 мин |
| **Итого** | 7-11 часов | 9-13 часов | **17-25 часов** |

---

## Порядок выполнения

```
[1] Снижение порогов (sequential)
         ↓
    ┌────┴────┐
    ↓         ↓
[2.1] Wiki  [2.2] TickTick  ← Smoke тесты (parallel)
    ↓         ↓
[3.1] Wiki  [3.2] TickTick  ← Скрипты (parallel)
    ↓         ↓
[4.1] Wiki  [4.2] TickTick  ← Unit тесты (parallel)
    └────┬────┘
         ↓
[5] Финальная валидация (sequential)
```

---

## Критерии успеха

- [ ] Все серверы проходят `npm run validate`
- [ ] Покрытие ≥80% во всех серверах
- [ ] 5/5 smoke тестов в каждом сервере
- [ ] Все служебные скрипты работают
- [ ] `npm run test:smoke:server` проходит
