# Этап 3.2: Служебные скрипты для TickTick (parallel)

**Время:** ~1-2 часа
**Зависимости:** Этап 2.2 (smoke тесты ticktick)
**Параллельно с:** 3.1 (Wiki скрипты)

---

## Задача

Добавить служебные скрипты в ticktick:
1. `scripts/generate-tool-index.ts`
2. `scripts/validate-tool-registration.ts`

---

## Чеклист

### Скрипты
- [x] Создать `scripts/generate-tool-index.ts`
- [x] Создать `scripts/validate-tool-registration.ts`

### package.json
- [x] Добавить `"prebuild": "npm run generate:index"`
- [x] Добавить `"generate:index": "tsx scripts/generate-tool-index.ts"`
- [x] Добавить `"validate:tools": "tsx scripts/validate-tool-registration.ts"`

### Валидация
- [x] `npm run generate:index` работает
- [x] `npm run validate:tools` работает (обнаружены отсутствующие safety флаги - отдельная задача)
- [x] `npm run build` включает prebuild

---

## Источники для копирования

**Из yandex-tracker:**
- `scripts/generate-tool-index.ts`
- `scripts/validate-tool-registration.ts`

---

## generate-tool-index.ts

### Адаптации для TickTick

```typescript
// Константы для TickTick
const TOOLS_DIR = path.join(__dirname, '../src/tools');
const OUTPUT_FILE = path.join(TOOLS_DIR, 'generated-index.ts');
const TOOL_FILE_PATTERN = /\.tool\.ts$/;

// Особенность TickTick: tools разбиты на api/ и tasks/
// Скрипт должен сканировать обе директории
```

### Структура tools в TickTick

```
src/tools/
├── api/
│   ├── date-queries/
│   └── projects/
├── tasks/
│   ├── get-task/
│   ├── create-task/
│   └── ...
├── helpers/
│   └── ping/
└── shared/
    └── filter-fields.ts  # НЕ tool, игнорировать!
```

### Что делает скрипт

1. Сканирует `src/tools/` рекурсивно
2. Находит все файлы `*.tool.ts`
3. Игнорирует `shared/` директорию (там утилиты, не tools)
4. Генерирует `generated-index.ts`

---

## validate-tool-registration.ts

### Адаптации для TickTick

```typescript
// Импорты для TickTick
import { TOOL_CLASSES } from '../src/composition-root/definitions/tool-definitions.js';

// Путь к tools
const TOOLS_DIR = path.join(__dirname, '../src/tools');

// Игнорируем shared/ директорию
const IGNORE_DIRS = ['shared'];
```

### Что проверяет скрипт

1. Все `*.tool.ts` файлы найдены (кроме shared/)
2. Каждый Tool класс добавлен в `TOOL_CLASSES`
3. Каждый Tool имеет static `METADATA`
4. Каждый Tool имеет метод `getParamsSchema()`

---

## Изменения в package.json

```json
{
  "scripts": {
    "prebuild": "npm run generate:index",
    "generate:index": "tsx scripts/generate-tool-index.ts",
    "validate:tools": "tsx scripts/validate-tool-registration.ts"
  }
}
```

---

## Важные отличия TickTick

1. **Структура tools/** - разбита на `api/`, `tasks/`, `helpers/`
2. **shared/ директория** - содержит утилиты, НЕ tools
3. **Нет tracker_api/** - используется `ticktick_api/`

---

## Валидация

```bash
cd packages/servers/ticktick

# Генерация индекса
npm run generate:index
# Проверить что создан src/tools/generated-index.ts

# Валидация регистрации
npm run validate:tools
# Должно вывести: "Все инструменты корректно зарегистрированы!"

# Полная сборка (включает prebuild)
npm run build
```

---

## Коммит

```
feat(ticktick): добавить служебные скрипты

Добавлены скрипты:
- generate-tool-index.ts - автогенерация индекса tools
- validate-tool-registration.ts - проверка регистрации tools

Обновлён package.json:
- Добавлен prebuild для автогенерации
- Добавлена команда validate:tools
```
