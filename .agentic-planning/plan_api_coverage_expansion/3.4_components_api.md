# Этап 3.4: Components API (Компоненты)

**Статус:** ⏪ Не начат
**Приоритет:** Важный
**Время:** 3-5 дней
**Зависимости:** `1.1_preparation.md`, `2.3_queues_api.md` ⚠️
**Параллельность:** ⚠️ Частичная (после Queues API)

## Цель
Реализовать работу с компонентами очередей - создание, получение, обновление, удаление.

## API Endpoints

| Метод | Endpoint | Описание |
|-------|----------|----------|
| GET | `/v3/queues/{queueId}/components` | Получить компоненты очереди |
| POST | `/v3/queues/{queueId}/components` | Создать компонент |
| PATCH | `/v3/components/{componentId}` | Обновить компонент |
| DELETE | `/v3/components/{componentId}` | Удалить компонент |

## MCP Tools (4)

1. `yandex_tracker_get_components`
2. `yandex_tracker_create_component`
3. `yandex_tracker_update_component`
4. `yandex_tracker_delete_component`

---

## Зависимости

⚠️ **Требует Queues API:**
- Компоненты привязаны к очередям
- CreateComponentInput использует queueId

**Можно начать после завершения `2.3_queues_api.md`**

---

## Структура реализации

### 1. Entities
- [ ] `component.entity.ts`
  ```typescript
  export interface Component extends WithUnknownFields {
    id: string;
    self: string;
    version: number;
    name: string;
    description?: string;
    lead?: UserRef;
    assignAuto: boolean;
    queue: {
      id: string;
      key: string;
      display: string;
    };
  }
  ```

### 2. DTO
- [ ] `create-component.input.ts`
  ```typescript
  export interface CreateComponentInput {
    name: string;
    queueId: string;        // Ключ очереди
    description?: string;
    lead?: string;          // ID пользователя
    assignAuto?: boolean;   // Автоназначение ответственного
  }
  ```
- [ ] `update-component.input.ts` - Partial (без queueId)
- [ ] Output DTO

### 3. Operations (4)
- [ ] GetComponentsOperation (by queue)
- [ ] CreateComponentOperation
- [ ] UpdateComponentOperation
- [ ] DeleteComponentOperation
- [ ] Unit-тесты

### 4. Tools (4)
- [ ] get-components tool + tests
  - Schema: `queueId` (required)
- [ ] create-component tool + tests
  - Валидация queueId существует
- [ ] update-component tool + tests
- [ ] delete-component tool + tests

### 5. Infrastructure
- [ ] DI registration
- [ ] Fixtures
- [ ] Документация (связь с очередями)

### 6. Validation & Tests
- [ ] Unit tests ≥90%
- [ ] Integration tests
- [ ] Тесты связей с очередями
- [ ] `npm run validate`

### 7. Commit
- [ ] `feat: добавить поддержку Components API`
- [ ] Push + update overview

---

## Примеры

```json
// Создать компонент
{
  "name": "yandex_tracker_create_component",
  "arguments": {
    "name": "Backend API",
    "queueId": "MOBILE",
    "description": "Backend services and API endpoints",
    "lead": "backend.lead",
    "assignAuto": true
  }
}

// Получить компоненты очереди
{
  "name": "yandex_tracker_get_components",
  "arguments": {
    "queueId": "MOBILE"
  }
}
```

---

**Создано:** 2025-01-18
