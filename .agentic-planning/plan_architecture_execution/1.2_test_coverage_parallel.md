# –≠—Ç–∞–ø 1.2: Test Coverage Improvements (PARALLEL)

**–í—Ä–µ–º—è:** 9-10.5 —á–∞—Å–æ–≤
**–¢–∏–ø:** PARALLEL (Agent 1)
**–í–µ—Ç–∫–∞:** `claude/execution-1.2-test-coverage-{session_id}`

## üéØ –¶–µ–ª—å

Coverage 89% ‚Üí 95%+, Grade B+ ‚Üí A-

## üìã –ó–∞–¥–∞—á–∏

### Task 1: ZodJsonSchemaAdapter (2—á)
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö Zod primitive types
- [ ] –¢–µ—Å—Ç—ã –¥–ª—è modifiers (optional, nullable)
- [ ] –¢–µ—Å—Ç—ã –¥–ª—è complex types (array, object, union)
- [ ] Edge cases
- [ ] Coverage: 53% ‚Üí 95%

### Task 2: ToolSearchEngine (2—á)
- [ ] –¢–µ—Å—Ç—ã –¥–ª—è search strategies
- [ ] Edge cases (empty query, special chars)
- [ ] Performance scenarios
- [ ] Coverage: 71% ‚Üí 95%

### Task 3: HttpClient (1.5—á)
- [ ] Retry logic tests
- [ ] Timeout scenarios
- [ ] Error handling (network, HTTP codes)
- [ ] Coverage: 69% ‚Üí 90%

### Task 4: Smoke Tests (2—á)

**‚ö†Ô∏è –°–¢–†–ê–¢–ï–ì–ò–Ø –û–ö–†–£–ñ–ï–ù–ò–ô:**

**–¢–µ–∫—É—â–∏–π smoke test (`scripts/smoke-test-server.ts`):**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç **fake —Ç–æ–∫–µ–Ω—ã** (–Ω–µ —Ö–æ–¥–∏—Ç –≤ —Ä–µ–∞–ª—å–Ω—ã–π API)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–ª—å–∫–æ `tools/list` (—Å—Ç—Ä—É–∫—Ç—É—Ä—É MCP)
- ‚ùå **–ù–ï –ø—Ä–æ–≤–µ—Ä—è–µ—Ç** —Ä–µ–∞–ª—å–Ω—É—é connectivity —Å Yandex Tracker API

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ü–ª–∞–Ω —É–ø–æ–º–∏–Ω–∞–µ—Ç `api-connectivity.smoke.test.ts`
- –ù–µ—è—Å–Ω–æ: —Ä–µ–∞–ª—å–Ω—ã–π API –∏–ª–∏ mocks?
- –ö–∞–∫ —É–ø—Ä–∞–≤–ª—è—Ç—å secrets –≤ CI?

**–†–µ—à–µ–Ω–∏–µ (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–ê–Ø –°–¢–†–ê–¢–ï–ì–ò–Ø):**

1. **MCP Lifecycle Tests** (–±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ API):
   - `mcp-server-lifecycle.smoke.test.ts` ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ—Ç MCP protocol
   - `tool-search.smoke.test.ts` ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ—Ç ToolSearchEngine
   - `di-container.smoke.test.ts` ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ—Ç DI –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
   - **–û–∫—Ä—É–∂–µ–Ω–∏–µ:** –í—Å–µ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è (fake tokens)

2. **API Connectivity Tests** (—Ä–µ–∞–ª—å–Ω—ã–π API):
   - `api-connectivity.smoke.test.ts` ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π Yandex API
   - **–û–∫—Ä—É–∂–µ–Ω–∏–µ:** –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ `YANDEX_TRACKER_TOKEN` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
   - **CI Fallback:** –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è —Å `test.skip()` –µ—Å–ª–∏ –Ω–µ—Ç —Ç–æ–∫–µ–Ω–∞
   - **–õ–æ–∫–∞–ª—å–Ω–æ:** –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –º–æ–∂–µ—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å —Ä–µ–∞–ª—å–Ω—ã–º —Ç–æ–∫–µ–Ω–æ–º

3. **E2E Tool Execution** (–∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π):
   - `e2e-tool-execution.smoke.test.ts` ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–ª–Ω—ã–π flow
   - **–û–∫—Ä—É–∂–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç mock HttpClient (–∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—ã–µ –æ—Ç–≤–µ—Ç—ã)
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç: MCP ‚Üí Tool ‚Üí Operation ‚Üí DTO mapping (–±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ API)

**–ü—Ä–∏–º–µ—Ä —É—Å–ª–æ–≤–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞:**
```typescript
// api-connectivity.smoke.test.ts
import { describe, it, test } from 'vitest';

const hasRealToken = !!process.env.YANDEX_TRACKER_TOKEN;

describe.skipIf(!hasRealToken)('API Connectivity Smoke Tests', () => {
  it('should connect to real Yandex Tracker API', async () => {
    // –†–µ–∞–ª—å–Ω—ã–π API call
  });
});
```

**–®–∞–≥–∏ Task 4:**
- [ ] `mcp-server-lifecycle.smoke.test.ts` (30 –º–∏–Ω, fake tokens)
- [ ] `api-connectivity.smoke.test.ts` (40 –º–∏–Ω, conditional –Ω–∞ YANDEX_TRACKER_TOKEN)
- [ ] `e2e-tool-execution.smoke.test.ts` (30 –º–∏–Ω, mock HttpClient)
- [ ] `tool-search.smoke.test.ts` (20 –º–∏–Ω, –±–µ–∑ API)
- [ ] `di-container.smoke.test.ts` (20 –º–∏–Ω, –±–µ–∑ API)
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `scripts/smoke-test-server.ts` —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–º –æ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ (10 –º–∏–Ω)

### Task 5: Logger (1—á)
- [ ] Log levels tests
- [ ] Formatting tests
- [ ] Child loggers tests
- [ ] Coverage: 75% ‚Üí 90%

### Task 6: Branches (30–º–∏–Ω)
- [ ] Branch conditions –≤ adapter
- [ ] Error branches
- [ ] Coverage: 84.9% ‚Üí 85%+

## ‚úÖ Success Criteria
- [ ] Average coverage ‚â•95%
- [ ] All packages pass thresholds
- [ ] –ö–æ–º–º–∏—Ç –∏ –ø—É—à
