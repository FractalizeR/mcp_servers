# –≠—Ç–∞–ø 2.2: ToolRegistry Refactoring (SEQUENTIAL)

**–í—Ä–µ–º—è:** 4-6 —á–∞—Å–æ–≤
**–¢–∏–ø:** SEQUENTIAL
**–í–µ—Ç–∫–∞:** `claude/execution-2.2-tool-registry-{session_id}`
**Depends on:** –≠—Ç–∞–ø 1.1 (Infrastructure extraction)

## ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- `tool-registry.ts`: **549 LOC, complexity 28**
- **–ù–ï–¢ –¢–ï–°–¢–û–í** –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è
- –ü–ª–∞–Ω —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –±–µ–∑ —Ñ–∏–∫—Å–∞—Ü–∏–∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ = **–†–ò–°–ö –†–ï–ì–†–ï–°–°–ò–ò**

**–†–µ—à–µ–Ω–∏–µ:**
1. ‚úÖ **–ü–ï–†–í–´–ú –î–ï–õ–û–ú**: –ù–∞–ø–∏—Å–∞—Ç—å contract tests (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã)
2. ‚úÖ –¢–æ–ª—å–∫–æ –ø–æ—Ç–æ–º —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏—Ç—å
3. ‚úÖ Contract tests –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—é—Ç: refactoring –Ω–µ —Å–ª–æ–º–∞–µ—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ

---

## üéØ –¶–µ–ª—å

549 —Å—Ç—Ä–æ–∫ ‚Üí 150-200 —Å—Ç—Ä–æ–∫, complexity 28 ‚Üí 12

## üìã –ó–∞–¥–∞—á–∏

### Task 0: Contract Tests (1-1.5—á) **–ü–ï–†–í–´–ú –î–ï–õ–û–ú!**

**–¶–µ–ª—å:** –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–æ–º

**–ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:**
1. **Registration:** `register(tool)` –¥–æ–±–∞–≤–ª—è–µ—Ç tool –≤ registry
2. **Duplicates:** `register(tool)` —Å –¥—É–±–ª–∏—Ä—É—é—â–∏–º—Å—è id –Ω–µ –¥–æ–±–∞–≤–ª—è–µ—Ç –¥–≤–∞–∂–¥—ã
3. **List all:** `getTools()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ tools
4. **Filter by name:** `getTools({ name: 'foo' })` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ matching tools
5. **Filter by category:** `getTools({ category: 'issues' })` —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
6. **Sorting:** `getTools({ sort: 'name' })` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç tools –≤ –∞–ª—Ñ–∞–≤–∏—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
7. **Combined filters:** `getTools({ name: 'foo', category: 'bar' })` –ø—Ä–∏–º–µ–Ω—è–µ—Ç AND –ª–æ–≥–∏–∫—É
8. **Case-insensitive search:** name filter —Ä–µ–≥–∏—Å—Ç—Ä–æ–Ω–µ–∑–∞–≤–∏—Å–∏–º
9. **Pagination:** `getTools({ limit: 10, offset: 5 })` —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
10. **Empty registry:** `getTools()` –Ω–∞ –ø—É—Å—Ç–æ–º registry –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç []

**–®–∞–≥–∏:**
- [x] –°–æ–∑–¥–∞—Ç—å `tests/framework/core/tool-registry.contract.test.ts` (1—á) ‚úÖ
- [x] –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è 11 –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ (—Å–º. –≤—ã—à–µ) ‚úÖ
- [x] –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã: `npm run test tool-registry.contract` ‚úÖ (21/21 passed)
- [x] –ö–æ–º–º–∏—Ç: `test(tool-registry): add contract tests before refactoring` ‚úÖ (a49cc54)

**–ó–∞—á–µ–º —ç—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ:**
- ‚ùå **–ë–µ–∑ contract tests**: –ù–µ –∑–Ω–∞–µ–º —á—Ç–æ –∏–º–µ–Ω–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –ø—Ä–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ
- ‚úÖ **–° contract tests**: Refactoring –±–µ–∑–æ–ø–∞—Å–µ–Ω, regression impossible

---

### Task 1: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ (3-4—á)

–°–º. [CONSOLIDATED_EXECUTION_PLAN.md](../plan_architecture_analysis/CONSOLIDATED_EXECUTION_PLAN.md) —Å–µ–∫—Ü–∏—è "[F2.1]"

- [ ] –°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é tool-registry/
- [ ] Extract ToolFilterService (~150 —Å—Ç—Ä–æ–∫)
- [ ] Extract ToolSorter (~80 —Å—Ç—Ä–æ–∫)
- [ ] Update ToolRegistry (delegate) (~150 —Å—Ç—Ä–æ–∫)
- [ ] Update tests
- [ ] Validate

---

### Task 2: –§–∏–Ω–∞–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è (30 –º–∏–Ω)

- [ ] `npm run test tool-registry.contract` ‚Äî contract tests –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] `npm run validate:quiet` ‚Äî –≤—Å—ë –ø—Ä–æ—Ö–æ–¥–∏—Ç
- [ ] –ö–æ–º–º–∏—Ç: `refactor(tool-registry): split into ToolFilterService and ToolSorter`

---

## ‚úÖ Success Criteria
- [ ] Contract tests –Ω–∞–ø–∏—Å–∞–Ω—ã –∏ –ø—Ä–æ—Ö–æ–¥—è—Ç (BEFORE refactoring)
- [ ] tool-registry.ts <250 —Å—Ç—Ä–æ–∫
- [ ] All tests pass (including contract tests)
- [ ] –ö–æ–º–º–∏—Ç –∏ –ø—É—à
