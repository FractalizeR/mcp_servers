# –≠—Ç–∞–ø 1.1: Infrastructure Extraction (SEQUENTIAL)

**–í—Ä–µ–º—è:** 7-9 —á–∞—Å–æ–≤ (+1—á –Ω–∞ backwards compatibility)
**–¢–∏–ø:** SEQUENTIAL (–±–ª–æ–∫–∏—Ä—É–µ—Ç –≠—Ç–∞–ø 2)
**–í–µ—Ç–∫–∞:** `claude/execution-1.1-infrastructure-{session_id}`

## üéØ –¶–µ–ª—å

–ò–∑–≤–ª–µ—á—å domain-specific –∫–æ–¥ –∏–∑ infrastructure –ø–∞–∫–µ—Ç–∞ –≤ yandex-tracker **—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º backwards compatibility**.

## ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- `infrastructure/src/config.ts` —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç **domain-specific –∫–æ–¥** (ServerConfig, loadConfig)
- –£–∫–∞–∑–∞–Ω –∫–∞–∫ **–ø—É–±–ª–∏—á–Ω—ã–π API** –≤ infrastructure/README.md
- –ü—Ä—è–º–æ–π –ø–µ—Ä–µ–Ω–æ—Å = **BREAKING CHANGE** –¥–ª—è –ø–∞–∫–µ—Ç–∞ (v0.1.0 ‚Üí v0.2.0)
- **–ù–∞—Ä—É—à–∞–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø** –∏–∑ README: *"Infrastructure does NOT know about domain"*

**–†–µ—à–µ–Ω–∏–µ:**
1. ‚úÖ –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –∫–æ–¥ –≤ yandex-tracker
2. ‚úÖ –û—Å—Ç–∞–≤–∏—Ç—å **–≤—Ä–µ–º–µ–Ω–Ω—ã–π re-export** –≤ infrastructure —Å @deprecated
3. ‚úÖ Bump major version (0.1.0 ‚Üí **0.2.0** –∏–ª–∏ **1.0.0**)
4. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å README/ARCHITECTURE –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏

## üìã –î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω

**–ò—Å—Ç–æ—á–Ω–∏–∫:** `packages/framework/infrastructure/src/config.ts` (371 —Å—Ç—Ä–æ–∫–∞)
**–¶–µ–ª—å:** –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å domain-specific –∫–æ–¥ –≤ yandex-tracker

### –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤ yandex-tracker (30 –º–∏–Ω)

**1.1 –°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:**
```bash
mkdir -p packages/servers/yandex-tracker/src/config
```

**1.2 –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª—ã:**
- `config/server-config.interface.ts` - ServerConfig interface, —Ç–∏–ø—ã
- `config/config-loader.ts` - loadConfig() function
- `config/constants.ts` - DEFAULT_* –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
- `config/index.ts` - re-exports

**1.3 –ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
ls -la packages/servers/yandex-tracker/src/config/
```

---

### –®–∞–≥ 2: –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —Ç–∏–ø—ã –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã (40 –º–∏–Ω)

**–ß—Ç–æ –ø–µ—Ä–µ–Ω–æ—Å–∏–º –∏–∑ `infrastructure/src/config.ts` ‚Üí `yandex-tracker/src/config/server-config.interface.ts`:**

**2.1 –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏ —Ç–∏–ø—ã:**
- `ServerConfig` interface (–ø–æ–ª–Ω–æ—Å—Ç—å—é)
- `LogLevel` type
- `ParsedCategoryFilter` type
- `ToolDiscoveryMode` type
- `ConfigValidationError` class

**2.2 –ü—Ä–æ–≤–µ—Ä–∫–∞:**
```typescript
// –§–∞–π–ª –¥–æ–ª–∂–µ–Ω —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å:
export interface ServerConfig { /* ... */ }
export type LogLevel = 'debug' | 'info' | 'warn' | 'error';
export class ConfigValidationError extends Error { /* ... */ }
```

---

### –®–∞–≥ 3: –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã (30 –º–∏–Ω)

**–ß—Ç–æ –ø–µ—Ä–µ–Ω–æ—Å–∏–º –∏–∑ `infrastructure/src/constants.ts` ‚Üí `yandex-tracker/src/config/constants.ts`:**

**3.1 Domain-specific –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã (–ü–ï–†–ï–ù–û–°–ò–ú):**
- `DEFAULT_API_BASE` - 'https://api.tracker.yandex.net/v2'
- `DEFAULT_LOG_LEVEL` - 'info'
- `DEFAULT_REQUEST_TIMEOUT`
- `DEFAULT_MAX_BATCH_SIZE`
- `DEFAULT_MAX_CONCURRENT_REQUESTS`
- `DEFAULT_LOGS_DIR`
- `DEFAULT_LOG_MAX_SIZE`
- `DEFAULT_LOG_MAX_FILES`
- `DEFAULT_TOOL_DISCOVERY_MODE`
- `DEFAULT_ESSENTIAL_TOOLS`
- `ENV_VAR_NAMES` - –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

**3.2 Generic –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã (–û–°–¢–ê–í–õ–Ø–ï–ú –≤ infrastructure):**
- HTTP_* –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã (–µ—Å–ª–∏ –µ—Å—Ç—å)
- Cache-related –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã (–µ—Å–ª–∏ –µ—Å—Ç—å)

---

### –®–∞–≥ 4: –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –ª–æ–≥–∏–∫—É –∑–∞–≥—Ä—É–∑–∫–∏ (1-1.5—á)

**–ß—Ç–æ –ø–µ—Ä–µ–Ω–æ—Å–∏–º –∏–∑ `infrastructure/src/config.ts` ‚Üí `yandex-tracker/src/config/config-loader.ts`:**

**4.1 –§—É–Ω–∫—Ü–∏–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (–≤—Å–µ):**
- `validateLogLevel()`
- `validateTimeout()`
- `validateBatchSize()`
- `validateConcurrentRequests()`
- `parseToolCategoryFilter()`
- `parseBoolean()`

**4.2 –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è:**
- `loadConfig(): ServerConfig`

**4.3 –û–±–Ω–æ–≤–∏—Ç—å imports:**
```typescript
import type { ServerConfig, LogLevel } from './server-config.interface.js';
import {
  DEFAULT_API_BASE,
  DEFAULT_LOG_LEVEL,
  // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
} from './constants.js';
```

---

### –®–∞–≥ 5: –°–æ–∑–¥–∞—Ç—å re-exports (10 –º–∏–Ω)

**yandex-tracker/src/config/index.ts:**
```typescript
export { ServerConfig, LogLevel, ParsedCategoryFilter, ToolDiscoveryMode, ConfigValidationError } from './server-config.interface.js';
export { loadConfig } from './config-loader.js';
export * from './constants.js';
```

---

### –®–∞–≥ 6: –û–±–Ω–æ–≤–∏—Ç—å imports –≤ yandex-tracker (1.5-2—á)

**6.1 –ù–∞–π—Ç–∏ –≤—Å–µ –∏–º–ø–æ—Ä—Ç—ã:**
```bash
grep -r "from '@mcp-framework/infrastructure'" packages/servers/yandex-tracker/src | grep -i config
```

**6.2 –ó–∞–º–µ–Ω–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã:**
```typescript
// –î–û:
import { ServerConfig, loadConfig } from '@mcp-framework/infrastructure';

// –ü–û–°–õ–ï:
import { ServerConfig, loadConfig } from '#config';
```

**6.3 –§–∞–π–ª—ã –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω–æ):**
- `src/index.ts` (main entry)
- `src/composition-root/container.ts`
- `src/cli/**/*.ts` (CLI commands)

---

### –®–∞–≥ 7: –û—á–∏—Å—Ç–∏—Ç—å infrastructure (30 –º–∏–Ω)

**7.1 –£–¥–∞–ª–∏—Ç—å –∏–∑ infrastructure:**
```bash
# –ù–ï —É–¥–∞–ª—è—Ç—å —Ñ–∞–π–ª—ã —Å—Ä–∞–∑—É! –°–Ω–∞—á–∞–ª–∞ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
```

**–í `infrastructure/src/config.ts`:**
- –£–¥–∞–ª–∏—Ç—å ServerConfig interface
- –£–¥–∞–ª–∏—Ç—å loadConfig() function
- –£–¥–∞–ª–∏—Ç—å –≤—Å–µ domain-specific –∫–æ–¥

**–í `infrastructure/src/constants.ts`:**
- –£–¥–∞–ª–∏—Ç—å DEFAULT_API_BASE –∏ –≤—Å–µ Yandex-specific –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã

**7.2 –û–±–Ω–æ–≤–∏—Ç—å `infrastructure/src/index.ts`:**
```typescript
// –£–¥–∞–ª–∏—Ç—å:
export { ServerConfig, loadConfig } from './config.js';
```

**7.3 –ï—Å–ª–∏ –æ—Å—Ç–∞–ª—Å—è generic –∫–æ–¥ - –æ—Å—Ç–∞–≤–∏—Ç—å, –µ—Å–ª–∏ –Ω–µ—Ç - —É–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª –ø–æ–ª–Ω–æ—Å—Ç—å—é**

---

### –®–∞–≥ 8: –û–±–Ω–æ–≤–∏—Ç—å —Ç–µ—Å—Ç—ã (1-1.5—á)

**8.1 –ù–∞–π—Ç–∏ —Ç–µ—Å—Ç—ã config:**
```bash
find packages/servers/yandex-tracker/tests -name "*config*"
```

**8.2 –û–±–Ω–æ–≤–∏—Ç—å imports –≤ —Ç–µ—Å—Ç–∞—Ö:**
```typescript
// –î–û:
import { loadConfig } from '@mcp-framework/infrastructure';

// –ü–û–°–õ–ï:
import { loadConfig } from '#config';
```

**8.3 –ï—Å–ª–∏ –µ—Å—Ç—å —Ç–µ—Å—Ç—ã –≤ infrastructure - —É–¥–∞–ª–∏—Ç—å –∏—Ö**

---

### –®–∞–≥ 9: –í–∞–ª–∏–¥–∞—Ü–∏—è (30-40 –º–∏–Ω)

**9.1 Build:**
```bash
npm run build
```

**9.2 –ü—Ä–æ–≤–µ—Ä–∫–∞ domain isolation:**
```bash
# –ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —É–ø–æ–º–∏–Ω–∞–Ω–∏–π yandex/tracker –≤ infrastructure:
grep -ri "yandex\|tracker\|issue\|queue" packages/framework/infrastructure/src
# –û–∂–∏–¥–∞–µ–º: –ø—É—Å—Ç–æ–π –≤—ã–≤–æ–¥
```

**9.3 Typecheck:**
```bash
npm run typecheck
```

**9.4 Tests:**
```bash
npm run test:quiet
```

**9.5 –ü–æ–ª–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è:**
```bash
npm run validate:quiet
```

---

### –®–∞–≥ 10: Backwards Compatibility (1—á) ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô

**–í–ê–ñ–ù–û:** –ù–µ –¥–µ–ª–∞—Ç—å breaking change –¥–ª—è infrastructure –ø–∞–∫–µ—Ç–∞!

**10.1 –°–æ–∑–¥–∞—Ç—å deprecated re-export (20 –º–∏–Ω):**

–í `infrastructure/src/config.ts` (–≤–º–µ—Å—Ç–æ —É–¥–∞–ª–µ–Ω–∏—è):
```typescript
/**
 * @deprecated Moved to @mcp-server/yandex-tracker
 * This re-export will be removed in v2.0.0
 * Please update imports:
 *   import { ServerConfig, loadConfig } from '@mcp-framework/infrastructure';
 *   ‚Üì
 *   import { ServerConfig, loadConfig } from '@mcp-server/yandex-tracker/config';
 */
export type { ServerConfig, LogLevel, ParsedCategoryFilter } from '@mcp-server/yandex-tracker/config';
export { loadConfig } from '@mcp-server/yandex-tracker/config';
```

**10.2 Bump version (10 –º–∏–Ω):**

–í `infrastructure/package.json`:
```json
{
  "version": "0.2.0",  // –∏–ª–∏ 1.0.0 –µ—Å–ª–∏ —Å—á–∏—Ç–∞–µ–º ready for production
}
```

**10.3 –û–±–Ω–æ–≤–∏—Ç—å CHANGELOG (15 –º–∏–Ω):**

–°–æ–∑–¥–∞—Ç—å `infrastructure/CHANGELOG.md`:
```markdown
# Changelog

## [0.2.0] - 2025-11-22

### Deprecated
- **config.ts exports** - moved to @mcp-server/yandex-tracker
  - `ServerConfig`, `LogLevel`, `loadConfig()` re-exported with @deprecated
  - Will be removed in v2.0.0
  - Reason: Infrastructure should not contain domain-specific code

### Migration Guide
**Before:**
\`\`\`typescript
import { ServerConfig, loadConfig } from '@mcp-framework/infrastructure';
\`\`\`

**After:**
\`\`\`typescript
import { ServerConfig, loadConfig } from '@mcp-server/yandex-tracker/config';
// or using alias:
import { ServerConfig, loadConfig } from '#config';
\`\`\`
```

**10.4 –û–±–Ω–æ–≤–∏—Ç—å README (15 –º–∏–Ω):**

–í `infrastructure/README.md`:
```markdown
## ‚ö†Ô∏è Deprecation Notice

**Config exports deprecated (v0.2.0):**
- `ServerConfig`, `LogLevel`, `loadConfig()` moved to `@mcp-server/yandex-tracker`
- These exports will be removed in v2.0.0
- Update imports to use `@mcp-server/yandex-tracker/config`

**Reason:** Infrastructure layer should not contain domain-specific code (Yandex.Tracker)
```

---

### –®–∞–≥ 11: –û–±–Ω–æ–≤–∏—Ç—å package.json aliases (20 –º–∏–Ω)

**11.1 –î–æ–±–∞–≤–∏—Ç—å #config alias –≤ yandex-tracker:**

–í `packages/servers/yandex-tracker/package.json`:
```json
{
  "imports": {
    "#config": "./dist/config/index.js",
    "#config/*": "./dist/config/*.js",
    // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ aliases
  }
}
```

**11.2 –û–±–Ω–æ–≤–∏—Ç—å tsconfig paths (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ):**
```json
{
  "compilerOptions": {
    "paths": {
      "#config": ["./src/config/index.ts"],
      "#config/*": ["./src/config/*"]
    }
  }
}
```

---

## ‚úÖ Success Criteria

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ:**
- [ ] Infrastructure builds **—Å deprecated re-exports**
- [ ] Yandex-tracker has local config —Å #config alias
- [ ] All tests pass
- [ ] **Backwards compatibility —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞** (—Å—Ç–∞—Ä—ã–µ –∏–º–ø–æ—Ä—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç)

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- [ ] infrastructure/CHANGELOG.md —Å–æ–∑–¥–∞–Ω
- [ ] infrastructure/README.md –æ–±–Ω–æ–≤–ª–µ–Ω (deprecation notice)
- [ ] infrastructure/package.json –≤–µ—Ä—Å–∏—è bumped (0.2.0)
- [ ] #config alias –¥–æ–±–∞–≤–ª–µ–Ω –≤ yandex-tracker/package.json

**–í–∞–ª–∏–¥–∞—Ü–∏—è:**
- [ ] `npm run validate:quiet` —É—Å–ø–µ—à–Ω–∞
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞: —Å—Ç–∞—Ä—ã–µ –∏–º–ø–æ—Ä—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç (—Å deprecation warning)
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞: –Ω–æ–≤—ã–µ –∏–º–ø–æ—Ä—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç (#config)

**–ö–æ–º–º–∏—Ç –∏ –ø—É—à:**
- [ ] –ö–æ–º–º–∏—Ç —Å detailed migration guide
- [ ] Push –≤ remote

**–†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ—Ç:** –≠—Ç–∞–ø 2.2 (ToolRegistry)
