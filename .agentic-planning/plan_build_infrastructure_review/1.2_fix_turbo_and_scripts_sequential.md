# 1.2 Исправление Turbo и скриптов пакетов (Sequential)

**Приоритет:** Высокий
**Тип:** Sequential (изменения связаны)
**Оценка:** ~45 минут

---

## Чеклист

### 1. Исправить turbo.json inputs

- [ ] Исправить `cpd` inputs: `["src/**/*.ts", ".jscpd.json"]` (без packages/**)
- [ ] Исправить `cpd:quiet` inputs аналогично
- [ ] Исправить `cpd:report` inputs аналогично
- [ ] Добавить `knip` в validate задачу (если нужно)

**Файл:** `turbo.json`

### 2. Унифицировать validate скрипты в пакетах

**Целевой формат для framework пакетов:**
```json
"validate": "npm run lint && npm run typecheck && npm run test && npm run cpd && npm run depcruise && npm run validate:docs",
"validate:quiet": "npm run lint:quiet && npm run typecheck && npm run test:quiet && npm run cpd:quiet"
```

**Целевой формат для server пакетов:**
```json
"validate": "npm run lint && npm run typecheck && npm run test && npm run test:smoke && npm run cpd && npm run depcruise && npm run validate:docs",
"validate:quiet": "npm run lint:quiet && npm run typecheck && npm run test:quiet && npm run cpd:quiet"
```

- [ ] `packages/framework/infrastructure/package.json` — добавить depcruise в validate
- [ ] `packages/framework/core/package.json` — добавить depcruise в validate
- [ ] `packages/framework/cli/package.json` — добавить depcruise и validate:docs в validate
- [ ] `packages/framework/search/package.json` — добавить depcruise в validate
- [ ] `packages/servers/yandex-tracker/package.json` — добавить depcruise в validate
- [ ] `packages/servers/yandex-wiki/package.json` — добавить depcruise в validate
- [ ] `packages/servers/ticktick/package.json` — добавить depcruise и test:smoke в validate

### 3. Убрать `|| true` из критических скриптов

**Решение:** Оставить `|| true` для локальной разработки, но создать strict-версии для CI.

Или альтернатива: убрать `|| true` везде и настроить `.jscpd.json` / `.dependency-cruiser.cjs` на warn вместо error.

- [ ] Обсудить с пользователем предпочтительный подход
- [ ] Применить выбранный подход

### 4. Добавить knip в корневой validate

- [ ] Изменить корневой `validate` скрипт, добавив knip

**Файл:** `package.json` (корневой)

```json
"validate": "turbo run build lint typecheck test test:smoke cpd depcruise validate:docs && npm run knip:root"
```

### 5. Валидация

- [ ] Запустить `npm run validate:quiet` из корня
- [ ] Проверить что все проверки проходят
- [ ] Проверить что ошибки не скрываются

---

## Критерии завершения

- Все validate скрипты единообразны
- turbo.json inputs корректны
- `npm run validate:quiet` проходит из корня
