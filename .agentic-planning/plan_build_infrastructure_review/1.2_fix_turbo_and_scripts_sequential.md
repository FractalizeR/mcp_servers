# 1.2 Исправление Turbo и скриптов пакетов (Sequential)

**Приоритет:** Высокий
**Тип:** Sequential (изменения связаны)
**Статус:** ✅ ЗАВЕРШЁН

---

## Чеклист

### 1. Исправить turbo.json inputs

- [x] Исправить `cpd` inputs: `["src/**/*.ts", "../../../.jscpd.json"]` (без packages/**)
- [x] Исправить `cpd:quiet` inputs аналогично
- [x] Исправить `cpd:report` inputs аналогично
- [x] Исправить `depcruise` inputs аналогично

**Файл:** `turbo.json`

### 2. Унифицировать validate скрипты в пакетах

**Целевой формат для framework пакетов:**
```json
"validate": "npm run lint && npm run typecheck && npm run test && npm run cpd && npm run depcruise && npm run validate:docs",
"validate:quiet": "npm run lint:quiet && npm run typecheck && npm run test:quiet && npm run cpd:quiet"
```

**Целевой формат для server пакетов:**
```json
"validate": "npm run lint && npm run typecheck && npm run test && npm run test:smoke && npm run cpd && npm run depcruise && npm run validate:docs",
"validate:quiet": "npm run lint:quiet && npm run typecheck && npm run test:quiet && npm run cpd:quiet"
```

- [x] `packages/framework/infrastructure/package.json` — добавить depcruise в validate
- [x] `packages/framework/core/package.json` — добавить depcruise в validate
- [x] `packages/framework/cli/package.json` — добавить depcruise и validate:docs в validate
- [x] `packages/framework/search/package.json` — добавить depcruise в validate
- [x] `packages/servers/yandex-tracker/package.json` — добавить depcruise в validate
- [x] `packages/servers/yandex-wiki/package.json` — добавить depcruise в validate
- [x] `packages/servers/ticktick/package.json` — добавить depcruise и test:smoke в validate

### 3. Убрать `|| true` из критических скриптов

**Решение:** Убрать `|| true` везде — ошибки должны быть видны.

- [x] Обсудить с пользователем предпочтительный подход → Вариант A (убрать везде)
- [x] Убрать `|| true` из cpd и depcruise во всех пакетах
- [x] Убрать `|| true` из cpd:root и cpd:quiet:root в корне

### 4. Добавить knip в корневой validate

- [x] Изменить корневой `validate` скрипт, добавив knip

**Файл:** `package.json` (корневой)

```json
"validate": "turbo run build lint typecheck test test:smoke cpd depcruise validate:docs && npm run knip:root"
```

### 5. Валидация

- [x] Запустить `npm run validate:quiet` из корня
- [x] Проверить что все проверки проходят (49/49 tasks successful)
- [x] Проверить что ошибки не скрываются

---

## Критерии завершения

- ✅ Все validate скрипты единообразны
- ✅ turbo.json inputs корректны
- ✅ `npm run validate:quiet` проходит из корня
- ✅ Ошибки cpd/depcruise видны (|| true убран)
