# 3.2 Обновление правил dependency-cruiser (Parallel)

**Приоритет:** Низкий
**Тип:** Parallel (независимая задача)
**Оценка:** ~15 минут

---

## Чеклист

### 1-2. Правила обобщены для всех серверов

**Решение:** Вместо добавления отдельных правил для wiki и ticktick — обобщены существующие правила:

- [x] `server-api-no-mcp` — API слой всех серверов не знает о MCP/tools layer
- [x] `server-tools-use-facade-only` — Tools используют только Facade
- [x] `server-operations-isolation` — Operations изолированы
- [x] `server-composition-root-top-level` — Composition Root изолирован

**Файл:** `.dependency-cruiser.cjs`

### 3. Реализованные паттерны

Используются regex паттерны для покрытия всех серверов:

```javascript
{
  name: 'server-api-no-mcp',
  severity: 'error',
  from: {
    path: '^packages/servers/[^/]+/src/(tracker_api|wiki_api|ticktick_api)/',
  },
  to: {
    path: '^packages/servers/[^/]+/src/(mcp|tools)/',
  },
}
```

- [x] Обобщить существующие правила для yandex-tracker
- [x] Сделать их применимыми ко всем серверам

### 4. Валидация

- [x] Запустить `npm run depcruise` из корня — все 7 пакетов проходят
- [x] Проверить что правила срабатывают корректно — ✓
- [x] Убедиться что нет false positives — только 2 warnings в CLI (существующие циклы)

---

## Критерии завершения

- Правила dependency-cruiser покрывают все серверы
- Нет дублирования правил
- `npm run depcruise` проходит без ошибок
