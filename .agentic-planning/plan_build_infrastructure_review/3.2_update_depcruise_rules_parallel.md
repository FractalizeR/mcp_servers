# 3.2 Обновление правил dependency-cruiser (Parallel)

**Приоритет:** Низкий
**Тип:** Parallel (независимая задача)
**Оценка:** ~15 минут

---

## Чеклист

### 1. Добавить правила для yandex-wiki

- [ ] Добавить правила аналогичные yandex-tracker:
  - `wiki-api-no-mcp` — wiki_api не должен знать о MCP layer
  - `wiki-mcp-uses-facade-only` — MCP tools используют только Facade
  - `wiki-operations-isolation` — Operations через Facade
  - `wiki-composition-root-top-level` — Composition Root изолирован

**Файл:** `.dependency-cruiser.cjs`

### 2. Добавить правила для ticktick

- [ ] Добавить аналогичные правила для ticktick:
  - `ticktick-api-no-mcp`
  - `ticktick-mcp-uses-facade-only`
  - `ticktick-operations-isolation`
  - `ticktick-composition-root-top-level`

### 3. Обобщить правила для всех серверов

**Альтернатива:** Вместо дублирования правил — использовать паттерн:

```javascript
{
  name: 'server-api-no-mcp',
  severity: 'error',
  comment: 'API слой серверов не должен знать о MCP layer',
  from: {
    path: '^packages/servers/[^/]+/src/(tracker_api|wiki_api|ticktick_api)/',
  },
  to: {
    path: '^packages/servers/[^/]+/src/mcp/',
  },
}
```

- [ ] Обобщить существующие правила для yandex-tracker
- [ ] Сделать их применимыми ко всем серверам

### 4. Валидация

- [ ] Запустить `npm run depcruise` из корня
- [ ] Проверить что правила срабатывают корректно
- [ ] Убедиться что нет false positives

---

## Критерии завершения

- Правила dependency-cruiser покрывают все серверы
- Нет дублирования правил
- `npm run depcruise` проходит без ошибок
