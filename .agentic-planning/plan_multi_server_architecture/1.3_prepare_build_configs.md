# Phase 1.3: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ Build –∫–æ–Ω—Ñ–∏–≥–æ–≤ –¥–ª—è multi-server

**–¶–µ–ª—å:** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–π –±–∞–Ω–¥–ª –¥–ª—è yandex-tracker –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —à–∞–±–ª–æ–Ω—ã –¥–ª—è –±—É–¥—É—â–∏—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤

**–í–µ—Ç–∫–∞:** `claude/prepare-build-configs-{session-id}`

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** Phase 0.1 –∑–∞–≤–µ—Ä—à–µ–Ω–∞

**–ú–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å:** 1.1, 1.2, 1.4

**–ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã:** –≤–æ–∑–º–æ–∂–Ω—ã –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Å 1.2 –≤ `packages/servers/yandex-tracker/package.json` (—Ä–∞–∑–¥–µ–ª scripts)

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç

### 1. –°–æ–∑–¥–∞—Ç—å –≤–µ—Ç–∫—É

```bash
git checkout main
git pull origin main
git checkout -b claude/prepare-build-configs-{session-id}
```

### 2. –°–æ–∑–¥–∞—Ç—å —à–∞–±–ª–æ–Ω tsup –∫–æ–Ω—Ñ–∏–≥–∞ –¥–ª—è —Å–µ—Ä–≤–µ—Ä–æ–≤

**`packages/servers/tsup.config.base.ts`** (–æ–±—â–∏–π –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤):

- [ ] –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª —Å –±–∞–∑–æ–≤—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏:

```typescript
import { defineConfig, type Options } from 'tsup';

export function defineServerConfig(
  serverName: string,
  additionalOptions: Partial<Options> = {}
): Options {
  return defineConfig({
    entry: ['src/index.ts'],
    outDir: 'dist',
    format: ['esm'],
    platform: 'node',
    target: 'node18',
    sourcemap: true,
    clean: true,
    dts: false, // servers –Ω–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—é—Ç —Ç–∏–ø—ã
    bundle: true,
    outExtension: () => ({ js: '.js' }),
    esbuildOptions: (options) => {
      options.banner = {
        js: '#!/usr/bin/env node',
      };
    },
    // –ò–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–π –±–∞–Ω–¥–ª –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
    outfile: `dist/${serverName}.bundle.js`,
    external: [
      '@modelcontextprotocol/sdk',
      // framework –ø–∞–∫–µ—Ç—ã –ù–ï external, –æ–Ω–∏ –±—É–¥—É—Ç –∑–∞–±–∞–Ω–¥–ª–µ–Ω—ã
    ],
    ...additionalOptions,
  });
}
```

### 3. –û–±–Ω–æ–≤–∏—Ç—å tsup.config.ts –¥–ª—è yandex-tracker

**`packages/servers/yandex-tracker/tsup.config.ts`:**

- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∞–∑–æ–≤—ã–π –∫–æ–Ω—Ñ–∏–≥:

```typescript
import { defineServerConfig } from '../tsup.config.base.js';

export default defineServerConfig('yandex-tracker', {
  // –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è yandex-tracker –µ—Å–ª–∏ –Ω—É–∂–Ω—ã
});
```

### 4. –û–±–Ω–æ–≤–∏—Ç—å package.json –¥–ª—è yandex-tracker

**`packages/servers/yandex-tracker/package.json`:**

- [ ] –û–±–Ω–æ–≤–∏—Ç—å `bin` —Å –Ω–æ–≤—ã–º –∏–º–µ–Ω–µ–º –±–∞–Ω–¥–ª–∞:
  ```json
  {
    "bin": {
      "mcp-server-yandex-tracker": "./dist/yandex-tracker.bundle.js",
      "mcp-connect": "./dist/cli/mcp-connect.js"
    }
  }
  ```

- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å scripts (–¥–æ–ª–∂–Ω—ã –æ—Å—Ç–∞—Ç—å—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏–ª–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∫–∏):
  ```json
  {
    "scripts": {
      "build": "tsc && tsup",
      "build:bundle": "tsup"
    }
  }
  ```

### 5. –û–±–Ω–æ–≤–∏—Ç—å CLI build

**–î–ª—è `mcp-connect` CLI** (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω –æ—Ç–¥–µ–ª—å–Ω—ã–π –±–∞–Ω–¥–ª):

- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤ `packages/servers/yandex-tracker/tsup.config.ts`:

```typescript
import { defineConfig } from 'tsup';
import { defineServerConfig } from '../tsup.config.base.js';

export default defineConfig([
  // –û—Å–Ω–æ–≤–Ω–æ–π MCP —Å–µ—Ä–≤–µ—Ä
  defineServerConfig('yandex-tracker'),

  // CLI –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç
  {
    entry: ['src/cli/mcp-connect.ts'],
    outDir: 'dist/cli',
    format: ['esm'],
    platform: 'node',
    sourcemap: true,
    bundle: true,
    esbuildOptions: (options) => {
      options.banner = { js: '#!/usr/bin/env node' };
    },
  },
]);
```

### 6. –°–æ–∑–¥–∞—Ç—å README –¥–ª—è –±—É–¥—É—â–∏—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤

**`packages/servers/README.md`:**

- [ ] –°–æ–∑–¥–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é:

```markdown
# MCP Servers

–ö–æ–ª–ª–µ–∫—Ü–∏—è MCP —Å–µ—Ä–≤–µ—Ä–æ–≤, –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö –Ω–∞ @mcp-framework.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞

- `yandex-tracker/` ‚Äî Yandex.Tracker MCP Server
- (–±—É–¥—É—â–∏–µ —Å–µ—Ä–≤–µ—Ä—ã: `github/`, `jira/`, etc.)

## –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞

1. –°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `packages/servers/{server-name}/`
2. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏–∑ `yandex-tracker/` –∫–∞–∫ —à–∞–±–ª–æ–Ω
3. –°–æ–∑–¥–∞—Ç—å `tsup.config.ts` –∏—Å–ø–æ–ª—å–∑—É—è `defineServerConfig()`
4. –û–±–Ω–æ–≤–∏—Ç—å `package.json`:
   - name: `@mcp-server/{server-name}`
   - bin: `./dist/{server-name}.bundle.js`
5. –î–æ–±–∞–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –Ω–∞ `@mcp-framework/*` –ø–∞–∫–µ—Ç—ã

## Build –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–í—Å–µ —Å–µ—Ä–≤–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–±—â–∏–π `tsup.config.base.ts` –¥–ª—è:
- –ò–º–µ–Ω–æ–≤–∞–Ω–Ω—ã—Ö –±–∞–Ω–¥–ª–æ–≤ (`{server-name}.bundle.js`)
- –ï–¥–∏–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ bundling
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ shebang –¥–ª—è executable

–°–º. `yandex-tracker/tsup.config.ts` –∫–∞–∫ –ø—Ä–∏–º–µ—Ä.
```

### 7. –õ–æ–∫–∞–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è

- [ ] `npm install`
- [ ] `npm run build --workspace=@mcp-server/yandex-tracker`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `dist/yandex-tracker.bundle.js` (–Ω–µ `bundle.js`)
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `dist/cli/mcp-connect.js`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å:
  ```bash
  chmod +x packages/servers/yandex-tracker/dist/yandex-tracker.bundle.js
  ./packages/servers/yandex-tracker/dist/yandex-tracker.bundle.js --version
  ```

---

## üì§ –†–µ–∑—É–ª—å—Ç–∞—Ç —ç—Ç–∞–ø–∞

- ‚úÖ –°–æ–∑–¥–∞–Ω –±–∞–∑–æ–≤—ã–π tsup –∫–æ–Ω—Ñ–∏–≥ –¥–ª—è —Å–µ—Ä–≤–µ—Ä–æ–≤
- ‚úÖ yandex-tracker –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–π –±–∞–Ω–¥–ª
- ‚úÖ bin –æ–±–Ω–æ–≤–ª–µ–Ω –Ω–∞ –Ω–æ–≤–æ–µ –∏–º—è —Ñ–∞–π–ª–∞
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –±—É–¥—É—â–∏—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤ –≥–æ—Ç–æ–≤–∞
- ‚úÖ –°–±–æ—Ä–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç, —Ñ–∞–π–ª—ã —Å–æ–∑–¥–∞—é—Ç—Å—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∏–º–µ–Ω–∞–º–∏

---

## üöÄ –ö–æ–º–º–∏—Ç –∏ –ø—É—à

```bash
git add packages/servers
git commit -m "build: –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–µ –±–∞–Ω–¥–ª—ã –¥–ª—è multi-server –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

- –°–æ–∑–¥–∞—Ç—å tsup.config.base.ts –¥–ª—è –æ–±—â–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å–µ—Ä–≤–µ—Ä–æ–≤
- –û–±–Ω–æ–≤–∏—Ç—å yandex-tracker –Ω–∞ –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–π –±–∞–Ω–¥–ª (yandex-tracker.bundle.js)
- –û–±–Ω–æ–≤–∏—Ç—å bin –ø—É—Ç–∏ –≤ package.json
- –î–æ–±–∞–≤–∏—Ç—å README –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤

Ref: Phase 1.3 migration plan

ü§ñ Generated with Claude Code
Co-Authored-By: Claude <noreply@anthropic.com>"

git push -u origin claude/prepare-build-configs-{session-id}
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –í–æ–∑–º–æ–∂–µ–Ω –∫–æ–Ω—Ñ–ª–∏–∫—Ç —Å –≤–µ—Ç–∫–æ–π 1.2 –≤ `package.json` (—Ä–∞–∑–¥–µ–ª bin). –ü—Ä–∏ –º–µ—Ä–¥–∂–µ –≤–∑—è—Ç—å –≤–µ—Ä—Å–∏—é –∏–∑ —ç—Ç–æ–π –≤–µ—Ç–∫–∏.

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –º–µ—Ä–¥–∂—É (–ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è Phase 2.1)
