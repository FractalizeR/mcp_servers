# Phase 2.2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ CI/CD

**–¶–µ–ª—å:** –û–±–Ω–æ–≤–∏—Ç—å GitHub Actions workflows –ø–æ–¥ –Ω–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É

**–í–µ—Ç–∫–∞:** `claude/ci-cd-multi-server-{session-id}` (–∏–ª–∏ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –≤ integration –≤–µ—Ç–∫–µ)

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** Phase 2.1 –∑–∞–≤–µ—Ä—à–µ–Ω–∞

**–ë–ª–æ–∫–∏—Ä—É–µ—Ç:** Phase 2.3

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç

### 1. –°–æ–∑–¥–∞—Ç—å –≤–µ—Ç–∫—É (–µ—Å–ª–∏ –æ—Ç–¥–µ–ª—å–Ω–∞—è –æ—Ç 2.1)

```bash
git checkout claude/integration-multi-server-{session-id}
# –∏–ª–∏
git checkout -b claude/ci-cd-multi-server-{session-id}
```

### 2. –ù–∞–π—Ç–∏ –≤—Å–µ GitHub Actions workflows

- [ ] –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å `.github/workflows/`:
  ```bash
  ls -la .github/workflows/
  ```

–¢–∏–ø–∏—á–Ω—ã–µ —Ñ–∞–π–ª—ã:
- `ci.yml` –∏–ª–∏ `test.yml` ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π CI
- `publish.yml` ‚Äî –ø—É–±–ª–∏–∫–∞—Ü–∏—è –≤ npm
- `lint.yml` ‚Äî –ª–∏–Ω—Ç–∏–Ω–≥
- –¥—Ä—É–≥–∏–µ...

### 3. –û–±–Ω–æ–≤–∏—Ç—å CI workflow

**`.github/workflows/ci.yml` (–∏–ª–∏ –∞–Ω–∞–ª–æ–≥):**

- [ ] –û–±–Ω–æ–≤–∏—Ç—å –ø—É—Ç–∏ –¥–ª—è cache –∫–ª—é—á–µ–π (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è):
  ```yaml
  - name: Cache node_modules
    uses: actions/cache@v3
    with:
      path: |
        node_modules
        packages/framework/*/node_modules
        packages/servers/*/node_modules
      key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
  ```

- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã —Å–±–æ—Ä–∫–∏ (–æ–±—ã—á–Ω–æ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π):
  ```yaml
  - name: Build
    run: npm run build
  ```

- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã —Ç–µ—Å—Ç–æ–≤ (–æ–±—ã—á–Ω–æ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π):
  ```yaml
  - name: Test
    run: npm run test
  ```

- [ ] –û–±–Ω–æ–≤–∏—Ç—å paths –¥–ª—è trigger (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—É—Ç–∏):
  ```yaml
  on:
    push:
      paths:
        - 'packages/framework/**'
        - 'packages/servers/**'
        - 'package.json'
        - '.github/workflows/**'
  ```

### 4. –û–±–Ω–æ–≤–∏—Ç—å Publish workflow

**`.github/workflows/publish.yml` (–µ—Å–ª–∏ –µ—Å—Ç—å):**

- [ ] –û–±–Ω–æ–≤–∏—Ç—å –ø—É–±–ª–∏–∫–∞—Ü–∏—é framework –ø–∞–∫–µ—Ç–æ–≤:
  ```yaml
  - name: Publish @mcp-framework packages
    run: |
      cd packages/framework/infrastructure && npm publish --access public
      cd packages/framework/core && npm publish --access public
      cd packages/framework/search && npm publish --access public
  ```

- [ ] –û–±–Ω–æ–≤–∏—Ç—å –ø—É–±–ª–∏–∫–∞—Ü–∏—é —Å–µ—Ä–≤–µ—Ä–∞:
  ```yaml
  - name: Publish @mcp-server packages
    run: |
      cd packages/servers/yandex-tracker && npm publish --access public
  ```

- [ ] –û–±–Ω–æ–≤–∏—Ç—å —É—Å–ª–æ–≤–∏—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è git tags):
  ```yaml
  # –ü—Ä–∏–º–µ—Ä—ã —Ç–µ–≥–æ–≤:
  # @mcp-framework/core@1.0.0
  # @mcp-server/yandex-tracker@2.1.0
  ```

### 5. –û–±–Ω–æ–≤–∏—Ç—å paths –≤ –¥—Ä—É–≥–∏—Ö workflows

**–î–ª—è –∫–∞–∂–¥–æ–≥–æ workflow —Ñ–∞–π–ª–∞:**

- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É–ø–æ–º–∏–Ω–∞–Ω–∏—è —Å—Ç–∞—Ä—ã—Ö –ø—É—Ç–µ–π:
  ```bash
  grep -r "packages/yandex-tracker" .github/workflows/
  grep -r "packages/infrastructure" .github/workflows/
  grep -r "packages/core" .github/workflows/
  grep -r "packages/search" .github/workflows/
  ```

- [ ] –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –Ω–æ–≤—ã–µ:
  - `packages/infrastructure` ‚Üí `packages/framework/infrastructure`
  - `packages/core` ‚Üí `packages/framework/core`
  - `packages/search` ‚Üí `packages/framework/search`
  - `packages/yandex-tracker` ‚Üí `packages/servers/yandex-tracker`

### 6. –û–±–Ω–æ–≤–∏—Ç—å dependabot config (–µ—Å–ª–∏ –µ—Å—Ç—å)

**`.github/dependabot.yml`:**

- [ ] –û–±–Ω–æ–≤–∏—Ç—å –ø—É—Ç–∏ –¥–ª—è package-ecosystem:
  ```yaml
  version: 2
  updates:
    - package-ecosystem: "npm"
      directory: "/"
      schedule:
        interval: "weekly"

    # Framework packages
    - package-ecosystem: "npm"
      directory: "/packages/framework/infrastructure"
      schedule:
        interval: "weekly"

    - package-ecosystem: "npm"
      directory: "/packages/framework/core"
      schedule:
        interval: "weekly"

    - package-ecosystem: "npm"
      directory: "/packages/framework/search"
      schedule:
        interval: "weekly"

    # Server packages
    - package-ecosystem: "npm"
      directory: "/packages/servers/yandex-tracker"
      schedule:
        interval: "weekly"
  ```

### 7. –û–±–Ω–æ–≤–∏—Ç—å codecov config (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

**`codecov.yml` –∏–ª–∏ `.codecov.yml`:**

- [ ] –û–±–Ω–æ–≤–∏—Ç—å –ø—É—Ç–∏ –¥–ª—è coverage:
  ```yaml
  coverage:
    status:
      project:
        default:
          target: 90%
          paths:
            - "packages/framework/infrastructure/src"
            - "packages/framework/core/src"
            - "packages/framework/search/src"
            - "packages/servers/yandex-tracker/src"
  ```

### 8. –û–±–Ω–æ–≤–∏—Ç—å PR template (–µ—Å–ª–∏ –µ—Å—Ç—å)

**`.github/PULL_REQUEST_TEMPLATE.md`:**

- [ ] –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã —Å—Ç—Ä—É–∫—Ç—É—Ä—ã (–µ—Å–ª–∏ —É–ø–æ–º–∏–Ω–∞—é—Ç—Å—è –ø—É—Ç–∏):
  ```markdown
  ## –ö–∞—Ç–µ–≥–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
  - [ ] Framework (infrastructure/core/search)
  - [ ] Server (yandex-tracker)
  - [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
  - [ ] CI/CD
  ```

### 9. –õ–æ–∫–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ workflows

- [ ] –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å act (GitHub Actions local runner) –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –æ–Ω–ª–∞–π–Ω:
  ```bash
  # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
  cat .github/workflows/ci.yml | yq eval
  # –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π GitHub UI –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ YAML
  ```

- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ –ø—É—Ç–∏ —Å—É—â–µ—Å—Ç–≤—É—é—Ç:
  ```bash
  # –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—É—Ç–∏ –≤ workflows –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:
  test -d packages/framework/infrastructure && echo "OK"
  test -d packages/servers/yandex-tracker && echo "OK"
  ```

### 10. –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π PR –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ CI

- [ ] –ü—É—à –∏–∑–º–µ–Ω–µ–Ω–∏–π:
  ```bash
  git add .github/
  git commit -m "ci: –æ–±–Ω–æ–≤–∏—Ç—å workflows –¥–ª—è multi-server —Å—Ç—Ä—É–∫—Ç—É—Ä—ã"
  git push -u origin claude/ci-cd-multi-server-{session-id}
  ```

- [ ] –°–æ–∑–¥–∞—Ç—å draft PR –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ CI:
  ```bash
  gh pr create --draft \
    --title "CI: Update for multi-server architecture" \
    --body "Testing CI workflows with new structure"
  ```

- [ ] –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤—Å–µ checks –ø—Ä–æ—Ö–æ–¥—è—Ç:
  - ‚úÖ Build —É—Å–ø–µ—à–µ–Ω
  - ‚úÖ Tests –ø—Ä–æ—Ö–æ–¥—è—Ç
  - ‚úÖ Lint –±–µ–∑ –æ—à–∏–±–æ–∫
  - ‚úÖ Coverage –¥–æ—Å—Ç–∞—Ç–æ—á–µ–Ω

- [ ] –ó–∞–∫—Ä—ã—Ç—å draft PR –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ (–∏–ª–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ ready –µ—Å–ª–∏ –≤—Å–µ –≥–æ—Ç–æ–≤–æ)

---

## üì§ –†–µ–∑—É–ª—å—Ç–∞—Ç —ç—Ç–∞–ø–∞

- ‚úÖ –í—Å–µ workflows –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- ‚úÖ –ü—É—Ç–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
- ‚úÖ CI/CD –ø—Ä–æ—Ö–æ–¥–∏—Ç —É—Å–ø–µ—à–Ω–æ
- ‚úÖ Dependabot –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- ‚úÖ Coverage tracking —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## üöÄ –ö–æ–º–º–∏—Ç

–ï—Å–ª–∏ –Ω–µ —Å–¥–µ–ª–∞–Ω —Ä–∞–Ω–µ–µ:

```bash
git add .github/
git commit -m "ci: –æ–±–Ω–æ–≤–∏—Ç—å GitHub Actions –¥–ª—è multi-server –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

- –û–±–Ω–æ–≤–∏—Ç—å –ø—É—Ç–∏ –≤ workflows (framework/, servers/)
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å dependabot –¥–ª—è –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- –û–±–Ω–æ–≤–∏—Ç—å coverage paths
- –û–±–Ω–æ–≤–∏—Ç—å PR template

‚úÖ –í—Å–µ checks –ø—Ä–æ—Ö–æ–¥—è—Ç

Ref: Phase 2.2 CI/CD plan

ü§ñ Generated with Claude Code
Co-Authored-By: Claude <noreply@anthropic.com>"
```

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** Phase 2.3 ‚Äî —Ñ–∏–Ω–∞–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
