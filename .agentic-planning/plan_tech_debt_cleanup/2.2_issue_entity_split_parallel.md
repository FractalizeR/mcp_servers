# 2.2 Декомпозиция issue.entity.ts

**Тип:** Parallel (можно выполнять параллельно с 2.1, 2.3, 2.4)
**Пакет:** `@mcp-server/yandex-tracker`
**Оценка:** 1-2 часа
**Статус:** [ ] Не начато

## Проблема

Файл `src/tracker_api/entities/issue/issue.entity.ts` содержит **1037 строк** при лимите 500.

## Анализ (выполнить первым)

- [ ] Изучить структуру файла
- [ ] Определить логические группы полей/методов
- [ ] Проверить какие части используются где (grep по импортам)
- [ ] Изучить связанные файлы в `entities/issue/`

## Предполагаемая структура декомпозиции

```
entities/issue/
├── issue.entity.ts          # Основной класс (core fields)
├── issue-relations.ts       # Связи: parent, children, links
├── issue-workflow.ts        # Статусы, переходы, changelog
├── issue-time-tracking.ts   # Worklog, estimation, spent time
├── issue-metadata.ts        # Теги, компоненты, версии
├── issue.mapper.ts          # Маппинг DTO → Entity (если есть)
├── issue.types.ts           # Вспомогательные типы
└── index.ts                 # Re-export
```

## Принципы декомпозиции

1. **Single Responsibility** — каждый файл отвечает за одну группу данных
2. **Cohesion** — связанные поля/методы держим вместе
3. **Backward Compatibility** — публичный API не меняется
4. **Composition** — основной класс может использовать sub-объекты

## Шаги реализации

### Шаг 1: Подготовка
- [ ] Создать backup: `cp issue.entity.ts issue.entity.ts.bak`
- [ ] Записать текущий публичный API (методы, свойства)

### Шаг 2: Выделение типов
- [ ] Создать `issue.types.ts`
- [ ] Перенести interfaces, type aliases
- [ ] Обновить импорты в issue.entity.ts

### Шаг 3: Выделение relations (если применимо)
- [ ] Создать `issue-relations.ts`
- [ ] Перенести: parent, children, links, subtasks
- [ ] Экспортировать как mixin или отдельный класс

### Шаг 4: Выделение workflow (если применимо)
- [ ] Создать `issue-workflow.ts`
- [ ] Перенести: status, transitions, changelog
- [ ] Экспортировать

### Шаг 5: Выделение time tracking (если применимо)
- [ ] Создать `issue-time-tracking.ts`
- [ ] Перенести: worklog, estimation, spent
- [ ] Экспортировать

### Шаг 6: Обновление основного класса
- [ ] Использовать composition для sub-объектов
- [ ] Сохранить обратную совместимость через геттеры
- [ ] Проверить что все тесты проходят

### Шаг 7: Обновление index.ts
- [ ] Re-export всех новых модулей
- [ ] Убедиться что внешние импорты не сломались

## Валидация

```bash
cd packages/servers/yandex-tracker
npm run lint
npm run typecheck
npm run test
npm run test:smoke
```

- [ ] Файл issue.entity.ts ≤ 500 строк
- [ ] Все тесты проходят
- [ ] Smoke tests проходят

## Коммит

```
refactor(yandex-tracker): split issue.entity.ts into focused modules

- Extract issue types to issue.types.ts
- Extract relations handling to issue-relations.ts
- Extract workflow logic to issue-workflow.ts
- Reduce main file from 1037 to ~400 lines
- Maintain backward compatibility
```

## Риски

- **Высокий:** Много зависимостей от issue.entity — внимательно проверять импорты
- **Средний:** Возможны проблемы с circular imports при декомпозиции

## Чек-лист завершения

- [ ] issue.entity.ts ≤ 500 строк
- [ ] Публичный API сохранён
- [ ] Все тесты проходят
- [ ] Документация обновлена (если есть)
