# 📋 План миграции в монорепозиторий (5 пакетов)

**Версия:** 1.0
**Дата создания:** 2025-11-16
**Статус:** Готов к реализации

---

## 🎯 Цель

Разделить текущий монолитный проект на 5 независимых npm пакетов:

1. **@mcp-framework/infrastructure** — HTTP, cache, logging, async (~1391 строк)
2. **@mcp-framework/core** — Базовые классы MCP tools (~1185 строк)
3. **@mcp-framework/search** — Tool Search Engine (~1233 строк)
4. **@mcp-framework/cli** — CLI для подключения к MCP клиентам (~1450 строк)
5. **mcp-server-yandex-tracker** — Конкретная реализация (~4756 строк)

**Общий объем:** ~11200 строк кода в 160 файлах

---

## 🔄 Стратегия оптимизации

### Критический путь (Sequential)

Задачи выполняются **строго последовательно**, т.к. есть зависимости:

```
Фаза 1 (Sequential)
├── 1. Подготовка monorepo структуры
├── 2. Разделение infrastructure (база для всех)
└── 3. Разделение core (база для search)

Фаза 2 (Parallel) — можно делать одновременно
├── 4a. Разделение search (зависит от core)
├── 4b. Разделение CLI (независимый)
└── 4c. Подготовка yandex-tracker структуры

Фаза 3 (Sequential)
├── 5. Интеграция yandex-tracker с новыми пакетами
├── 6. Настройка сборки и тестов
├── 7. Документация
└── 8. Публикация
```

### Почему именно так?

**Последовательно (Фаза 1):**
- `infrastructure` → все остальные пакеты зависят от него
- `core` → `search` зависит от `core`
- Нельзя начать `search` до готовности `core`

**Параллельно (Фаза 2):**
- `search`, `cli`, `yandex-tracker` независимы друг от друга
- Можно работать в 3 терминалах одновременно
- **Экономия времени: ~4-6 часов**

**Последовательно (Фаза 3):**
- Интеграция требует готовности всех пакетов
- Тесты проверяют взаимодействие
- Документация описывает готовую систему

---

## ⏱️ Оценка времени

### Без оптимизации (последовательно)
- Фаза 1: 8 часов
- Фаза 2: 8 часов (4a + 4b + 4c последовательно)
- Фаза 3: 8 часов
- **ИТОГО: 24 часа (3 рабочих дня)**

### С оптимизацией (параллельно где можно)
- Фаза 1: 8 часов
- Фаза 2: 3 часа (4a/4b/4c параллельно, берём max)
- Фаза 3: 8 часов
- **ИТОГО: 19 часов (2.5 рабочих дня)**

**Выигрыш: ~5 часов (21% ускорение)**

---

## 📁 Структура плана

```
.plan-to-packages/
├── OVERVIEW.md                    # Этот файл — общий обзор
├── PHASE-1-SEQUENTIAL.md          # Фаза 1: Подготовка + infrastructure + core
├── PHASE-2-PARALLEL.md            # Фаза 2: search + CLI + yandex-tracker (параллельно)
├── PHASE-3-SEQUENTIAL.md          # Фаза 3: Интеграция + тесты + публикация
├── CHECKLIST.md                   # Чек-лист для отслеживания прогресса
├── RISKS.md                       # Риски и стратегии митигации
├── SCRIPTS.md                     # Готовые скрипты и команды
└── PACKAGE-SPECS.md               # Детальные спецификации пакетов
```

---

## 📊 Граф зависимостей

```
┌─────────────────────────────────────────────────────────────┐
│                      External Dependencies                   │
│  @modelcontextprotocol/sdk, axios, pino, zod, inversify...  │
└─────────────────────────────────────────────────────────────┘
                              ▲
                              │
                    ┌─────────┴─────────┐
                    │                   │
        ┌───────────────────┐  ┌───────────────┐
        │  infrastructure   │  │      CLI      │
        │   (HTTP, logs)    │  │  (независим)  │
        └───────────────────┘  └───────────────┘
                    ▲
                    │
            ┌───────────────┐
            │     core      │
            │ (BaseTool,    │
            │  Registry)    │
            └───────────────┘
                    ▲
                    │
            ┌───────────────┐
            │    search     │
            │ (Tool Search  │
            │   Engine)     │
            └───────────────┘
                    ▲
                    │
        ┌───────────────────────────┐
        │   yandex-tracker          │
        │ (использует все пакеты)   │
        └───────────────────────────┘
```

---

## ✅ Критерии готовности

### Фаза 1
- [ ] npm workspaces настроены
- [ ] @mcp-framework/infrastructure собирается
- [ ] @mcp-framework/core собирается
- [ ] Тесты infrastructure и core проходят

### Фаза 2
- [ ] @mcp-framework/search собирается
- [ ] @mcp-framework/cli собирается
- [ ] mcp-server-yandex-tracker структура создана
- [ ] Все импорты обновлены

### Фаза 3
- [ ] Все пакеты собираются
- [ ] Все тесты проходят (coverage ≥80%)
- [ ] dependency-cruiser не находит нарушений
- [ ] Smoke test сервера успешен
- [ ] Документация обновлена
- [ ] GitHub Actions настроен

---

## 🚀 Быстрый старт

```bash
# 1. Прочитать весь план
cd .plan-to-packages
cat OVERVIEW.md
cat PHASE-1-SEQUENTIAL.md
cat PHASE-2-PARALLEL.md
cat PHASE-3-SEQUENTIAL.md

# 2. Создать ветку
git checkout -b refactor/split-into-packages

# 3. Начать Фазу 1
# Следовать инструкциям в PHASE-1-SEQUENTIAL.md

# 4. После Фазы 1 → Фаза 2 (параллельно)
# Открыть 3 терминала и работать параллельно

# 5. Фаза 3 → финал
# Последовательная интеграция и тесты
```

---

## 📞 Поддержка

При возникновении проблем:

1. Проверить RISKS.md для известных проблем
2. Использовать SCRIPTS.md для готовых команд
3. Обратиться к CHECKLIST.md для проверки пропущенных шагов
4. В критических случаях — откатиться на предыдущий commit

---

## 📝 История изменений

| Версия | Дата | Изменения |
|--------|------|-----------|
| 1.0 | 2025-11-16 | Первая версия плана |

---

**Следующий шаг:** Читать `PHASE-1-SEQUENTIAL.md`
